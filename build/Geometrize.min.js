/**
*   Geometrize
*   computational geometry and rendering library for JavaScript
*
*   @version 0.9.9 (2023-01-03 18:38:02)
*   https://github.com/foo123/Geometrize
*
**/!function(t,n,e){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=e.call(t)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return e.moduleUri=n.uri,e.call(t)}):n in t||(t[n]=e.call(t)||1)&&"function"==typeof define&&define.amd&&define(function(){return t[n]})}("undefined"!=typeof self?self:this,"Geometrize",function(){"use strict";var y=Object.prototype.hasOwnProperty,t=Object.prototype.toString,b=Object.defineProperty,C=Math,$=C.abs,_=C.sqrt,l=C.pow,w=C.PI,P=2*w,a=1e-6,r=_(2),c=_(3),f=20,h=.01,g={},x=function(){},n="undefined"!=typeof global&&"[object global]"===t.call(global),p="undefined"!=typeof window&&"[object Window]"===t.call(window),i=(n?global:p&&window,{VERSION:"0.9.9",Math:{},Geometry:{}});function e(n,t,e){var r,i,o,u=y.call(t,"constructor")?t.constructor:function(){};for(r in n?(u.prototype=Object.create(n.prototype),u.prototype.$super=(i=n,o={},function(n,t){var e=":"+n;return 1===o[e]?(i.prototype.$super||x).call(this,n,t):(o[e]=1,t=("constructor"===n?i:i.prototype[n]||x).apply(this,t||[]),o[e]=0,t)})):u.prototype.$super=x,u.prototype.constructor=u,t)y.call(t,r)&&"constructor"!==r&&(u.prototype[r]=t[r]);if(e)for(r in e)y.call(e,r)&&(u[r]=e[r]);return u}var n={$changed:!1,$cb:null,dispose:function(){this.$cb=null},isChanged:function(n){return arguments.length?(this.$changed=!!n,this):this.$changed},onChange:function(n,t){var e,r=this;return!1===t&&(ct(n)||st(n))?r.$cb&&-1!==(e=(st(n)?r.$cb.map(function(n){return rt(n.id)}):r.$cb).indexOf(n))&&r.$cb.splice(e,1):ct(n)&&(r.$cb||(r.$cb=[]),-1===(e=r.$cb.indexOf(n))&&r.$cb.push(n)),r},triggerChange:function(){var t=this;return t.$cb&&t.$cb.forEach(function(n){n(t)}),t}},S=e(null,Dn(null,{constructor:function e(r){var i=this;return r instanceof e?r:i instanceof e?(r=it(r),i.dispose=function(){r=null,e.prototype.dispose.call(i)},i.clone=function(){return new e(r)},i.val=function(n){if(arguments.length){n=n instanceof e?n.val():it(n);var t=!Rn(r,n);return r=n,t&&(i.isChanged(!0),i.triggerChange()),i}return r},i.valueOf=function(){return r.valueOf()},i.toString=function(){return rt(r)},void i.isChanged(!0)):new e(r)},clone:null,val:null,valueOf:null,toString:null},n)),d=e(null,{constructor:function n(t,e,r,i,o,u){var s=this;return t instanceof n?t:s instanceof n?void(at(t)&&6<=t.length?(s.$00=it(t[0]),s.$01=it(t[1]),s.$02=it(t[2]),s.$10=it(t[3]),s.$11=it(t[4]),s.$12=it(t[5])):(s.$00=t,s.$01=e,s.$02=r,s.$10=i,s.$11=o,s.$12=u)):new n(t,e,r,i,o,u)},$00:1,$01:0,$02:0,$10:0,$11:1,$12:0,clone:function(){var n=this;return new d(n.$00,n.$01,n.$02,n.$10,n.$11,n.$12)},eq:function(n){if(n instanceof d){var t=this;return Rn(t.$00,n.$00)&&Rn(t.$01,n.$01)&&Rn(t.$02,n.$02)&&Rn(t.$10,n.$10)&&Rn(t.$11,n.$11)&&Rn(t.$12,n.$12)}return!1},add:function(n){var t=this;return n instanceof d?new d(t.$00+n.$00,t.$01+n.$01,t.$02+n.$02,t.$10+n.$10,t.$11+n.$11,t.$12+n.$12):(n=it(n),new d(t.$00+n,t.$01+n,t.$02+n,t.$10+n,t.$11+n,t.$12+n))},mul:function(n){var t=this;return n instanceof d?new d(t.$00*n.$00+t.$01*n.$10+t.$02*n.$20,t.$00*n.$01+t.$01*n.$11+t.$02*n.$21,t.$00*n.$02+t.$01*n.$12+t.$02*n.$22,t.$10*n.$00+t.$11*n.$10+t.$12*n.$20,t.$10*n.$01+t.$11*n.$11+t.$12*n.$21,t.$10*n.$02+t.$11*n.$12+t.$12*n.$22):(n=it(n),new d(t.$00*n,t.$01*n,t.$02*n,t.$10*n,t.$11*n,t.$12*n))},det:function(){var n=this;return n.$00*(n.$11*n.$22-n.$12*n.$21)+n.$01*(n.$12*n.$20-n.$10*n.$22)+n.$02*(n.$21*n.$10-n.$11*n.$20)},inv:function(){var n,t,e,r=this,i=r.$00,o=r.$01,u=r.$02,s=r.$10,a=r.$11,l=r.$12,c=i*a-o*s;return qn(c,0)?null:new d(n=a/c,t=-o/c,-n*u-t*l,e=-s/c,r=i/c,-e*u-r*l)},transform:function(n,t){var e=this,r=n.x,i=n.y,n=e.$00*r+e.$01*i+e.$02,e=e.$10*r+e.$11*i+e.$12;return t?(t.x=n,t.y=e):t=new G(n,e),t},getTranslation:function(){return{x:this.$02,y:this.$12}},getRotationAngle:function(){return C.atan2(this.$10,this.$00)},getScale:function(){var n=this.$00,t=-this.$01,e=this.$10,r=this.$11;return{x:In(n)*Xn(n,e),y:In(r)*Xn(t,r)}},toArray:function(){var n=this;return[n.$00,n.$01,n.$02,n.$10,n.$11,n.$12,0,0,1]},toSVG:function(){var n=this;return"matrix("+rt(n.$00)+" "+rt(n.$10)+" "+rt(n.$01)+" "+rt(n.$11)+" "+rt(n.$02)+" "+rt(n.$12)+")"},toCSS:function(){var n=this;return"matrix("+rt(n.$00)+","+rt(n.$10)+","+rt(n.$01)+","+rt(n.$11)+","+rt(n.$02)+","+rt(n.$12)+")"},toCanvas:function(n){var t=this;return n.transform(t.$00,t.$10,t.$01,t.$11,t.$02,t.$12),n},toTex:function(){return d.arrayTex(this.toArray(),3,3)},toString:function(){return d.arrayString(this.toArray(),3,3)}},{eye:function(){return new d(1,0,0,0,1,0)},translate:function(n,t){return new d(1,0,it(n),0,1,it(t))},rotate:function(n,t,e){e=it(e||0),t=it(t||0),n=it(n);var r=C.cos(n),n=C.sin(n);return new d(r,-n,t-r*t+n*e,n,r,e-r*e-n*t)},scale:function(n,t,e,r){return r=it(r||0),e=it(e||0),n=it(n),t=it(t),new d(n,0,-n*e+e,0,t,-t*r+r)},reflectX:function(){return new d(-1,0,0,0,1,0)},reflectY:function(){return new d(1,0,0,0,-1,0)},shearX:function(n){return new d(1,it(n),0,0,1,0)},shearY:function(n){return new d(1,0,0,it(n),1,0)},arrayTex:function(n,t,e){for(var r="\\begin{pmatrix}",i=0;i<t;++i)r+=n.slice(i*e,i*e+e).join("&"),i+1<t&&(r+="\\\\");return r+="\\end{pmatrix}"},arrayString:function(n,t,e){for(var r=n.reduce(function(n,t){return C.max(n,rt(t).length)},0),i="",o=0;o<t;++o)i+="["+n.slice(o*e,o*e+e).map(function(n){return nt(n,r)}).join(" ")+"]",o+1<t&&(i+="\n");return i},pointTex:function(n){return"\\begin{pmatrix}"+rt(n.x)+"\\\\"+rt(n.y)+"\\\\1\\end{pmatrix}"},pointString:function(n){var t=[n.x,n.y].reduce(function(n,t){return C.max(n,rt(t).length)},1);return"["+nt(n.x,t)+"]\n["+nt(n.y,t)+"]\n["+nt(1,t)+"]"}}),m=d.eye();i.Matrix=d;var o=e(null,Dn(null,{constructor:function n(t){var e=this,r=null,i=null;return t instanceof n?t:e instanceof n?(i=Dn(r=n.Properties,{},n.Defaults),lt(t)&&(i=Dn(r,i,t)),r.forEach(function(t){b(e,t,{get:function(){return i[t]},set:function(n){i[t]!==n&&(i[t]=n,e.isChanged(!0),e.triggerChange())},enumerable:!0,configurable:!1})}),e.toObj=function(){return r.reduce(function(n,t){return n[t]=i[t],n},{})},void e.isChanged(!0)):new n(t)},clone:function(){return new o(this.toObj())},toSVG:function(){var e=this.toObj();return Object.keys(e).reduce(function(n,t){return n+t+":"+rt(e[t])+";"},"")},toCanvas:function(n){var t=this;return n.lineCap=t["stroke-linecap"],n.lineJoin=t["stroke-linejoin"],n.lineWidth=t["stroke-width"],n.fillStyle="none"===t.fill?"transparent":t.fill,n.strokeStyle=t.stroke,n}},n),{Properties:["stroke-width","stroke","stroke-opacity","stroke-linecap","stroke-linejoin","fill","fill-opacity","fill-rule"],Defaults:{"stroke-width":1,stroke:"#000000","stroke-opacity":1,"stroke-linecap":"butt","stroke-linejoin":"miter",fill:"none","fill-opacity":1,"fill-rule":"evenodd"}});i.Style=o;var v=e(null,Dn(null,{constructor:function(){var t,n,e=this,r=null;e.id=(n=e.name,rt(n||"")+"_"+rt(++et)+"_"+rt((new Date).getTime())+"_"+rt(C.round(1e3*C.random()))),t=function(n){r===n&&(e.isChanged(!0),e.triggerChange())},(r=new o).onChange(t),b(e,"style",{get:function(){return r},set:function(n){n=o(n),r!==n&&(r&&r.onChange(t,!1),(r=n)&&(r.onChange(t),e.isChanged(!0),e.triggerChange()))},enumerable:!0,configurable:!1}),e.setStyle=function(n,t){return arguments.length&&(1<arguments.length?e.style[n]=t:e.style=n),e},e.isChanged(!0)},id:"",name:"Primitive",clone:function(){return this},transform:function(){return this},setStyle:null,getBoundingBox:function(){return{ymin:-1/0,xmin:-1/0,ymax:1/0,xmax:1/0}},getConvexHull:function(){return[]},getCenter:function(){var n=this.getBoundingBox();return{x:(n.xmin+n.xmax)/2,y:(n.ymin+n.ymax)/2}},hasPoint:function(n){return!1},hasInsidePoint:function(n,t){return!1},intersects:function(n){return!1},intersectsSelf:function(){return!1},toSVG:function(n){return arguments.length?n:""},toSVGPath:function(n){return arguments.length?n:""},toCanvas:function(n){},toCanvasPath:function(n){},toTex:function(){return"\\text{Primitive}"},toString:function(){return"Primitive()"}},n)),G=e(i.Primitive=v,{constructor:function n(t,e){var r=this,i=0,o=0,u=null;return t instanceof n?t:r instanceof n?(r.$super("constructor"),o=at(t)?(i=it(t[0]),it(t[1])):lt(t)?(i=it(t.x),it(t.y)):(i=it(t),it(e)),b(r,"x",{get:function(){return i},set:function(n){var t=!Rn(n=it(n),i);i=n,t&&(r.isChanged(!0),r.triggerChange())},enumerable:!0,configurable:!1}),b(r,"y",{get:function(){return o},set:function(n){var t=!Rn(n=it(n),o);o=n,t&&(r.isChanged(!0),r.triggerChange())},enumerable:!0,configurable:!1}),b(r,"norm",{get:function(){return null==u&&(u=Xn(i,o)),u},enumerable:!0,configurable:!1}),r.isChanged=function(n){return!0===n&&(u=null),r.$super("isChanged",arguments)},void(r.dispose=function(){o=i=null,r.$super("dispose")})):new n(t,e)},name:"Point",clone:function(){return new G(this.x,this.y)},transform:function(n){return n.transform(this)},getBoundingBox:function(){return{ymin:this.y,xmin:this.x,ymax:this.y,xmax:this.x}},eq:function(n){return n instanceof G||null!=n.x&&null!=n.y?I(this,n):!!at(n)&&I(this,{x:n[0],y:n[1]})},add:function(n){return n instanceof G?new G(this.x+n.x,this.y+n.y):new G(this.x+it(n),this.y+it(n))},mul:function(n){return n=it(n),new G(this.x*n,this.y*n)},dot:function(n){return zn(this.x,this.y,n.x,n.y)},cross:function(n){return Bn(this.x,this.y,n.x,n.y)},angle:function(n){return Mn(this.x,this.y,n.x,n.y)},between:function(n,t){return!!(n instanceof z?N(this,n.start,n.end):N(this,n,t))},distanceToLine:function(n,t){return n instanceof z?q(this,n.start,n.end):q(this,n,t)},isOn:function(n){return!!ct(n.hasPoint)&&n.hasPoint(this)},isInside:function(n,t){return!!ct(n.hasInsidePoint)&&n.hasInsidePoint(this,t)},intersects:function(n){return n instanceof G?!!this.eq(n)&&[this]:n instanceof v&&n.intersects(this)},toObj:function(){return{x:this.x,y:this.y}},bezierPoints:function(){var n=this.x,t=this.y;return[[{x:n,y:t},{x:n,y:t},{x:n,y:t},{x:n,y:t}]]},toSVG:function(n){var t=this;return Fn("circle",{id:[t.id,!1],cx:[t.x,t.isChanged()],cy:[t.y,t.isChanged()],r:[t.style["stroke-width"],t.style.isChanged()],style:["fill:"+rt(t.style.stroke)+";",t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t.style["stroke-width"],e="M "+rt(t.x-e)+" "+rt(t.y)+" a "+rt(e)+" "+rt(e)+" 0 0 0 "+rt(e+e)+" 0 a "+rt(e)+" "+rt(e)+" 0 0 0 "+rt(-e-e)+" 0 Z";return arguments.length?Fn("path",{id:[t.id,!1],d:[e,t.isChanged()],style:["fill:"+rt(t.style.stroke)+";",t.style.isChanged()]},n):e},toCanvas:function(n){n.fillStyle=this.style.stroke,this.toCanvasPath(n)},toCanvasPath:function(n){n.beginPath(),n.arc(this.x,this.y,this.style["stroke-width"],0,P),n.closePath(),n.fill()},toTex:function(){return"\\begin{pmatrix}"+rt(this.x)+"\\\\"+rt(this.y)+"\\end{pmatrix}"},toString:function(){return"Point("+rt(this.x)+","+rt(this.y)+")"}});i.Point=G;var u=e(v,{constructor:function n(t){var e,r,i,o,u=this,s=null;return t instanceof n?t:u instanceof n?(null==t&&(t=[]),u.$super("constructor"),i=function(n){return(n=G(n)).onChange(e),n},o=function(n){return n.onChange(e,!1),n},(e=function(n){at(s)&&-1!==s.indexOf(n)&&(u.isChanged(!0),u.triggerChange())}).id=u.id,(r=function(){u.isChanged(!0),u.triggerChange()}).id=u.id,(s=Un(t,i,o,I)).onChange(r),void b(u,"points",{get:function(){return s},set:function(n){s!==n&&(at(s)&&Hn(s,o),at(n)?((s=Un(n,i,o,I)).onChange(r),u.isChanged(!0),u.triggerChange()):null==n&&(s=null))},enumerable:!0,configurable:!0})):new n(t)},name:"Topos",dispose:function(){var t=this;t.points&&(Hn(t.points,function(n){return n.onChange(t.id,!1),n}),t.points=null),t.$super("dispose")},isChanged:function(n){return!1===n&&this.points.forEach(function(n){n.isChanged(!1)}),this.$super("isChanged",arguments)},clone:function(){return new u(this.points.map(function(n){return n.clone()}))},transform:function(t){return new u(this.points.map(function(n){return t.transform(n)}))},hasPoint:function(n){for(var t=this.points,e=t.length,r=0;r<e;++r)if(I(t[r],n))return!0;return!1},hasInsidePoint:function(n,t){return this.hasPoint(n)},intersects:function(n){if(n instanceof v){for(var t=this.points,e=t.length,r=[],i=0;i<e;++i)n.intersects(t[i])&&r.push(t[i]);return!!r.length&&r}return!1},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t.points.map(function(n){return n.toSVGPath()}).join(" ");return arguments.length?Fn("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n)},toCanvasPath:function(t){this.points.forEach(function(n){n.toCanvasPath(t)})},toTex:function(){return"\\text{Topos}"},toString:function(){return"Topos()"}}),A=e(i.Topos=u,{constructor:function(n,t){var e=this,r=null,i=null,o=null,u=null,s=null,a=null;e.$super("constructor",[n]),null==t&&(t={}),u=t,r=e.hasMatrix()?d.eye():null,u.matrix=new S(0),u.matrix.isChanged(e.hasMatrix()),b(e,"matrix",{get:function(){return r||d.eye()},set:function(n){var t;e.hasMatrix()&&(t=!(n=d(n)).eq(r),r=n,t&&(u.matrix.isChanged(!0),e.isChanged(!0),e.triggerChange()))},enumerable:!0,configurable:!0}),e.setMatrix=function(n){return arguments.length&&(e.matrix=n),e},b(e,"_points",{get:function(){return null==i&&(i=!r||r.eq(m)?e.points.map(function(n){return n.clone()}):e.points.map(function(n){return r.transform(n)})),i},set:function(n){null==n&&(i=null)},enumerable:!1,configurable:!0}),b(e,"_lines",{get:function(){return null==o&&(o=function(n,t,e,r,i){null==t&&(t=f);null==e&&(e=h);var o,u,s,a=[];if(r)for(s=n(0),i&&(s.t=0),a.push(s),o=0;o<t;++o)!function n(t,e,r,i,o,u,s,a){if(i<=r||Rn(r,i))return;var l=(r+i)/2,c=u||e(r),u=s||e(i),s=e(l);q(s,c,u)<=o?(a&&(u.t=i),t.push(u)):(n(t,e,r,l,o,c,s,a),n(t,e,l,i,o,s,u,a))}(a,n,0===o?0:o/t,t===o+1?1:(o+1)/t,e,null,null,i);else for(o=0;o<=t;++o)s=n(u=0===o?0:t===o?1:o/t),i&&(s.t=u),a.push(s);return a}(e.f.bind(e),f,h,!0,!0)),o},set:function(n){null==n&&(o=null)},enumerable:!1,configurable:!0}),b(e,"values",{get:function(){return u},set:function(n){null==n&&(u=null)},enumerable:!1,configurable:!0}),b(e,"length",{get:function(){return 0},enumerable:!0,configurable:!0}),b(e,"area",{get:function(){return 0},enumerable:!0,configurable:!0}),b(e,"_bbox",{get:function(){return{ymin:-1/0,xmin:-1/0,ymax:1/0,xmax:1/0}},enumerable:!1,configurable:!0}),b(e,"_hull",{get:function(){var n=null,n=null==s?s=e._bbox:e._bbox;return null!=a&&s===n||(a=[new G((s=n).xmin,n.ymin),new G(n.xmax,n.ymin),new G(n.xmax,n.ymax),new G(n.xmin,n.ymax)]),a},enumerable:!1,configurable:!0})},name:"Curve",dispose:function(){this.values=null,this.$super("dispose")},isChanged:function(n){var t=this;return!1===n&&(Object.keys(t.values).forEach(function(n){t.values[n].isChanged(!1)}),t.style.isChanged(!1)),!0===n&&(t._points=null,t._lines=null),t.$super("isChanged",arguments)},isConnected:function(){return!0},isClosed:function(){return!1},isConvex:function(){return!1},hasMatrix:function(){return!0},setMatrix:null,f:function(n){return{x:0,y:0}},fto:function(n){return self},d:function(){return this.clone()},getPointAt:function(n){if((n=it(n))<0||1<n)return null;n=this.f(n);return null==n?null:G(n)},curveUpTo:function(n){return Rn(n=Ln(it(n),0,1),1)?this:this.fto(n).setMatrix(this.matrix).setStyle(this.style.toObj())},getBoundingBox:function(){var n=this._bbox;return{ymin:n.ymin,xmin:n.xmin,ymax:n.ymax,xmax:n.xmax}},getConvexHull:function(){return this._hull.map(function(n){return n.clone()})},derivative:function(){var n=this.d();return this.hasMatrix()&&n.setMatrix(this.matrix.clone()),n.setStyle(this.style.toObj()),n},polylinePoints:function(){return this._lines.slice()},bezierPoints:function(n){return[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]},toTex:function(){return"\\text{Curve}"},toString:function(){return"Curve()"}}),n=e(i.Curve=A,{constructor:function(n,t){var e=this;null==n&&(n=[]),e.$super("constructor",[n,t]),b(e,"degree",{get:function(){return e.points.length-1},enumerable:!0,configurable:!1})},name:"Bezier",fto:function(n){return new this.constructor(Sn(n,this.points,!0).points)},d:function(){var n=this.points,t=n.length-1,n=i.Line&&this instanceof i.Line?new i.Line([{x:t*(n[1].x-n[0].x),y:t*(n[1].y-n[0].y)},{x:t*(n[1].x-n[0].x),y:t*(n[1].y-n[0].y)}]):i.QBezier&&this instanceof i.QBezier?new i.Line([{x:t*(n[1].x-n[0].x),y:t*(n[1].y-n[0].y)},{x:t*(n[2].x-n[1].x),y:t*(n[2].y-n[1].y)}]):i.CBezier&&this instanceof i.CBezier?new i.QBezier([{x:t*(n[1].x-n[0].x),y:t*(n[1].y-n[0].y)},{x:t*(n[2].x-n[1].x),y:t*(n[2].y-n[1].y)},{x:t*(n[3].x-n[2].x),y:t*(n[3].y-n[2].y)}]):new i.Line([{x:0,y:0},{x:0,y:0}]);return n},toTex:function(){return"\\text{"+this.name+": }\\left("+this.points.map(ot).join(",")+"\\right)"},toString:function(){return this.name+"("+this.points.map(rt).join(",")+")"}});i.Bezier=n;var V=e(A,{constructor:function n(t){var r=this,e=null,i=null;return t instanceof n?t:r instanceof n?(r.f=ct(t)?t:function(n){return{x:0,y:0}},r.$super("constructor",[[r.f(0),r.f(1)]]),b(r,"length",{get:function(){return null==e&&(e=fn(r._lines)),e},enumerable:!0,configurable:!1}),b(r,"_bbox",{get:function(){if(null==i){i={ymin:1/0,xmin:1/0,ymax:-1/0,xmax:-1/0};for(var n=0,t=r._lines,e=t.length;n<e;++n)i.ymin=C.min(i.ymin,t[n].y),i.ymax=C.max(i.ymax,t[n].y),i.xmin=C.min(i.xmin,t[n].x),i.xmax=C.max(i.xmax,t[n].x)}return i},enumerable:!1,configurable:!1}),void(r.isChanged=function(n){return!0===n&&(i=e=null),r.$super("isChanged",arguments)})):new n(t)},name:"ParametricCurve",clone:function(){return new V(this.f)},transform:function(n){return new V(this.f).setMatrix(n)},fto:function(t){var e=this.f,r=e(t);return new V(function(n){return t<n?{x:r.x,y:r.y}:e(n)})},hasPoint:function(n){return U(n,this._lines)},intersects:function(n){var t,e=this;return n instanceof G?!!e.hasPoint(n)&&[n]:i.Line&&n instanceof i.Line?!!(t=rn(e._lines,n._points[0],n._points[1]))&&t.map(G):i.Circle&&n instanceof i.Circle?!!(t=on(e._lines,n.center,n.radius))&&t.map(G):i.Ellipse&&n instanceof i.Ellipse?!!(t=un(e._lines,n.center,n.radiusX,n.radiusY,n.cs))&&t.map(G):i.Arc&&n instanceof i.Arc?!!(t=sn(e._lines,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta))&&t.map(G):i.QBezier&&n instanceof i.QBezier?!!(t=an(e._lines,n._points))&&t.map(G):i.CBezier&&n instanceof i.CBezier?!!(t=ln(e._lines,n._points))&&t.map(G):i.Polyline&&n instanceof i.Polyline?!!(t=cn(e._lines,n._points))&&t.map(G):i.Polygon&&n instanceof i.Polygon||n instanceof V?!!(t=cn(e._lines,n._lines))&&t.map(G):n instanceof v&&n.intersects(e)},intersectsSelf:function(){for(var n,t,e,r,i,o,u=[],s=this._lines,a=s.length,l=0;l<a&&!(a<=l+1);++l)for(t=l+2;t<a&&!(a<=t+1);++t)e=s[l],r=s[l+1],i=s[t],o=s[t+1],(n=W(e,r,i,o))&&(0===l&&t===a-2&&I(e,o)?n=n.filter(function(n){return!I(n,e)}):t===l+2&&I(r,i)&&(n=n.filter(function(n){return!I(n,r)})),u.push.apply(u,n));return!!u&&u.map(G)},bezierPoints:function(n){Rn(n=arguments.length?Ln(n,0,1):1,1)&&(n=1);for(var t=this._lines,e=t.length-1,r=[],i=0;i<e;++i){if(!(t[i+1].t<n)){r.push(Gn([t[i],t[i+1]],e*(n-i/e)));break}r.push(Gn([t[i],t[i+1]],1))}return r},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t._lines,r="M "+e.map(function(n){return rt(n.x)+" "+rt(n.y)}).join(" L ");return I(e[0],e[e.length-1])&&(r+=" Z"),arguments.length?Fn("path",{id:[t.id,!1],d:[r,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):r},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t,e=this._lines,r=e.length;for(n.beginPath(),n.moveTo(e[0].x,e[0].y),t=1;t<r;++t)n.lineTo(e[t].x,e[t].y);I(e[0],e[r-1])&&n.closePath()},toTex:function(){return"\\text{ParametricCurve("+this.id+")}"},toString:function(){return"ParametricCurve("+this.id+")"}});i.ParametricCurve=V;var j=/[M]/g,T=/^\s*(-?\s*\d+(?:\.\d+)?)\s+(-?\s*\d+(?:\.\d+)?)/,X=/(-?\s*\d+(?:\.\d+)?)\s+(-?\s*\d+(?:\.\d+)?)\s*$/,Y=e(A,{constructor:function n(t){var e,r,i,o,u=this,s=null,a=null,l=null,c=null,f=null;if(!(u instanceof n))return new n(t);null==t&&(t=[]),v.call(u),i=function(n){return n instanceof A&&n.onChange(e),n},o=function(n){return n instanceof A&&n.onChange(e,!1),n},(e=function(n){at(s)&&-1!==s.indexOf(n)&&(u.isChanged(!0),u.triggerChange())}).id=u.id,(r=function(){u.isChanged(!0),u.triggerChange()}).id=u.id,(s=Un(t,i,o)).onChange(r),b(u,"points",{get:function(){return null==a&&(a=s.reduce(function(n,t){return n.push.apply(n,t.points),n},[])),a},set:function(n){null==n&&(a=null)},enumerable:!0,configurable:!1}),b(u,"curves",{get:function(){return s},set:function(n){s!==n&&(at(s)&&Hn(s,o),at(n)?((s=Un(n,i,o)).onChange(r),u.isChanged(!0),u.triggerChange()):null==n&&(s=null))},enumerable:!0,configurable:!1}),b(u,"length",{get:function(){return null==l&&(l=s.reduce(function(n,t){return n+=t.length},0)),l},enumerable:!0,configurable:!1}),b(u,"area",{get:function(){return 0},enumerable:!0,configurable:!1}),b(u,"_bbox",{get:function(){return null==c&&(c=s.reduce(function(n,t){t=t.getBoundingBox();return n.ymin=C.min(n.ymin,t.ymin),n.xmin=C.min(n.xmin,t.xmin),n.ymax=C.max(n.ymax,t.ymax),n.xmax=C.max(n.xmax,t.xmax),n},{ymin:1/0,xmin:1/0,ymax:-1/0,xmax:-1/0})),c},enumerable:!1,configurable:!1}),b(u,"_hull",{get:function(){return null==f&&(f=hn(s.reduce(function(n,t){return n.push.apply(n,t._hull),n},[]))),f},enumerable:!1,configurable:!1}),u.isChanged=function(n){return!0===n&&(_area=l=a=null,f=c=null),v.prototype.isChanged.apply(u,arguments)}},name:"CompositeCurve",dispose:function(){var t=this;t.curves&&(Hn(t.curves,function(n){return n instanceof A&&n.onChange(t.id,!1),n}),t.curves=null,t.points=null),v.prototype.dispose.call(t)},clone:function(){return new Y(this.curves.map(function(n){return n.clone()}))},transform:function(t){return new Y(this.curves.map(function(n){return n.transform(t)}))},isConnected:function(){var n,t,e,r=this.curves,i=r.length-1;if(i<0)return!1;if(!r[0].isConnected())return!1;for(e=0;e<i;++e){if(n=r[e],!(t=r[e+1]).isConnected()||t.isClosed())return!1;if(n=n._points,t=t._points,!n[n.length-1].eq(t[0]))return!1}return!0},isClosed:function(n){if(!(n=!0===n||!1===n?n:this.isConnected()))return!1;var t=this.curves,n=t.length;return!!n&&(!(1!==n||!t[0].isClosed())||t[0]._points[0].eq(t[n-1]._points[t[n-1]._points.length-1]))},f:function(n){var t=this.curves,e=t.length-1,r=C.floor(n*e);return 1===n?t[e].f(n):t[r].f(e*(n-r/e))},fto:function(n){var t=this.curves,e=t.length-1,r=C.floor(n*e);return new Y(t.slice(0,r).concat([t[r].curveUpTo(1===n?1:e*(n-r/e))]))},derivative:function(){return new Y(this.curves.map(function(n){return n.derivative()}))},hasPoint:function(n){for(var t=this.curves,e=t.length,r=0;r<e;++r)if(t[r].hasPoint(n))return!0;return!1},intersects:function(n){if(n instanceof G)return!!this.hasPoint(n)&&[n];if(n instanceof v){for(var t,e=[],r=this.curves,i=r.length,o=0;o<i;++o)(t=r[o].intersects(n))&&e.push.apply(e,t);return!!e&&e.map(G)}return!1},intersectsSelf:function(){for(var n,t,e,r,i,o,u=[],s=this.curves,a=s.length,l=0;l<a;++l)for((n=s[l].intersectsSelf())&&u.push.apply(u,n),t=l+1;t<a;++t)(n=s[l].intersects(s[t]))&&(e=s[l]._points[0],r=s[l]._points[s[l]._points.length-1],i=s[t]._points[0],o=s[t]._points[s[t]._points.length-1],0===l&&t===a-1&&I(e,o)?n=n.filter(function(n){return!I(n,e)}):t===l+1&&I(r,i)&&(n=n.filter(function(n){return!I(n,r)})),u.push.apply(u,n));return!!u&&u.map(G)},polylinePoints:function(){return this.curves.reduce(function(n,t){return n.push.apply(n,t.polylinePoints()),n},[])},bezierPoints:function(n){Rn(n=arguments.length?Ln(n,0,1):1,1)&&(n=1);for(var t=this.curves,e=t.length-1,r=C.floor(n*e),i=[],o=0;o<r;++o)i.push.apply(i,t[o].bezierPoints(1));return i.push.apply(i,t[r].bezierPoints(1===n?1:e*(n-r/e))),i},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var i,t=this,e=t.curves,r=t.isConnected(),o=t.isClosed(r),u=e.map(function(n){return n.toSVGPath()}).join(" ");return r&&(r=u.match(j),i=u.split(j),u=r.reduce(function(n,t,e){var r;return"M"===t&&(t=(r=i[e+1]||"").match(T),e=(i[e]||"").match(X),r=t&&e&&Rn(it(t[1]),it(e[1]))&&Rn(it(t[2]),it(e[2]))?(n=Kn(n),r.slice(t[0].length)):"M"+r,n+=r),n},i[0]||"")+(o&&1<e.length?" Z":"")),arguments.length?Fn("path",{id:[t.id,!1],d:[u,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):u},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t,e,r,i,o,u,s=this.curves,a=s.length;if(a){for(e=this.isConnected(),r=this.isClosed(e),n.beginPath(),e&&(n.moveTo(s[0]._points[0].x,s[0]._points[0].y),i=n.moveTo,o=n.beginPath,u=n.closePath,n.moveTo=x,n.beginPath=x,n.closePath=x),t=0;t<a;++t)s[t].toCanvasPath(n);e&&(n.moveTo=i,n.beginPath=o,n.closePath=u,r&&n.closePath())}},toTex:function(){return"\\text{CompositeCurve: }\\begin{cases}&"+this.curves.map(ot).join("\\\\&")+"\\end{cases}"},toString:function(){return"CompositeCurve(\n"+this.curves.map(rt).join("\n")+"\n)"}});i.CompositeCurve=Y;var z=e(n,{constructor:function n(t,e){var o=this,r=null,u=null;return t instanceof n?t:o instanceof n?(at(t)&&null==e&&(e=t[1],t=t[0]),o.$super("constructor",[[t,e]]),b(o,"start",{get:function(){return o.points[0]},set:function(n){o.points[0]=n},enumerable:!0,configurable:!1}),b(o,"end",{get:function(){return o.points[1]},set:function(n){o.points[1]=n},enumerable:!0,configurable:!1}),b(o,"_lines",{get:function(){return o._points},set:function(n){},enumerable:!1,configurable:!1}),b(o,"length",{get:function(){var n;return null==r&&(n=o._points,r=Yn(n[0],n[1])),r},enumerable:!0,configurable:!1}),b(o,"_bbox",{get:function(){var n,t,e,r,i;return null==u&&(n=(r=o._points)[0],i=r[1],t=C.min(n.x,i.x),e=C.max(n.x,i.x),r=C.min(n.y,i.y),i=C.max(n.y,i.y),u={ymin:r,xmin:t,ymax:i,xmax:e}),u},enumerable:!1,configurable:!1}),void(o.isChanged=function(n){return!0===n&&(u=r=null),o.$super("isChanged",arguments)})):new n(t,e)},name:"Line",clone:function(){return new z(this.start.clone(),this.end.clone())},transform:function(n){return new z(this.start.transform(n),this.end.transform(n))},f:function(n){return _n(n,this._points)},hasPoint:function(n){var t=this._points;return!!N(n,t[0],t[1])},intersects:function(n){var t,e,r=this;return n instanceof G?!!(t=N(n,(e=r._points)[0],e[1]))&&[n]:n instanceof z?!!(t=W((e=r._points)[0],e[1],n._points[0],n._points[1]))&&[G(t)]:i.Circle&&n instanceof i.Circle?!!(t=J((e=r._points)[0],e[1],n.center,n.radius))&&t.map(G):i.Ellipse&&n instanceof i.Ellipse?!!(t=K((e=r._points)[0],e[1],n.center,n.radiusX,n.radiusY,n.cs))&&t.map(G):i.Arc&&n instanceof i.Arc?!!(t=nn((e=r._points)[0],e[1],null,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta))&&t.map(G):i.QBezier&&n instanceof i.QBezier?!!(t=tn((e=r._points)[0],e[1],null,n._points))&&t.map(G):i.CBezier&&n instanceof i.CBezier?!!(t=en((e=r._points)[0],e[1],null,n._points))&&t.map(G):n instanceof v&&n.intersects(this)},distanceToPoint:function(n){return R(n,this._points[0],this._points[1])},bezierPoints:function(n){return Rn(n=arguments.length?Ln(n,0,1):1,1)&&(n=1),[Gn(this._points,n)]},toSVG:function(n){var t=this,e=t._points;return Fn("line",{id:[t.id,!1],x1:[e[0].x,t.start.isChanged()||t.values.matrix.isChanged()],y1:[e[0].y,t.start.isChanged()||t.values.matrix.isChanged()],x2:[e[1].x,t.end.isChanged()||t.values.matrix.isChanged()],y2:[e[1].y,t.end.isChanged()||t.values.matrix.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t._points,e=["M",e[0].x,e[0].y,"L",e[1].x,e[1].y].join(" ");return arguments.length?Fn("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),n.stroke()},toCanvasPath:function(n){var t=this._points[0],e=this._points[1];n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y)},toTex:function(){var n=this.start,t=this.end;return"\\text{Line: }"+tt(t.y-n.y,!1)+" \\cdot x "+tt(n.x-t.x)+" \\cdot y "+tt(t.x*n.y-n.x*t.y)+" = 0\\text{, }"+rt(C.min(n.x,t.x))+" \\le x \\le "+rt(C.max(n.x,t.x))+"\\text{, }"+rt(C.min(n.y,t.y))+" \\le y \\le "+rt(C.max(n.y,t.y))},toString:function(){return"Line("+[rt(this.start),rt(this.end)].join(",")+")"}});i.Line=z;var B=e(A,{constructor:function n(t){var i=this,e=null,r=null,o=null,u=null;return t instanceof n?t:i instanceof n?(i.$super("constructor",[t]),b(i,"lines",{get:function(){var r=i.points;return 1<r.length?r.reduce(function(n,t,e){return e+1<r.length&&(n[e]=new z(t,r[e+1])),n},new Array(r.length-1)):[]},enumerable:!0,configurable:!1}),b(i,"_lines",{get:function(){return i._points},enumerable:!1,configurable:!1}),b(i,"length",{get:function(){return null==e&&(e=fn(i._points)),e},enumerable:!0,configurable:!1}),b(i,"_bbox",{get:function(){if(null==r){r={ymin:1/0,xmin:1/0,ymax:-1/0,xmax:-1/0};for(var n=0,t=i._points,e=t.length;n<e;++n)r.ymin=C.min(r.ymin,t[n].y),r.ymax=C.max(r.ymax,t[n].y),r.xmin=C.min(r.xmin,t[n].x),r.xmax=C.max(r.xmax,t[n].x)}return r},enumerable:!1,configurable:!1}),b(i,"_hull",{get:function(){return null==o&&(o=hn(i._points).map(G)),o},enumerable:!1,configurable:!1}),b(i,"_is_convex",{get:function(){return!!i.isClosed()&&(null==u&&(u=gn(i._points)),u)},enumerable:!1,configurable:!1}),void(i.isChanged=function(n){return!0===n&&(u=o=r=e=null),i.$super("isChanged",arguments)})):new n(t)},name:"Polyline",clone:function(){return new B(this.points.map(function(n){return n.clone()}))},transform:function(t){return new B(this.points.map(function(n){return n.transform(t)}))},isClosed:function(){var n=this.points;return 2<n.length&&n[0].eq(n[n.length-1])},isConvex:function(){return this._is_convex},f:function(n){var t=this._points,e=t.length-1,r=C.floor(n*e);return 1===n?{x:t[e].x,y:t[e].y}:_n(e*(n-r/e),[t[r],t[r+1]])},fto:function(n){var t=this.points,e=t.length-1,r=C.floor(n*e);return new B(t.slice(0,r+1).concat([_n(e*(n-r/e),[t[r],t[r+1]])]))},hasPoint:function(n){return U(n,this._points)},hasInsidePoint:function(n,t){if(!this.isClosed())return!1;n=H(n,{x:this._bbox.xmax+10,y:n.y},this._points);return t?1===n:0<n},intersects:function(n){var t,e=this;return n instanceof G?!!e.hasPoint(n)&&[n]:i.Line&&n instanceof i.Line?!!(t=rn(e._points,n._points[0],n._points[1]))&&t.map(G):i.Circle&&n instanceof i.Circle?!!(t=on(e._points,n.center,n.radius))&&t.map(G):i.Ellipse&&n instanceof i.Ellipse?!!(t=un(e._points,n.center,n.radiusX,n.radiusY,n.cs))&&t.map(G):i.Arc&&n instanceof i.Arc?!!(t=sn(e._points,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta))&&t.map(G):i.QBezier&&n instanceof i.QBezier?!!(t=an(e._points,n._points))&&t.map(G):i.CBezier&&n instanceof i.CBezier?!!(t=ln(e._points,n._points))&&t.map(G):n instanceof B?!!(t=cn(e._points,n._points))&&t.map(G):n instanceof v&&n.intersects(e)},intersectsSelf:function(){for(var n,t,e,r,i,o,u=[],s=this._points,a=s.length,l=0;l<a&&!(a<=l+1);++l)for(t=l+2;t<a&&!(a<=t+1);++t)e=s[l],r=s[l+1],i=s[t],o=s[t+1],(n=W(e,r,i,o))&&(0===l&&t===a-2&&I(e,o)?n=n.filter(function(n){return!I(n,e)}):t===l+2&&I(r,i)&&(n=n.filter(function(n){return!I(n,r)})),u.push.apply(u,n));return!!u&&u.map(G)},distanceToPoint:function(r){var i=this.points;return i.length?1===i.length?Xn(r.x-i[0].x,r.y-i[0].y):i.reduce(function(n,t,e){return e+1<i.length&&(n=C.min(n,R(r,i[e],i[e+1]))),n},1/0):NaN},bezierPoints:function(n){Rn(n=arguments.length?Ln(n,0,1):1,1)&&(n=1);for(var t=this._points,e=t.length-1,r=C.floor(n*e),i=new Array(1===n?r:r+1),o=0;o<r;++o)i[o]=Gn([t[o],t[o+1]],1);return n<1&&(i[r]=Gn([t[r],t[r+1]],e*(n-r/e))),i},toSVG:function(n){var t=this;return Fn("polyline",{id:[t.id,!1],points:[t._points.map(function(n){return rt(n.x)+" "+rt(n.y)}).join(" "),t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e="M "+t._points.map(function(n){return rt(n.x)+" "+rt(n.y)}).join(" L ")+(t.isClosed()?" Z":"");return arguments.length?Fn("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),elf.toCanvasPath(n),this.isClosed()&&"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t,e=this._points,r=e.length;for(n.beginPath(),n.moveTo(e[0].x,e[0].y),t=1;t<r;++t)n.lineTo(e[t].x,e[t].y);this.isClosed()&&n.closePath()},toTex:function(){return"\\text{Polyline: }\\begin{cases}&"+this.lines.map(ot).join("\\\\&")+"\\end{cases}"},toString:function(){return"Polyline("+this.points.map(rt).join(",")+")"}});i.Polyline=B;var M=e(A,{constructor:function n(t,e,r,i,o,u,s){var a,l=this,c=null,f=null,h=null,g=null,x=null,y=0,p=0,d=null,m=null,v=null;return t instanceof n?t:l instanceof n?(c=new S(C.abs(it(r))),f=new S(C.abs(it(i))),h=new S(o),y=C.cos(Qn(h.val())),p=C.sin(Qn(h.val())),g=new S(u?1:0),x=new S(s?1:0),l.$super("constructor",[[t,e],{radiusX:c,radiusY:f,angle:h,largeArc:g,sweep:x}]),b(l,"start",{get:function(){return l.points[0]},set:function(n){l.points[0]=n},enumerable:!0,configurable:!1}),b(l,"end",{get:function(){return l.points[1]},set:function(n){l.points[1]=n},enumerable:!0,configurable:!1}),b(l,"radiusX",{get:function(){return c.val()},set:function(n){c.val(C.abs(it(n))),c.isChanged()&&(l.isChanged(!0),l.triggerChange())},enumerable:!0,configurable:!1}),b(l,"radiusY",{get:function(){return f.val()},set:function(n){f.val(C.abs(it(n))),f.isChanged()&&(l.isChanged(!0),l.triggerChange())},enumerable:!0,configurable:!1}),b(l,"angle",{get:function(){return h.val()},set:function(n){h.val(n),y=C.cos(Qn(h.val())),p=C.sin(Qn(h.val())),h.isChanged()&&(l.isChanged(!0),l.triggerChange())},enumerable:!0,configurable:!1}),b(l,"largeArc",{get:function(){return g.val()},set:function(n){g.val(n?1:0),g.isChanged()&&(l.isChanged(!0),l.triggerChange())},enumerable:!0,configurable:!1}),b(l,"sweep",{get:function(){return x.val()},set:function(n){x.val(n?1:0),x.isChanged()&&(l.isChanged(!0),l.triggerChange())},enumerable:!0,configurable:!1}),b(l,"center",{get:function(){return l._params[0]},enumerable:!1,configurable:!1}),b(l,"theta",{get:function(){return l._params[1]},enumerable:!1,configurable:!1}),b(l,"dtheta",{get:function(){return l._params[2]},enumerable:!1,configurable:!1}),b(l,"rX",{get:function(){return l._params[3]},enumerable:!1,configurable:!1}),b(l,"rY",{get:function(){return l._params[4]},enumerable:!1,configurable:!1}),b(l,"cs",{get:function(){return[y,p]},enumerable:!1,configurable:!1}),b(l,"_params",{get:function(){return null==d&&(d=function(n,t,e,r,i,o,u,s,a){var l=a[0],c=a[1],f=l*(n-e)/2+c*(t-r)/2,h=-c*(n-e)/2+l*(t-r)/2,g=f*f,x=h*h,y=u*u,p=s*s,a=g/y+x/p;1<a&&(a=_(a),y=(u*=a)*u,p=(s*=a)*s);g=_($((y*p-y*x-p*g)/(y*x+p*g)))*(i===o?-1:1),i=g*u*h/s,g=-g*s*f/u,e=l*i-c*g+(n+e)/2,t=c*i+l*g+(t+r)/2,r=kn(1,0,(f-i)/u,(h-g)/s),g=kn((f-i)/u,(h-g)/s,(-f-i)/u,(-h-g)/s);g-=C.floor(g/P)*P,!o&&0<g&&(g-=P);o&&g<0&&(g+=P);return[{x:e,y:t},r,g,u,s]}(l.start.x,l.start.y,l.end.x,l.end.y,l.largeArc,l.sweep,l.radiusX,l.radiusY,l.cs)),d},enumerable:!1,configurable:!1}),b(l,"length",{get:function(){return null==m&&(m=fn(l._lines)),m},enumerable:!0,configurable:!1}),b(l,"_bbox",{get:function(){return null==v&&(v=a(l.start,l.end,l.center.x,l.center.y,l.rX,l.rY,l.theta,l.dtheta,l.angle,l.sweep)),v},enumerable:!(a=function(n,t,e,r,i,o,u,s,a,l){var c,f,h,g=u+s,x=!1,s=C.tan(Qn(a));return l||(c=u,u=g,g=c),g<u&&(c=u,u=g,g=c,x=!0),(c=C.atan2(-o*s,i))<0&&(c+=P),a=Vn(c,e,r,i,o,y,p),l=Vn(c+=w,e,r,i,o,y,p),(c=C.atan2(o,i*s))<0&&(c+=P),s=Vn(c,e,r,i,o,y,p),i=Vn(c+=w,e,r,i,o,y,p),o=l.x<a.x?(f=l,a):(f=a,l),a=s.y<i.y?(h=s,i):(h=i,s),l=kn(1,0,f.x-e,f.y-r),i=kn(1,0,o.x-e,o.y-r),s=kn(1,0,h.x-e,h.y-r),r=kn(1,0,a.x-e,a.y-r),l<0&&(l+=P),P<l&&(l-=P),i<0&&(i+=P),P<i&&(i-=P),s<0&&(s+=P),P<s&&(s-=P),r<0&&(r+=P),P<r&&(r-=P),(!x&&(l<u||g<l)||x&&!(l<u||g<l))&&(f=n.x<t.x?n:t),(!x&&(i<u||g<i)||x&&!(i<u||g<i))&&(o=n.x>t.x?n:t),(!x&&(s<u||g<s)||x&&!(s<u||g<s))&&(h=n.y<t.y?n:t),(!x&&(r<u||g<r)||x&&!(r<u||g<r))&&(a=n.y>t.y?n:t),{ymin:h.y,xmin:f.x,ymax:a.y,xmax:o.x}}),configurable:!1}),void(l.isChanged=function(n){return!0===n&&(v=m=d=null),l.$super("isChanged",arguments)})):new n(t,e,r,i,o,u,s)},name:"Arc",clone:function(){var n=this;return new M(n.start.clone(),n.end.clone(),n.radiusX,n.radiusY,n.angle,n.largeArc,n.sweep)},transform:function(n){var t=this,e=t.radiusX,r=t.radiusY,i=t.angle,o=On(n.getRotationAngle()),u=n.getScale();return new M(t.start.transform(n),t.end.transform(n),e*u.x,r*u.y,i+o,t.largeArc,t.sweep)},isClosed:function(){return!1},isConvex:function(){return!1},hasMatrix:function(){return!1},f:function(n){var t=this,e=t.center,r=t.cs;return Vn(t.theta+n*t.dtheta,e.x,e.y,t.rX,t.rY,r[0],r[1])},fto:function(n){var t=this;return new M(t.start,t.f(n),t.radiusX,t.radiusY,t.angle,t.largeArc,t.sweep)},d:function(){var n,t,e,r,i,o,u,s=this,u=(n=s.center.x,t=s.center.y,e=s.rY,r=s.rX,i=[s.cs[0],-s.cs[1]],o=-s.theta,u=-s.dtheta,{p0:Vn(o,n,t,e,r,i[0],i[1]),p1:Vn(o+u,n,t,e,r,i[0],i[1]),fa:$(u)>w,fs:0<u});return new M(u.p0,u.p1,-s.angle,u.fa,u.fs)},hasPoint:function(n){var t=this;return Z(n,t.center,t.rX,t.rY,t.cs,t.theta,t.dtheta)},hasInsidePoint:function(n,t){return!t&&this.hasPoint(n)},intersects:function(n){var t,e=this;return n instanceof G?!!e.hasPoint(n)&&[n]:i.Circle&&n instanceof i.Circle?!!(t=on(e._lines,n.center,n.radius))&&t.map(G):i.Ellipse&&n instanceof i.Ellipse?!!(t=un(e._lines,n.center,n.radiusX,n.radiusY,n.cs))&&t.map(G):n instanceof M?!!(t=sn(e._lines,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta))&&t.map(G):n instanceof v&&n.intersects(e)},bezierPoints:function(n){Rn(n=arguments.length?Ln(n,0,1):1,1)&&(n=1);var t=this,e=t.center,r=t.cs;return An(e.x,e.y,t.rX,t.rY,r[0],r[1],t.theta,n*t.dtheta)},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t.start,r=t.end,i=t.radiusX,o=t.radiusY,u=t.angle,s=t.largeArc?1:0,a=t.sweep?1:0,r=["M",e.x,e.y,"A",i,o,u,s,a,r.x,r.y].join(" ");return arguments.length?Fn("path",{id:[t.id,!1],d:[r,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):r},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),n.stroke()},toCanvasPath:function(n){var t=this,e=t.center,r=t.rX,i=t.rY,o=!t.sweep,u=Qn(t.angle),s=t.theta,t=t.dtheta;n.beginPath(),n.ellipse(e.x,e.y,r,i,u,s,s+t,o),$(t)+a>=P&&n.closePath()},toTex:function(){var n=this;return"\\text{Arc: }\\left("+[ot(n.start),ot(n.end),rt(n.radiusX),rt(n.radiusY),rt(n.angle)+"\\text{°}",rt(n.largeArc?1:0),rt(n.sweep?1:0)].join(",")+"\\right)"},toString:function(){var n=this;return"Arc("+[rt(n.start),rt(n.end),rt(n.radiusX),rt(n.radiusY),rt(n.angle)+"°",rt(n.largeArc),rt(n.sweep)].join(",")+")"}});i.Arc=M;var k=e(n,{constructor:function n(t){var r,i=this,e=null,o=null,u=null;return t instanceof n?t:i instanceof n?(i.$super("constructor",[t]),b(i,"length",{get:function(){return null==e&&(e=fn(i._lines)),e},enumerable:!0,configurable:!1}),b(i,"_bbox",{get:function(){return null==o&&(o=r(i._points)),o},enumerable:!(r=function(t){var n=xn(t[0].x-2*t[1].x+t[2].x,t[1].x-t[0].x),e=!1===n?[t[1]]:n.map(function(n){return 0<=n&&n<=1?wn(n,t):t[1]}),r=xn(t[0].y-2*t[1].y+t[2].y,t[1].y-t[0].y),n=!1===r?[t[1]]:r.map(function(n){return 0<=n&&n<=1?wn(n,t):t[1]}),r=C.min.apply(C,e.concat([t[0],t[2]]).map(Nn)),e=C.max.apply(C,e.concat([t[0],t[2]]).map(Nn));return{ymin:C.min.apply(C,n.concat([t[0],t[2]]).map(Zn)),xmin:r,ymax:C.max.apply(C,n.concat([t[0],t[2]]).map(Zn)),xmax:e}}),configurable:!1}),b(i,"_hull",{get:function(){var t,n,e;return null==u&&(n=Tn(e=i._points),t=d.rotate(n.R).mul(d.translate(n.Tx,n.Ty)),n=r(e.map(function(n){return t.transform(n,{x:0,y:0})})),e=t.inv(),u=[e.transform(new G(n.xmin,n.ymin)),e.transform(new G(n.xmax,n.ymin)),e.transform(new G(n.xmax,n.ymax)),e.transform(new G(n.xmin,n.ymax))]),u},enumerable:!1,configurable:!1}),void(i.isChanged=function(n){return!0===n&&(u=o=e=null),i.$super("isChanged",arguments)})):new n(t)},name:"QBezier",clone:function(){return new k(this.points.map(function(n){return n.clone()}))},transform:function(t){return new k(this.points.map(function(n){return n.transform(t)}))},f:function(n){return wn(n,this._points)},hasPoint:function(n){return function(n,t){var e;if(!(e=yn(t[0].x-2*t[1].x+t[2].x,-2*t[0].x+2*t[1].x,t[0].x-n.x)))return!1;1<e.length&&(e[1]<0||1<e[1])&&e.pop();e.length&&(e[0]<0||1<e[0])&&e.shift();if(!e.length)return!1;if(!(n=yn(t[0].y-2*t[1].y+t[2].y,-2*t[0].y+2*t[1].y,t[0].y-n.y)))return!1;1<n.length&&(n[1]<0||1<n[1])&&n.pop();n.length&&(n[0]<0||1<n[0])&&n.shift();if(!n.length)return!1;{if(1<e.length&&1<n.length)return Rn(e[0],n[0])&&Rn(e[1],n[1])||Rn(e[0],n[1])&&Rn(e[1],n[0]);if(1<e.length&&1===n.length)return Rn(e[0],n[0])||Rn(e[1],n[0]);if(1<n.length&&1===e.length)return Rn(n[0],e[0])||Rn(n[1],e[0])}return Rn(e[0],n[0])}(n,this._points)},intersects:function(n){var t,e=this;return n instanceof G?!!e.hasPoint(n)&&[n]:i.Circle&&n instanceof i.Circle?!!(t=on(e._lines,n.center,n.radius))&&t.map(G):i.Ellipse&&n instanceof i.Ellipse?!!(t=un(e._lines,n.center,n.radiusX,n.radiusY,n.cs))&&t.map(G):i.Arc&&n instanceof i.Arc?!!(t=sn(e._lines,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta))&&t.map(G):n instanceof k?!!(t=an(e._lines,n._points))&&t.map(G):n instanceof v&&n.intersects(e)},bezierPoints:function(n){return Rn(n=arguments.length?Ln(n,0,1):1,1)&&(n=1),[Gn(this._points,n)]},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t._points,e=["M",e[0].x,e[0].y,"Q",e[1].x,e[1].y,e[2].x,e[2].y].join(" ");return arguments.length?Fn("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),n.stroke()},toCanvasPath:function(n){var t=this._points;n.beginPath(),n.moveTo(t[0].x,t[0].y),n.quadraticCurveTo(t[1].x,t[1].y,t[2].x,t[2].y)}});i.QBezier=k;var E=e(n,{constructor:function n(t){var r,i=this,e=null,o=null,u=null;return t instanceof n?t:i instanceof n?(i.$super("constructor",[t]),b(i,"length",{get:function(){return null==e&&(e=fn(i._lines)),e},enumerable:!0,configurable:!1}),b(i,"_bbox",{get:function(){return null==o&&(o=r(i._points)),o},enumerable:!(r=function(e){var n=yn(3*(-e[0].x+3*e[1].x-3*e[2].x+e[3].x),2*(3*e[0].x-6*e[1].x+3*e[2].x),-3*e[0].x+3*e[1].x),t=!1===n?[e[1],e[2]]:n.map(function(n,t){return 0<=n&&n<=1?Pn(n,e):e[t+1]}),r=yn(3*(-e[0].y+3*e[1].y-3*e[2].y+e[3].y),2*(3*e[0].y-6*e[1].y+3*e[2].y),-3*e[0].y+3*e[1].y),n=!1===r?[e[1],e[2]]:r.map(function(n,t){return 0<=n&&n<=1?Pn(n,e):e[t+1]}),r=C.min.apply(C,t.concat([e[0],e[3]]).map(Nn)),t=C.max.apply(C,t.concat([e[0],e[3]]).map(Nn));return{ymin:C.min.apply(C,n.concat([e[0],e[3]]).map(Zn)),xmin:r,ymax:C.max.apply(C,n.concat([e[0],e[3]]).map(Zn)),xmax:t}}),configurable:!1}),b(i,"_hull",{get:function(){var t,n,e;return null==u&&(n=Tn(e=i._points),t=d.rotate(n.R).mul(d.translate(n.Tx,n.Ty)),n=r(e.map(function(n){return t.transform(n,{x:0,y:0})})),e=t.inv(),u=[e.transform(new G(n.xmin,n.ymin)),e.transform(new G(n.xmax,n.ymin)),e.transform(new G(n.xmax,n.ymax)),e.transform(new G(n.xmin,n.ymax))]),u},enumerable:!1,configurable:!1}),void(i.isChanged=function(n){return!0===n&&(u=o=e=null),i.$super("isChanged",arguments)})):new n(t)},name:"CBezier",clone:function(){return new E(this.points.map(function(n){return n.clone()}))},transform:function(t){return new E(this.points.map(function(n){return n.transform(t)}))},f:function(n){return Pn(n,this._points)},hasPoint:function(n){return function(n,t){var e;if(!(e=pn(-t[0].x+3*t[1].x-3*t[2].x+t[3].x,3*t[0].x-6*t[1].x+3*t[2].x,-3*t[0].x+3*t[1].x,t[0].x-n.x)))return!1;2<e.length&&(e[2]<0||1<e[2])&&e.pop();1<e.length&&(e[1]<0||1<e[1])&&e.splice(1,1);e.length&&(e[0]<0||1<e[0])&&e.shift();if(!e.length)return!1;if(!(n=pn(-t[0].y+3*t[1].y-3*t[2].y+t[3].y,3*t[0].y-6*t[1].y+3*t[2].y,-3*t[0].y+3*t[1].y,t[0].y-n.y)))return!1;2<n.length&&(n[2]<0||1<n[2])&&n.pop();1<n.length&&(n[1]<0||1<n[1])&&n.splice(1,1);n.length&&(n[0]<0||1<n[0])&&n.shift();if(!n.length)return!1;{if(2<e.length&&2<n.length)return Rn(e[0],n[0])&&(Rn(e[1],n[1])&&Rn(e[2],n[2])||Rn(e[1],n[2])&&Rn(e[2],n[1]))||Rn(e[1],n[1])&&Rn(e[0],n[2])&&Rn(e[2],n[0])||Rn(e[2],n[2])&&Rn(e[0],n[1])&&Rn(e[1],n[0])||Rn(e[0],n[1])&&Rn(e[1],n[2])&&Rn(e[2],n[0])||Rn(e[0],n[2])&&Rn(e[1],n[0])&&Rn(e[2],n[1]);if(2<e.length&&1<n.length)return Rn(e[0],n[0])&&(Rn(e[1],n[1])||Rn(e[2],n[1]))||Rn(e[1],n[1])&&(Rn(e[0],n[0])||Rn(e[2],n[0]))||Rn(e[2],n[0])&&(Rn(e[1],n[1])||Rn(e[0],n[1]))||Rn(e[1],n[0])&&(Rn(e[2],n[1])||Rn(e[0],n[1]));if(1<e.length&&2<n.length)return Rn(n[0],e[0])&&(Rn(n[1],e[1])||Rn(n[2],e[1]))||Rn(n[1],e[1])&&(Rn(n[0],e[0])||Rn(n[2],e[0]))||Rn(n[2],e[0])&&(Rn(n[1],e[1])||Rn(n[0],e[1]))||Rn(n[1],e[0])&&(Rn(n[2],e[1])||Rn(n[0],e[1]));if(2<e.length&&1===n.length)return Rn(e[0],n[0])||Rn(e[1],n[0])||Rn(e[2],n[0]);if(2<n.length&&1===e.length)return Rn(n[0],e[0])||Rn(n[1],e[0])||Rn(n[2],e[0]);if(1<e.length&&1===n.length)return Rn(e[0],n[0])||Rn(e[1],n[0]);if(1<n.length&&1===e.length)return Rn(n[0],e[0])||Rn(n[1],e[0])}return Rn(e[0],n[0])}(n,this._points)},intersects:function(n){var t,e=this;return n instanceof G?!!e.hasPoint(n)&&[n]:i.Circle&&n instanceof i.Circle?!!(t=on(e._lines,n.center,n.radius))&&t.map(G):i.Ellipse&&n instanceof i.Ellipse?!!(t=un(e._lines,n.center,n.radiusX,n.radiusY,n.cs))&&t.map(G):i.Arc&&n instanceof i.Arc?!!(t=sn(e._lines,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta))&&t.map(G):i.QBezier&&n instanceof i.QBezier?!!(t=an(e._lines,n._points))&&t.map(G):n instanceof E?!!(t=ln(e._lines,n._points))&&t.map(G):n instanceof v&&n.intersects(e)},bezierPoints:function(n){return Rn(n=arguments.length?Ln(n,0,1):1,1)&&(n=1),[Gn(this._points,n)]},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t._points,e=["M",e[0].x,e[0].y,"C",e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y].join(" ");return arguments.length?Fn("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),n.stroke()},toCanvasPath:function(n){var t=this._points;n.beginPath(),n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y)}});i.CBezier=E;var L=e(A,{constructor:function n(t){var r=this,e=null,i=null,o=null,u=null,s=null;return t instanceof n?t:r instanceof n?(r.$super("constructor",[t]),b(r,"vertices",{get:function(){return r.points},set:function(n){r.points=n},enumerable:!0,configurable:!1}),b(r,"edges",{get:function(){var e=r.points;return 1<e.length?e.map(function(n,t){return new z(n,e[(t+1)%e.length])}):[]},enumerable:!0,configurable:!1}),b(r,"_lines",{get:function(){return r._points.concat([r._points[0]])},enumerable:!1,configurable:!1}),b(r,"length",{get:function(){return null==e&&(e=fn(r._lines)),e},enumerable:!0,configurable:!1}),b(r,"area",{get:function(){return null==i&&(i=function(n){for(var t,e,r=0,i=0,o=n.length-1;i<o;++i)t=n[i],e=n[i+1],r+=Bn(t.x,t.y,e.x,e.y)/2;return r}(r._lines)),i},enumerable:!0,configurable:!1}),b(r,"_bbox",{get:function(){if(null==o){o={ymin:1/0,xmin:1/0,ymax:-1/0,xmax:-1/0};for(var n=0,t=r._points,e=t.length;n<e;++n)o.ymin=C.min(o.ymin,t[n].y),o.ymax=C.max(o.ymax,t[n].y),o.xmin=C.min(o.xmin,t[n].x),o.xmax=C.max(o.xmax,t[n].x)}return o},enumerable:!1,configurable:!1}),b(r,"_hull",{get:function(){return null==u&&(u=hn(r._points).map(G)),u},enumerable:!1,configurable:!1}),b(r,"_is_convex",{get:function(){return null==s&&(s=gn(r._points)),s},enumerable:!1,configurable:!1}),void(r.isChanged=function(n){return!0===n&&(s=u=o=i=e=null),r.$super("isChanged",arguments)})):new n(t)},name:"Polygon",clone:function(){return new L(this.vertices.map(function(n){return n.clone()}))},transform:function(t){return new L(this.vertices.map(function(n){return n.transform(t)}))},isClosed:function(){return!0},isConvex:function(){return this._is_convex},f:function(n){var t=this._lines,e=t.length-1,r=C.floor(n*e);return 1===n?{x:t[e].x,y:t[e].y}:_n(e*(n-r/e),[t[r],t[r+1]])},fto:function(n){var t=this.points,e=t.length,r=C.floor(n*e);return new B(t.slice(0,r+1).concat([_n(e*(n-r/e),[t[r],t[(r+1)%e]])]))},hasPoint:function(n){return 2===H(n,{x:this._bbox.xmax+10,y:n.y},this._lines)},hasInsidePoint:function(n,t){n=H(n,{x:this._bbox.xmax+10,y:n.y},this._lines);return t?1===n:0<n},intersects:function(n){var t,e=this;return n instanceof G?!!e.hasPoint(n)&&[n]:i.Line&&n instanceof i.Line?!!(t=rn(e._lines,n._points[0],n._points[1]))&&t.map(G):i.Circle&&n instanceof i.Circle?!!(t=on(e._lines,n.center,n.radius))&&t.map(G):i.Ellipse&&n instanceof i.Ellipse?!!(t=un(e._lines,n.center,n.radiusX,n.radiusY,n.cs))&&t.map(G):i.Arc&&n instanceof i.Arc?!!(t=sn(e._lines,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta))&&t.map(G):i.QBezier&&n instanceof i.QBezier?!!(t=an(e._lines,n._points))&&t.map(G):i.CBezier&&n instanceof i.CBezier?!!(t=ln(e._lines,n._points))&&t.map(G):i.Polyline&&n instanceof i.Polyline||n instanceof L?!!(t=cn(e._lines,n._lines))&&t.map(G):n instanceof v&&n.intersects(e)},intersectsSelf:function(){for(var n,t,e,r,i,o,u=[],s=this._lines,a=s.length,l=0;l<a&&!(a<=l+1);++l)for(t=l+2;t<a&&!(a<=t+1);++t)e=s[l],r=s[l+1],i=s[t],o=s[t+1],(n=W(e,r,i,o))&&(0===l&&t===a-2&&I(e,o)?n=n.filter(function(n){return!I(n,e)}):t===l+2&&I(r,i)&&(n=n.filter(function(n){return!I(n,r)})),u.push.apply(u,n));return!!u&&u.map(G)},bezierPoints:function(n){Rn(n=arguments.length?Ln(n,0,1):1,1)&&(n=1);for(var t=this._lines,e=t.length-1,r=C.floor(n*e),i=new Array(1===n?r:r+1),o=0;o<r;++o)i[o]=Gn([t[o],t[o+1]],1);return n<1&&(i[r]=Gn([t[r],t[r+1]],e*(n-r/e))),i},toSVG:function(n){var t=this;return Fn("polygon",{id:[t.id,!1],points:[t._points.map(function(n){return rt(n.x)+" "+rt(n.y)}).join(" "),t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e="M "+t._lines.map(function(n){return rt(n.x)+" "+rt(n.y)}).join(" L ")+" Z";return arguments.length?Fn("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t,e=this._lines,r=e.length;for(n.beginPath(),n.moveTo(e[0].x,e[0].y),t=1;t<r;++t)n.lineTo(e[t].x,e[t].y);n.closePath()},toTex:function(){return"\\text{Polygon: }\\left("+this.vertices.map(ot).join(",")+"\\right)"},toString:function(){return"Polygon("+this.vertices.map(rt).join(",")+")"}}),n=e(i.Polygon=L,{constructor:function n(t,e,r){var i,o,u=this;return t instanceof n?t:u instanceof n?(i=G(t),o=ut(e)&&ut(r)?new G(i.x+it(e),i.y+it(r)):G(e),u.$super("constructor",[[i,new G(o.x,i.y),o,new G(i.x,o.y)]]),b(u,"topLeft",{get:function(){return u.points[0]},set:function(n){u.points[0]=n},enumerable:!0,configurable:!1}),b(u,"bottomRight",{get:function(){return u.points[2]},set:function(n){u.points[2]=n},enumerable:!0,configurable:!1}),b(u,"width",{get:function(){return $(u.bottomRight.x-u.topLeft.x)},set:function(n){u.bottomRight.x=u.topLeft.x+it(n)},enumerable:!0,configurable:!1}),void b(u,"height",{get:function(){return $(u.bottomRight.y-u.topLeft.y)},set:function(n){u.bottomRight.y=u.topLeft.y+it(n)},enumerable:!0,configurable:!1})):new n(t,e,r)}});i.Rect=n;var O=e(A,{constructor:function n(t,e){var r=this,i=null,o=null,u=null,s=null;return t instanceof n?t:r instanceof n?(i=new S(C.abs(it(e))),r.$super("constructor",[[t],{radius:i}]),b(r,"center",{get:function(){return r.points[0]},set:function(n){r.points[0]=n},enumerable:!0,configurable:!1}),b(r,"radius",{get:function(){return i.val()},set:function(n){i.val(C.abs(it(n))),i.isChanged()&&(r.isChanged(!0),r.triggerChange())},enumerable:!0,configurable:!1}),b(r,"length",{get:function(){return null==o&&(o=P*i.val()),o},enumerable:!0,configurable:!1}),b(r,"area",{get:function(){return null==u&&(u=w*i.val()*i.val()),u},enumerable:!0,configurable:!1}),b(r,"_bbox",{get:function(){var n,t;return null==s&&(n=r.center,t=i.val(),s={ymin:n.y-t,xmin:n.x-t,ymax:n.y+t,xmax:n.x+t}),s},enumerable:!1,configurable:!1}),void(r.isChanged=function(n){return!0===n&&(s=u=o=null),r.$super("isChanged",arguments)})):new n(t,e)},name:"Circle",clone:function(){return new O(this.center.clone(),this.radius)},transform:function(n){var t=this.center,e=this.radius,r=t.transform(n),n=new G(t.x+e,t.y+e).transform(n);return new O(r,Yn(r,n))},isClosed:function(){return!0},isConvex:function(){return!0},hasMatrix:function(){return!1},f:function(n){var t=this.center,e=this.radius;return Vn(n*P,t.x,t.y,e,e,1,0)},fto:function(n){return new M(this.f(0),this.f(n),this.radius,this.radius,0,w<n*P,1)},hasPoint:function(n){return self=this,2===D(n,self.center,self.radius)},hasInsidePoint:function(n,t){n=D(n,this.center,this.radius);return t?1===n:0<n},intersects:function(n){if(n instanceof G)return!!this.hasPoint(n)&&[n];if(n instanceof O){var t=function(n,t,e,r){{t<r&&(o=t,t=r,r=o,o=n,n=e,e=o)}var i=e.x-n.x,o=e.y-n.y,e=Xn(i,o);if(Rn(e,0)&&Rn(t,r))return!1;if(t+r<e||e+r<t)return!1;i/=e,o/=e;r=(t*t-r*r+e*e)/(2*e),e=n.x+r*i,n=n.y+r*o,r=_(t*t-r*r);return qn(r,0)?[{x:e,y:n}]:[{x:e+r*o,y:n-r*i},{x:e-r*o,y:n+r*i}]}(this.center,this.radius,n.center,n.radius);return!!t&&t.map(G)}return n instanceof v&&n.intersects(this)},bezierPoints:function(n){Rn(n=arguments.length?Ln(n,0,1):1,1)&&(n=1);var t=this.center;return An(t.x,t.y,this.radius,this.radius,1,0,0,-n*P)},toSVG:function(n){var t=this,e=t.center,r=t.radius;return Fn("circle",{id:[t.id,!1],cx:[e.x,t.center.isChanged()],cy:[e.y,t.center.isChanged()],r:[r,t.values.radius.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t.center,r=t.radius,e=["M",e.x-r,e.y,"A",r,r,0,0,0,e.x+r,e.y,"A",r,r,0,0,0,e.x-r,e.y,"Z"].join(" ");return arguments.length?Fn("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t=this.center,e=this.radius;n.beginPath(),n.arc(t.x,t.x,e,0,P),n.closePath()},toTex:function(){var n=this.center,t=rt(this.radius);return"\\text{Circle: }\\left|\\begin{pmatrix}\\frac{x"+tt(-n.x)+"}{"+t+"}\\\\\\frac{y"+tt(-n.y)+"}{"+t+"}\\end{pmatrix}\\right|^2 = 1"},toString:function(){return"Circle("+[rt(this.center),rt(this.radius)].join(",")+")"}});i.Circle=O;var Q=e(A,{constructor:function n(t,e,r,i){var s=this,a=null,l=null,o=null,c=0,f=0,u=null,h=null,g=null,x=null;return t instanceof n?t:s instanceof n?(a=new S(C.abs(it(e))),l=new S(C.abs(it(r))),o=new S(i),c=C.cos(Qn(o.val())),f=C.sin(Qn(o.val())),s.$super("constructor",[[t],{radiusX:a,radiusY:l,angle:o}]),b(s,"center",{get:function(){return s.points[0]},set:function(n){s.points[0]=n},enumerable:!0,configurable:!1}),b(s,"radiusX",{get:function(){return a.val()},set:function(n){a.val(C.abs(it(n))),a.isChanged()&&(s.isChanged(!0),s.triggerChange())},enumerable:!0,configurable:!1}),b(s,"radiusY",{get:function(){return l.val()},set:function(n){l.val(C.abs(it(n))),l.isChanged()&&(s.isChanged(!0),s.triggerChange())},enumerable:!0,configurable:!1}),b(s,"angle",{get:function(){return o.val()},set:function(n){o.val(n),c=C.cos(Qn(o.val())),f=C.sin(Qn(o.val())),o.isChanged()&&(s.isChanged(!0),s.triggerChange())},enumerable:!0,configurable:!1}),b(s,"cs",{get:function(){return[c,f]},enumerable:!1,configurable:!1}),b(s,"length",{get:function(){return null==u&&(u=w*(3*(a.val()+l.val())-_((3*a.val()+l.val())*(a.val()+3*l.val())))),u},enumerable:!0,configurable:!1}),b(s,"area",{get:function(){return null==h&&(h=w*a.val()*l.val()),h},enumerable:!0,configurable:!1}),b(s,"_bbox",{get:function(){var n,t,e,r,i,o,u;return null==g&&(n=s.center,t=a.val(),u=l.val(),o=C.tan(Qn(s.angle)),r=Vn(e=C.atan2(-u*o,t),n.x,n.y,t,u,c,f),i=Vn(e+w,n.x,n.y,t,u,c,f),o=Vn(e=C.atan2(u,t*o),n.x,n.y,t,u,c,f),u=Vn(e+w,n.x,n.y,t,u,c,f),g={ymin:C.min(o.y,u.y),xmin:C.min(r.x,i.x),ymax:C.max(o.y,u.y),xmax:C.max(r.x,i.x)}),g},enumerable:!1,configurable:!1}),b(s,"_hull",{get:function(){var n,t,e;return null==x&&(n=s.center,t=a.val(),e=l.val(),x=[new G(jn(-1,-1,n.x,n.y,t,e,c,f)),new G(jn(1,-1,n.x,n.y,t,e,c,f)),new G(jn(1,1,n.x,n.y,t,e,c,f)),new G(jn(-1,1,n.x,n.y,t,e,c,f))]),x},enumerable:!1,configurable:!1}),void(s.isChanged=function(n){return!0===n&&(x=g=h=u=null),s.$super("isChanged",arguments)})):new n(t,e,r,i)},name:"Ellipse",clone:function(){return new Q(this.center.clone(),this.radiusX,this.radiusY,this.angle)},transform:function(n){var t=this.center,e=this.radiusX,r=this.radiusY,i=this.angle,o=n.getTranslation(),u=On(n.getRotationAngle()),n=n.getScale();return new Q(new G(t.x+o.x,t.y+o.y),e*n.x,r*n.y,i+u)},isClosed:function(){return!0},isConvex:function(){return!0},hasMatrix:function(){return!1},f:function(n){var t=this.center,e=this.cs;return Vn(n*P,t.x,t.y,this.radiusX,this.radiusY,e[0],e[1])},fto:function(n){var t=this;return new M(t.f(0),t.f(n),t.radiusX,t.radiusY,t.angle,w<n*P,1)},d:function(){return new Q(this.center,this.radiusY,this.radiusX,-this.angle)},hasPoint:function(n){return 2===F(n,this.center,this.radiusX,this.radiusY,this.cs)},hasInsidePoint:function(n,t){n=F(n,this.center,this.radiusX,this.radiusY,this.cs);return t?1===n:0<n},intersects:function(n){var t;return n instanceof G?!!this.hasPoint(n)&&[n]:i.Circle&&n instanceof i.Circle?!!(t=on(this._lines,n.center,n.radius))&&t.map(G):n instanceof Q?!!(t=un(this._lines,n.center,n.radiusX,n.radiusY,n.cs))&&t.map(G):n instanceof v&&n.intersects(this)},bezierPoints:function(n){Rn(n=arguments.length?Ln(n,0,1):1,1)&&(n=1);var t=this.center,e=this.cs;return An(t.x,t.y,this.radiusX,this.radiusY,e[0],e[1],0,-n*P)},toSVG:function(n){var t=this,e=t.center,r=t.radiusX,i=t.radiusY,o=t.angle;return Fn("ellipse",{id:[t.id,!1],cx:[e.x,t.center.isChanged()],cy:[e.y,t.center.isChanged()],rx:[r,t.values.radiusX.isChanged()],ry:[i,t.values.radiusY.isChanged()],transform:["rotate("+rt(o)+" "+rt(e.x)+" "+rt(e.y)+")",t.center.isChanged()||t.values.angle.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t.radiusX,r=t.radiusY,i=t.angle,o=t.f(0),u=t.f(.5),o=["M",o.x,o.y,"A",e,r,i,0,1,u.x,u.y,"A",e,r,i,0,1,o.x,o.y,"Z"].join(" ");return arguments.length?Fn("path",{id:[t.id,!1],d:[o,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):o},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t=this.center,e=this.radiusX,r=this.radiusY,i=Qn(this.angle);n.beginPath(),n.ellipse(t.x,t.x,e,r,i,0,P),n.closePath()},toTex:function(){var n=rt(this.angle)+"\\text{°}",t=this.center,e=rt(this.radiusX),r=rt(this.radiusY);return"\\text{Ellipse: }\\left|\\begin{pmatrix}\\cos("+n+")&-\\sin("+n+")\\\\sin("+n+")&\\cos("+n+")\\end{pmatrix}\\begin{pmatrix}\\frac{x"+tt(-t.x)+"}{"+e+"}\\\\\\frac{y"+tt(-t.y)+"}{"+r+"}\\end{pmatrix}\\right|^2 = 1"},toString:function(){return"Ellipse("+[rt(this.center),rt(this.radiusX),rt(this.radiusY),rt(this.angle)+"°"].join(",")+")"}});i.Ellipse=Q;n=e(v,{});i.Shape=n;n=e(null,{constructor:function n(t,i,o,u,s){var e,r,a,l=this,c=null,f=null,h=null,g=null,x=!0;if(!(l instanceof n))return new n(t,i,o,u,s);i=it(i),o=it(o),u=it(u),s=it(s),h=[],b(l,"x0",{get:function(){return i},set:function(n){n=it(n),i!==n&&(x=!0),i=n},enumerable:!0,configurable:!(f={})}),b(l,"x1",{get:function(){return u},set:function(n){n=it(n),u!==n&&(x=!0),u=n},enumerable:!0,configurable:!1}),b(l,"y0",{get:function(){return o},set:function(n){n=it(n),o!==n&&(x=!0),o=n},enumerable:!0,configurable:!1}),b(l,"y1",{get:function(){return s},set:function(n){n=it(n),s!==n&&(x=!0),s=n},enumerable:!0,configurable:!1}),l.add=function(n){return n instanceof v&&(y.call(f,n.id)||(f[n.id]=null,h.push(n),x=!0)),l},l.remove=function(n){var t,e=h.indexOf(n);return-1!==e&&(t=f[n.id],p&&t&&t.parentNode&&t.parentNode.removeChild(t),delete f[n.id],h.splice(e,1),x=!0),l},l.getIntersections=function(){if(!h||!h.length)return[];if(x||!g){g=[];for(var n,t,e=0,r=h.length;e<r;++e)for((t=h[e].intersectsSelf())&&g.push.apply(g,t),n=e+1;n<r;++n)(t=h[e].intersects(h[n]))&&g.push.apply(g,t)}return g?g.map(function(n){return n.clone()}):[]},l.dispose=function(){return p&&c&&c.parentNode&&c.parentNode.removeChild(c),p&&window.cancelAnimationFrame(a),h=f=c=null,l},l.toSVG=function(){return Fn("svg",{xmlns:["http://www.w3.org/2000/svg",!0],viewBox:[rt(i)+" "+rt(o)+" "+rt(u)+" "+rt(s),!0]},!1,h.map(function(n){return n instanceof v?n.toSVG():""}).join(""))},l.toCanvas=function(n){return p?r(n||document.createElement("canvas")):n},l.toIMG=function(){return p?l.toCanvas(document.createElement("canvas")).toDataURL("image/png"):""},e=function n(){h&&(c?x&&Fn("svg",{viewBox:[rt(i)+" "+rt(o)+" "+rt(u)+" "+rt(s),x]},c):(c=Fn("svg",{xmlns:["http://www.w3.org/2000/svg",!1],style:["position:absolute;top:0;left:0;width:100%;height:100%",!1],viewBox:[rt(i)+" "+rt(o)+" "+rt(u)+" "+rt(s),x]},null),t.appendChild(c)),h.forEach(function(n){var t;n instanceof v&&(null===(t=f[n.id])?(f[n.id]=t=n.toSVG(null),t&&c.appendChild(t)):t&&n.isChanged()&&n.toSVG(t),n.isChanged(!1))}),x=!1,a=window.requestAnimationFrame(n))},r=function(n){var t,e,r;return h&&n&&(t=C.abs(u-i),e=C.abs(s-o),n.style.width=rt(t)+"px",n.style.height=rt(e)+"px",n.width=t,n.height=e,(r=n.getContext("2d")).clearRect(0,0,t,e),r.translate(-i,-o),h.forEach(function(n){n instanceof v&&n.toCanvas(r)})),n},p&&(a=window.requestAnimationFrame(e))},dispose:null,add:null,remove:null,getIntersections:null,toSVG:null,toCanvas:null,toIMG:null});function I(n,t){return Rn(n.x,t.x)&&Rn(n.y,t.y)}function q(n,t,e){var r=t.x,i=t.y,o=e.x,u=e.y,t=n.x,e=n.y,n=o-r,o=u-i,u=Xn(n,o);return qn(u,0)?Xn(t-r,e-i):$(n*(i-e)-o*(r-t))/u}function R(n,t,e){var r=t.x,i=t.y,o=e.x,u=e.y,s=n.x,t=n.y,e=0,n=o-r,o=u-i,u=Xn(n,o);return qn(u,0)?Xn(s-r,t-i):(e=C.max(0,C.min(1,((s-r)*n+(t-i)*o)/u)),Xn(s-r-e*n,t-i-e*o))}function N(n,t,e){var r,i=n.x-t.x,o=e.x-t.x,n=n.y-t.y,t=e.y-t.y;return!!Rn(n*o,t*i)&&(0<=(r=qn(o,0)?n/t:i/o)&&r<=1)}function Z(n,t,e,r,i,o,u){var s=i[0],a=i[1],i=n.x-t.x,n=n.y-t.y,t=s*i+a*n,n=-a*i+s*n,e=C.atan2(n/r,t/e);return e<0&&(e+=P),0<=(e=(e-o)/u)&&e<=1}function D(n,t,e){var r=n.x-t.x,t=n.y-t.y,t=r*r+t*t,e=e*e;return Rn(t,e)?2:t<e?1:0}function F(n,t,e,r,i){var o=e*e,u=r*r,e=i[0],r=i[1],i=n.x-t.x,n=n.y-t.y,t=e*i-r*n,i=e*n+r*i,u=t*t/o+i*i/u;return Rn(u,1)?2:u<1?1:0}function U(n,t){for(var e=0,r=t.length-1;e<r;++e)if(N(n,t[e],t[e+1]))return!0;return!1}function H(n,t,e){for(var r,i,o=0,u=0,s=e.length-1;o<s;++o){if(N(n,r=e[o],i=e[o+1]))return 2;W(n,t,r,i)&&++u}return 1&u?1:0}function W(n,t,e,r){var i=dn(t.y-n.y,n.x-t.x,t.x*n.y-n.x*t.y,r.y-e.y,e.x-r.x,r.x*e.y-e.x*r.y);return!!(i&&N(i,n,t)&&N(i,e,r))&&i}function J(n,t,e,r){3<arguments.length&&(e=vn(e,r));var i,o,u=new Array(2),s=0,a=mn(t.y-n.y,n.x-t.x,t.x*n.y-n.x*t.y,e[0],e[1],e[2],e[3],e[4],e[5]);if(!a)return!1;for(i=0,o=a.length;i<o;++i)N(a[i],n,t)&&(u[s++]=a[i]);return u.length=s,!!u.length&&u}function K(n,t,e,r,i,o){5<arguments.length&&(e=bn(e,r,i,o));var u,s,a=new Array(2),l=0,c=mn(t.y-n.y,n.x-t.x,t.x*n.y-n.x*t.y,e[0],e[1],e[2],e[3],e[4],e[5]);if(!c)return!1;for(u=0,s=c.length;u<s;++u)N(c[u],n,t)&&(a[l++]=c[u]);return a.length=l,!!a.length&&a}function nn(n,t,e,r,i,o,u,s,a){null==e&&(e=bn(r,i,o,u));var l,c,f=new Array(2),h=0,g=mn(t.y-n.y,n.x-t.x,t.x*n.y-n.x*t.y,e[0],e[1],e[2],e[3],e[4],e[5]);if(!g)return!1;for(l=0,c=g.length;l<c;++l)N(g[l],n,t)&&Z(g[l],r,i,o,u,s,a)&&(f[h++]=g[l]);return f.length=h,!!f.length&&f}function tn(n,t,e,r){null==e&&(e=Cn(r));var i,o,u,s=new Array(2),a=0,l=t.y-n.y,c=n.x-t.x,f=n.x*(n.y-t.y)+n.y*(t.x-n.x),h=yn(l*e[0].x+c*e[0].y,l*e[1].x+c*e[1].y,l*e[2].x+c*e[2].y+f);if(!h)return!1;for(i=0,o=h.length;i<o;++i)h[i]<0||1<h[i]||N(u=wn(h[i],r),n,t)&&(s[a++]=u);return s.length=a,!!s.length&&s}function en(n,t,e,r){null==e&&(e=$n(r));for(var i,o=new Array(3),u=0,s=t.y-n.y,a=n.x-t.x,l=n.x*(n.y-t.y)+n.y*(t.x-n.x),c=pn(s*e[0].x+a*e[0].y,s*e[1].x+a*e[1].y,s*e[2].x+a*e[2].y,s*e[3].x+a*e[3].y+l),f=0,h=c.length;f<h;++f)c[f]<0||1<c[f]||N(i=Pn(c[f],r),n,t)&&(o[u++]=i);return o.length=u,!!o.length&&o}function rn(n,t,e){for(var r,i=[],o=n.length-1,u=0;u<o;++u)(r=W(n[u],n[u+1],t,e))&&i.push(r);return!!i.length&&i}function on(n,t,e){for(var r,i=[],o=n.length-1,u=vn(t,e),s=0;s<o;++s)(r=J(n[s],n[s+1],u))&&i.push.apply(i,r);return!!i.length&&i}function un(n,t,e,r,i){for(var o,u=[],s=n.length-1,a=bn(t,e,r,i),l=0;l<s;++l)(o=K(n[l],n[l+1],a))&&u.push.apply(u,o);return!!u.length&&u}function sn(n,t,e,r,i,o,u){for(var s,a=[],l=n.length-1,c=bn(t,e,r,i),f=0;f<l;++f)(s=nn(n[f],n[f+1],c,t,e,r,i,o,u))&&a.push.apply(a,s);return!!a.length&&a}function an(n,t){for(var e,r=[],i=n.length-1,o=Cn(t),u=0;u<i;++u)(e=tn(n[u],n[u+1],o,t))&&r.push.apply(r,e);return!!r.length&&r}function ln(n,t){for(var e,r=[],i=n.length-1,o=$n(t),u=0;u<i;++u)(e=en(n[u],n[u+1],o,t))&&r.push.apply(r,e);return!!r.length&&r}function cn(n,t){for(var e,r,i=[],o=n.length-1,u=t.length-1,s=0;s<o;++s)for(e=0;e<u;++e)(r=W(n[s],n[s+1],t[e],t[e+1]))&&i.push(r);return!!i.length&&i}function fn(n){for(var t,e,r=0,i=0,o=n.length-1;i<o;++i)t=n[i],e=n[i+1],r+=Xn(t.x-e.x,t.y-e.y);return r}function hn(t){var e,n,r,i,o,u,s,a=t.length;if(a<3)return t;for(e=t[0],n=0,r=1;r<a;++r)((i=t[r]).y<e.y||Rn(i.y,e.y)&&i.x<e.x)&&(e=i,n=r);for(t.splice(n,1),--a,o=t.map(function(n,t){return[function(n,t,e,r){n=C.atan2(r-t,e-n);return n<0?n+P:n}(e.x,e.y,n.x,n.y),t]}).sort(function(n,t){return n[0]-t[0]}).map(function(n){return t[n[1]]}),(u=new Array(a+1))[0]=e,u[1]=o[0],u[2]=o[1],s=3,r=2;r<a;++r){for(;1<s&&0<=En(o[r],u[s-1],u[s-2]);)--s;u[s++]=o[r]}return u.length=s,u}function gn(n){var t=n.length;if(t<3)return!1;var e,r,i=n[t-2].x,o=n[t-2].y,u=n[t-1].x,s=n[t-1].y,a=C.atan2(s-o,u-i),l=0,c=0,f=0;for(ndx=0;ndx<t;++ndx){if(i=u,o=s,e=a,u=(r=n[ndx]).x,s=r.y,(c=(a=C.atan2(s-o,u-i))-e)<=-w?c+=P:w<c&&(c-=P),0===ndx){if(0===c)return!1;f=0<c?1:-1}else if(f*c<=0)return!1;l+=c}return 1===$(C.round(l/P))}function xn(n,t){return!qn(n,0)&&[-t/n]}function yn(n,t,e){if(qn(n,0))return xn(t,e);var r=t*t-4*n*e,e=0;return Rn(r,0)?[-t/(2*n)]:!(r<0)&&[(-t-(e=_(r)))/(2*n),(-t+e)/(2*n)]}function pn(n,t,e,r){if(qn(n,0))return yn(t,e,r);var i,o=t/n,u=e/n,s=(3*u-o*o)/9,a=(9*o*u-27*(r/n)-2*l(o,3))/54,t=l(s,3)+l(a,2),e=0,r=0,n=0;return 0<=t?(u=In(a+(e=_(t)))*l($(a+e),1/3),r=In(a-e)*l($(a-e),1/3),Rn($(c*(u-r)/2),0)?[-o/3+(u+r),-o/3-(u+r)/2]:[-o/3+(u+r)]):(n=C.acos(a/_(-l(s,3))),[(i=2*_(-s))*C.cos(n/3)-o/3,i*C.cos((n+P)/3)-o/3,i*C.cos((n+2*P)/3)-o/3])}function dn(n,t,e,r,i,o){var u=n*i-t*r;return!qn(u,0)&&{x:(t*o-e*i)/u,y:(e*r-n*o)/u}}function mn(n,t,e,r,i,o,u,s,a){var l,c,f,h,g;return qn(n,0)?!!(l=xn(t,e))&&(!!(l=yn(r,o*(c=l[0])+u,i*c*c+s*c+a))&&(2===l.length?[{x:l[0],y:c},{x:l[1],y:c}]:[{x:l[0],y:c}])):!qn(h=2*(r*t*t+i*n*n-o*n*t),0)&&(!((f=-4*r*i*e*e+4*r*s*e*t-4*r*a*t*t+4*i*u*e*n-4*i*a*n*n+o*o*e*e-2*o*u*e*t-2*o*s*e*n+4*o*a*n*t+u*u*t*t-2*u*s*n*t+s*s*n*n)<0)&&(g=2*r*e*t-o*e*n-u*n*t+s*n*n,qn(f,0)?[{x:-(e+t*(-g/h))/n,y:-g/h}]:[{x:-(e+t*((-n*(f=_(f))-g)/h))/n,y:(-n*f-g)/h},{x:-(e+t*((n*f-g)/h))/n,y:(n*f-g)/h}]))}function vn(n,t){var e=n.x,n=n.y;return[1,1,0,-2*e,-2*n,e*e+n*n-t*t]}function bn(n,t,e,r){var i=n.x,o=n.y,u=r[0],s=r[1],n=t*t*s*s+e*e*u*u,r=t*t*u*u+e*e*s*s,u=2*(e*e-t*t)*s*u;return[n,r,u,-2*n*i-u*o,-u*i-2*r*o,n*i*i+u*i*o+r*o*o-t*t*e*e]}function Cn(n){return[{x:n[0].x-2*n[1].x+n[2].x,y:n[0].y-2*n[1].y+n[2].y},{x:2*n[1].x-2*n[0].x,y:2*n[1].y-2*n[0].y},{x:n[0].x,y:n[0].y}]}function $n(n){return[{x:-n[0].x+3*n[1].x-3*n[2].x+n[3].x,y:-n[0].y+3*n[1].y-3*n[2].y+n[3].y},{x:3*n[0].x-6*n[1].x+3*n[2].x,y:3*n[0].y-6*n[1].y+3*n[2].y},{x:-3*n[0].x+3*n[1].x,y:-3*n[0].y+3*n[1].y},{x:n[0].x,y:n[0].y}]}function _n(n,t){var e=1-n;return{x:e*t[0].x+n*t[1].x,y:e*t[0].y+n*t[1].y}}function wn(n,t){var e=1-n,r=e*e,e=2*e*n,n=n*n;return{x:r*t[0].x+e*t[1].x+n*t[2].x,y:r*t[0].y+e*t[1].y+n*t[2].y}}function Pn(n,t){var e=1-n,r=n*n,i=e*e,o=e*i,u=r*n,n=3*i*n,r=3*e*r;return{x:o*t[0].x+n*t[1].x+r*t[2].x+u*t[3].x,y:o*t[0].y+n*t[1].y+r*t[2].y+u*t[3].y}}function Sn(n,t,e){var r,i,o,u,s=t.length,a=s-1,l=t.slice(),c=new Array(s);for(c[0]=t[0],r=1;r<=a;++r){for(i=0;i+r<=a;++i)o=l[i],u=l[i+1],l[i]={x:o.x+n*(u.x-o.x),y:o.y+n*(u.y-o.y)};c[r]=l[0]}return e?{pt:l[0],points:c}:l[0]}function Gn(n,t){null==t&&(t=1);n=1===t?n:Sn(t,n,!0).points;return 4===n.length?[{x:n[0].x,y:n[1].y},{x:n[1].x,y:n[2].y},{x:n[2].x,y:n[3].y},{x:n[3].x,y:n[4].y}]:3===n.length?[{x:n[0].x,y:n[0].y},{x:n[0].x+2*(n[1].x-n[0].x)/3,y:n[0].y+2*(n[1].y-n[0].y)/3},{x:n[2].x+2*(n[1].x-n[2].x)/3,y:n[2].y+2*(n[1].y-n[2].y)/3},{x:n[2].x,y:n[2].y}]:2===n.length?[n[0],{x:n[0].x+(n[1].x-n[0].x)/2,y:n[0].y+(n[1].y-n[0].y)/2},{x:n[0].x+(n[1].x-n[0].x)/2,y:n[0].y+(n[1].y-n[0].y)/2},n[1]]:[{x:n[0].x,y:n[0].y},{x:n[0].x,y:n[0].y},{x:n[0].x,y:n[0].y},{x:n[0].x,y:n[0].y}]}function An(n,t,e,r,i,o,u,s){var a,l,c,f,h,g,x,y,p=2*C.abs(s)/w;for(Rn(p,1)&&(p=1),Rn(p,C.floor(p))&&(p=C.floor(p)),s/=l=C.max(1,C.ceil(p)),f=Rn(2*C.abs(s),w)?.551915024494*In(s):4*C.tan(s/4)/3,c=new Array(l),a=0;a<l;++a,u+=s)h=C.cos(u),g=C.sin(u),x=C.cos(u+s),y=C.sin(u+s),c[a]=[jn(h,g,n,t,e,r,i,o),jn(h-g*f,g+h*f,n,t,e,r,i,o),jn(x+y*f,y-x*f,n,t,e,r,i,o),jn(x,y,n,t,e,r,i,o)];return c}function Vn(n,t,e,r,i,o,u){null==o&&(o=1,u=0),null==i&&(i=r);r*=C.cos(n),n=i*C.sin(n);return{x:t+o*r-u*n,y:e+u*r+o*n}}function jn(n,t,e,r,i,o,u,s){return null==u&&(u=1,s=0),null==o&&(o=i),{x:e+u*(n*=i)-s*(t*=o),y:r+s*n+u*t}}function Tn(n){return{Tx:-n[0].x,Ty:-n[0].y,R:-C.atan2(n[n.length-1].y-n[0].y,n[n.length-1].x-n[0].x)}}i.Plane=n;var Xn=function(n,t){n=$(n),t=$(t);var e=0;return qn(n,0)?t:qn(t,0)?n:n<t?n*_(1+(e=t/n)*e):t<n?t*_(1+(e=n/t)*e):n*r};function Yn(n,t){return Xn(n.x-t.x,n.y-t.y)}function zn(n,t,e,r){return n*e+t*r}function Bn(n,t,e,r){return n*r-t*e}function Mn(n,t,e,r){var i=Xn(n,t),o=Xn(e,r);return qn(i,0)||qn(o,0)?0:C.acos(Ln(n/i*(e/o)+t/i*(r/o),-1,1))}function kn(n,t,e,r){return In(n*r-t*e)*Mn(n,t,e,r)}function En(n,t,e){return Bn(n.x-e.x,n.y-e.y,t.x-e.x,t.y-e.y)}function Ln(n,t,e){return C.min(C.max(n,t),e)}function On(n){return 180*n/w}function Qn(n){return n*w/180}function In(n){return n<0?-1:1}function qn(n,t){return $(n-t)<Number.EPSILON}function Rn(n,t,e){return null==e&&(e=a),$(n-t)<e}function Nn(n){return n.x||0}function Zn(n){return n.y||0}function Dn(n,t,e){if(n)n.forEach(function(n){y.call(e,n)&&(t[n]=e[n])});else for(var r in e)y.call(e,r)&&(t[r]=e[r]);return t}function Fn(n,e,t,r){var i=!1;if(e=e||g,p&&!1!==t){if(!t&&(i=!0,t=document.createElementNS("http://www.w3.org/2000/svg",n),r))for(var o=0,u=r.length;o<u;++o)t.appendChild(r[o]);Object.keys(e).forEach(function(n){(i||e[n][1])&&t.setAttribute(n,e[n][0])})}else t="<"+n+" "+Object.keys(e).reduce(function(n,t){return n+t+'="'+rt(e[t][0])+'" '},"")+(r?">"+rt(r)+"</"+n+">":"/>");return t}function Un(u,s,a,i){if(ct(u.onChange))return u;function l(t){u.$cb.forEach(function(n){n(t)})}var c=!0;i=i||Wn;var f=function(n,t){for(var e=n;e<t;++e)!function(e){var n=rt(e),r=u[e];b(u,n,{get:function(){return r},set:function(n){s&&(n=s(n));var t=!i(r,n);a&&a(r),r=n,t&&c&&l({target:u,method:"set",added:{from:e,to:e}})},enumerable:!0})}(e)};if(u.$cb=[],u.onChange=function(n,t){var e;ct(n)&&(!1===t?-1!==(e=u.$cb.indexOf(n))&&u.$cb.splice(e,1):-1!==(e=u.$cb.indexOf(n))&&u.$cb.push(n))},s&&u.length)for(var n=0,t=u.length;n<t;++n)u[n]=s(u[n]);return["push","pop","shift","unshift","splice"].forEach(function(n){var o;u[n]=(o=n,function(){var n,t,e=arguments,r=null,i=u.length;return s&&("push"!==o&&"unshift"!==o||(e=Array.prototype.map.apply(e,s)),"splice"===o&&2<e.length&&(e=Array.prototype.slice.call(e,0,2).concat(Array.prototype.slice.call(e,2).map(s)))),"shift"!==o&&"unshift"!==o&&"splice"!==o||(c=!1),n=Array.prototype[o].apply(u,e),"splice"===o&&n.length?r=n:(0<i&&"pop"===o||"shift"===o)&&(r=[n]),r&&a&&r.forEach(a),"unshift"!==o&&"splice"!==o||(c=!0),t=u.length,("push"===o||"unshift"===o||"splice"===o)&&i<t&&f(i,t),"push"===o?l({target:u,method:o,added:{from:i,to:t}}):"unshift"===o?l({target:u,method:o,added:{from:0,to:t-i-1}}):"splice"===o&&2<e.length?l({target:u,method:o,added:{from:e[0],to:e[0]+e.length-3},deleted:r}):l({target:u,method:o,deleted:r}),n})}),f(0,u.length),u}function Hn(t,n){if(!ct(t.onChange))return t;delete t.$cb,delete t.onChange,["push","pop","shift","unshift","splice"].forEach(function(n){t[n]=Array.prototype[n]});n=n?t.map(n):t.slice();return t.length=0,t.push.apply(t,n),t}function Wn(n,t){return n===t}var Jn=/^\s+|\s+$/gm,Kn=String.prototype.trim?function(n){return n.trim()}:function(){return s.replace(Jn,"")};function nt(n,t,e,r){var i=rt(n),o=i.length,n="";return o<t&&(e=e||" ",n=new Array(t-o+1).join(e),i=r?i+n:n+i),i}function tt(n,t){return n<0?rt(n):(!1===t?"":"+")+rt(n)}var et=0,rt=String;function it(n){return parseFloat(n)||0}function ot(n){return ct(n.toTex)?n.toTex():n.toString()}function ut(n){return!isNaN(+n)}function st(n){return"string"==typeof n||"[object String]"===t.call(n)}function at(n){return"[object Array]"===t.call(n)}function lt(n){return"[object Object]"===t.call(n)&&"function"==typeof n.constructor&&"Object"===n.constructor.name}function ct(n){return"function"==typeof n}return i.Math.deg=On,i.Math.rad=Qn,i.Math.hypot=Xn,i.Math.solveLinear=xn,i.Math.solveQuadratic=yn,i.Math.solveCubic=pn,i.Math.solveLinearLinear=dn,i.Math.solveLinearQuadratic=mn,i.Geometry.linearBezierCurve=_n,i.Geometry.quadraticBezierCurve=wn,i.Geometry.cubicBezierCurve=Pn,i.Geometry.ellipticArcCurve=Vn,i.Geometry.computeConvexHull=function(n){return hn(n).map(G)},i});