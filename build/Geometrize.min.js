/**
*   Geometrize
*   computational geometry and rendering library for JavaScript
*
*   @version 1.0.2 (2024-11-30 16:09:17)
*   https://github.com/foo123/Geometrize
*
**/!function(t,n,e){"use strict";"object"==typeof module&&module.exports?(module.$deps=module.$deps||{})&&(module.exports=module.$deps[n]=e.call(t)):"function"==typeof define&&define.amd&&"function"==typeof require&&"function"==typeof require.specified&&require.specified(n)?define(n,["module"],function(n){return e.moduleUri=n.uri,e.call(t)}):n in t||(t[n]=e.call(t)||1)&&"function"==typeof define&&define.amd&&define(function(){return t[n]})}("undefined"!=typeof self?self:this,"Geometrize",function(e){"use strict";var D=Object.prototype.hasOwnProperty,r=Object.prototype.toString,C=Object.defineProperty,_=Math,w=_.abs,$=_.sqrt,P=_.pow,S=_.PI,A=2*S,Q=1e-6,q=S/4,i=$(2),I=$(3),N=20,R=.01,Z={},F=function(){},n="undefined"!=typeof global&&"[object global]"===r.call(global),y="undefined"!=typeof window&&"[object Window]"===r.call(window),j=(n?global:y&&window,{VERSION:"1.0.2",Math:{},Geometry:{}});function t(n,t,e){arguments.length<2&&(t=n,n=null);var r,i,o,u=D.call(t,"constructor")?t.constructor:function(){};for(r in n?(u.prototype=Object.create(n.prototype),u.prototype.$super=(i=n,o={},function(n,t){var e=":"+n;return 1===o[e]?(i.prototype.$super||F).call(this,n,t):(o[e]=1,n=("constructor"===n?i:i.prototype[n]||F).apply(this,t||[]),o[e]=0,n)})):u.prototype.$super=F,u.prototype.constructor=u,t)D.call(t,r)&&"constructor"!==r&&(u.prototype[r]=t[r]);if(e)for(r in e)D.call(e,r)&&(u[r]=e[r]);return u}var n={$changed:!1,$cb:null,dispose:function(){this.$cb=null},isChanged:function(n){return arguments.length?(this.$changed=!!n,this):this.$changed},onChange:function(n,t){var e,r=this;return!1===t&&(L(n)||$t(n))?r.$cb&&-1!==(e=($t(n)?r.$cb.map(function(n){return v(n.id)}):r.$cb).indexOf(n))&&r.$cb.splice(e,1):L(n)&&(r.$cb||(r.$cb=[]),-1===(e=r.$cb.indexOf(n)))&&r.$cb.push(n),r},triggerChange:function(){var t=this;return t.$cb&&t.$cb.forEach(function(n){n(t)}),t}},o=t(null,gt(null,{constructor:function n(t){var e=this,r=null,i=null;return t instanceof n?t:e instanceof n?(i=gt(r=n.Properties,{},n.Defaults),Pt(t)&&(i=gt(r,i,t)),r.forEach(function(t){C(e,t,{get:function(){return i[t]},set:function(n){i[t]!==n&&(i[t]=n,e.isChanged(!0),e.triggerChange())},enumerable:!0,configurable:!1})}),e.toObj=function(){return r.reduce(function(n,t){return n[t]=i[t],n},{})},void e.isChanged(!0)):new n(t)},clone:function(){return new o(this.toObj())},toSVG:function(){var e=this.toObj();return Object.keys(e).reduce(function(n,t){return n+t+":"+v(e[t])+";"},"")},toCanvas:function(n){var t=this;return n.lineCap=t["stroke-linecap"],n.lineJoin=t["stroke-linejoin"],n.lineWidth=t["stroke-width"],n.fillStyle="none"===t.fill?"transparent":t.fill,n.strokeStyle=t.stroke,n}},n),{Properties:["stroke-width","stroke","stroke-opacity","stroke-linecap","stroke-linejoin","fill","fill-opacity","fill-rule"],Defaults:{"stroke-width":1,stroke:"#000000","stroke-opacity":1,"stroke-linecap":"butt","stroke-linejoin":"miter",fill:"none","fill-opacity":1,"fill-rule":"evenodd"}}),G=(j.Style=o,t(null,gt(null,{constructor:function e(r){var i=this;return r instanceof e?r:i instanceof e?(r=O(r),i.dispose=function(){r=null,e.prototype.dispose.call(i)},i.clone=function(){return new e(r)},i.val=function(n){var t;return arguments.length?(n=n instanceof e?n.val():O(n),t=!k(r,n),r=n,t&&(i.isChanged(!0),i.triggerChange()),i):r},i.valueOf=function(){return r.valueOf()},i.toString=function(){return v(r)},void i.isChanged(!0)):new e(r)},clone:null,val:null,valueOf:null,toString:null},n))),g=t(null,{constructor:function n(t,e,r,i,o,u){var s=this;return t instanceof n?t:s instanceof n?void(b(t)&&6<=t.length?(s.$00=O(t[0]),s.$01=O(t[1]),s.$02=O(t[2]),s.$10=O(t[3]),s.$11=O(t[4]),s.$12=O(t[5])):(s.$00=t,s.$01=e,s.$02=r,s.$10=i,s.$11=o,s.$12=u)):new n(t,e,r,i,o,u)},$00:1,$01:0,$02:0,$10:0,$11:1,$12:0,clone:function(){var n=this;return new g(n.$00,n.$01,n.$02,n.$10,n.$11,n.$12)},eq:function(n){var t;return n instanceof g&&k((t=this).$00,n.$00)&&k(t.$01,n.$01)&&k(t.$02,n.$02)&&k(t.$10,n.$10)&&k(t.$11,n.$11)&&k(t.$12,n.$12)},add:function(n){var t=this;return n instanceof g?new g(t.$00+n.$00,t.$01+n.$01,t.$02+n.$02,t.$10+n.$10,t.$11+n.$11,t.$12+n.$12):(n=O(n),new g(t.$00+n,t.$01+n,t.$02+n,t.$10+n,t.$11+n,t.$12+n))},mul:function(n){var t,e,r,i,o,u,s=this,a=s.$00,l=s.$01,c=s.$02,f=s.$10,h=s.$11,s=s.$12;return n instanceof g?(t=n.$00,e=n.$01,r=n.$02,i=n.$10,o=n.$11,u=n.$12,0,new g(a*t+l*i,a*e+l*o,a*r+l*u+c,f*t+h*i,f*e+h*o,f*r+h*u+s)):(n=O(n),new g(a*n,l*n,c*n,f*n,h*n,s*n))},det:function(){var n=this,t=n.$00,e=n.$01,r=(n.$02,n.$10),i=n.$11;n.$12;return t*i-e*r},inv:function(){var n=this,t=n.$00,e=n.$01,r=n.$02,i=n.$10,o=n.$11,n=n.$12,u=t*o-e*i;return h(u,0)?null:new g(o=o/u,e=-e/u,-o*r-e*n,o=-i/u,e=t/u,-o*r-e*n)},transform:function(n,t){var e=this,r=n.x,n=n.y,i=e.$00*r+e.$01*n+e.$02,r=e.$10*r+e.$11*n+e.$12;return t?(t.x=i,t.y=r):t=new V(i,r),t},getTranslation:function(){return{x:this.$02,y:this.$12}},getRotationAngle:function(){return _.atan2(this.$10,this.$00)},getScale:function(){var n=this.$00,t=-this.$01,e=this.$10,r=this.$11;return{x:M(n)*l(n,e),y:M(r)*l(t,r)}},toArray:function(){var n=this;return[n.$00,n.$01,n.$02,n.$10,n.$11,n.$12,0,0,1]},toSVG:function(){var n=this;return"matrix("+v(n.$00)+" "+v(n.$10)+" "+v(n.$01)+" "+v(n.$11)+" "+v(n.$02)+" "+v(n.$12)+")"},toCSS:function(){var n=this;return"matrix("+v(n.$00)+","+v(n.$10)+","+v(n.$01)+","+v(n.$11)+","+v(n.$02)+","+v(n.$12)+")"},toCanvas:function(n,t){var e=this;return n[!0===t?"setTransform":"transform"](e.$00,e.$10,e.$01,e.$11,e.$02,e.$12),n},toTex:function(){return g.arrayTex(this.toArray(),3,3)},toString:function(){return g.arrayString(this.toArray(),3,3)}},{eye:function(){return new g(1,0,0,0,1,0)},translate:function(n,t){return new g(1,0,O(n),0,1,O(t))},rotate:function(n,t,e){e=O(e||0),t=O(t||0),n=O(n||0);var r=_.cos(n),n=_.sin(n);return new g(r,-n,t-r*t+n*e,n,r,e-r*e-n*t)},scale:function(n,t,e,r){return r=O(r||0),e=O(e||0),n=O(n),t=O(t),new g(n,0,-n*e+e,0,t,-t*r+r)},reflectX:function(){return new g(-1,0,0,0,1,0)},reflectY:function(){return new g(1,0,0,0,-1,0)},shearX:function(n){return new g(1,O(n),0,0,1,0)},shearY:function(n){return new g(1,0,0,O(n),1,0)},arrayTex:function(n,t,e){for(var r="\\begin{pmatrix}",i=0;i<t;++i)r+=n.slice(i*e,i*e+e).join("&"),i+1<t&&(r+="\\\\");return r+="\\end{pmatrix}"},arrayString:function(n,t,e){for(var r=n.reduce(function(n,t){return _.max(n,v(t).length)},0),i="",o=0;o<t;++o)i+="["+n.slice(o*e,o*e+e).map(function(n){return vt(n,r)}).join(" ")+"]",o+1<t&&(i+="\n");return i},pointTex:function(n){return"\\begin{pmatrix}"+v(n.x)+"\\\\"+v(n.y)+"\\\\1\\end{pmatrix}"},pointString:function(n){var t=[n.x,n.y].reduce(function(n,t){return _.max(n,v(t).length)},1);return"["+vt(n.x,t)+"]\n["+vt(n.y,t)+"]\n["+vt(1,t)+"]"}}),H=g.eye(),x=(j.Matrix2D=g,t(null,gt(null,{constructor:function(){var t,n,e=this,r=null,i=null;e.id=(n=e.name,v(n||"")+"_"+v(++Ct)+"_"+v((new Date).getTime())+"_"+v(_.round(1e3*_.random()))),t=function(n){r===n&&(e.isChanged(!0),e.triggerChange())},(r=new o).onChange(t),i=e.hasMatrix()?g.eye():null,C(e,"matrix",{get:function(){return i},set:function(n){var t;e.hasMatrix()&&(t=!(n=g(n)).eq(i),i=n,t)&&(e.isChanged(!0),e.triggerChange())},enumerable:!0,configurable:!0}),e.setMatrix=function(n){return arguments.length&&(e.matrix=n),e},C(e,"style",{get:function(){return r},set:function(n){n=o(n),r!==n&&(r&&r.onChange(t,!1),r=n)&&(r.onChange(t),e.isChanged(!0),e.triggerChange())},enumerable:!0,configurable:!1}),e.setStyle=function(n,t){return arguments.length&&(1<arguments.length?e.style[n]=t:e.style=n),e},e.isChanged(!0)},id:"",name:"Object2D",clone:function(){return this},transform:function(){return this},hasMatrix:function(){return!1},setMatrix:null,setStyle:null,getBoundingBox:function(){return{ymin:-1/0,xmin:-1/0,ymax:1/0,xmax:1/0}},getConvexHull:function(){return[]},getCenter:function(){var n=this.getBoundingBox();return{x:(n.xmin+n.xmax)/2,y:(n.ymin+n.ymax)/2}},hasPoint:function(n){return!1},hasInsidePoint:function(n,t){return!1},intersects:function(n){return!1},intersectsSelf:function(){return!1},toSVG:function(n){return arguments.length?n:""},toSVGPath:function(n){return arguments.length?n:""},toCanvas:function(n){},toCanvasPath:function(n){},toTex:function(){return"\\text{"+this.name+"}"},toString:function(){return this.name+"("+this.id+")"}},n))),V=t(j.Object2D=x,{constructor:function n(t,e){var r=this,i=0,o=0,u=null;return t instanceof n?t:r instanceof n?(r.$super("constructor"),o=b(t)?(i=O(t[0]),O(t[1])):Pt(t)?(i=O(t.x),O(t.y)):(i=O(t),O(e)),C(r,"x",{get:function(){return i},set:function(n){var t=!k(n=O(n),i);i=n,t&&(r.isChanged(!0),r.triggerChange())},enumerable:!0,configurable:!1}),C(r,"y",{get:function(){return o},set:function(n){var t=!k(n=O(n),o);o=n,t&&(r.isChanged(!0),r.triggerChange())},enumerable:!0,configurable:!1}),C(r,"norm",{get:function(){return u=null==u?l(i,o):u},enumerable:!0,configurable:!1}),r.isChanged=function(n){return!0===n&&(u=null),r.$super("isChanged",arguments)},void(r.dispose=function(){o=i=null,r.$super("dispose")})):new n(t,e)},name:"Point2D",clone:function(){return new V(this.x,this.y)},transform:function(n){return n.transform(this)},getBoundingBox:function(){return{ymin:this.y,xmin:this.x,ymax:this.y,xmax:this.x}},eq:function(n){return n instanceof V||null!=n.x&&null!=n.y?c(this,n):!!b(n)&&c(this,{x:n[0],y:n[1]})},add:function(n){return n instanceof V?new V(this.x+n.x,this.y+n.y):new V(this.x+O(n),this.y+O(n))},mul:function(n){return n=O(n),new V(this.x*n,this.y*n)},dot:function(n){return it(this.x,this.y,n.x,n.y)},cross:function(n){return ot(this.x,this.y,n.x,n.y)},angle:function(n){return ut(this.x,this.y,n.x,n.y)},between:function(n,t){return d(this,n,t)},distanceToLine:function(n,t){return hn(this,n,t)},isOn:function(n){return!!L(n.hasPoint)&&n.hasPoint(this)},isInside:function(n,t){return!!L(n.hasInsidePoint)&&n.hasInsidePoint(this,t)},intersects:function(n){return n instanceof V?!!this.eq(n)&&[this]:n instanceof x&&n.intersects(this)},toObj:function(){return{x:this.x,y:this.y}},bezierPoints:function(){var n=this.x,t=this.y;return[[{x:n,y:t},{x:n,y:t},{x:n,y:t},{x:n,y:t}]]},toSVG:function(n){var t=this;return m("circle",{id:[t.id,!1],cx:[t.x,t.isChanged()],cy:[t.y,t.isChanged()],r:[t.style["stroke-width"],t.style.isChanged()],style:["fill:"+v(t.style.stroke)+";",t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t.style["stroke-width"],e="M "+v(t.x-e)+" "+v(t.y)+" a "+v(e)+" "+v(e)+" 0 0 0 "+v(e+e)+" 0 a "+v(e)+" "+v(e)+" 0 0 0 "+v(-e-e)+" 0 Z";return arguments.length?m("path",{id:[t.id,!1],d:[e,t.isChanged()],style:["fill:"+v(t.style.stroke)+";",t.style.isChanged()]},n):e},toCanvas:function(n){n.fillStyle=this.style.stroke,this.toCanvasPath(n)},toCanvasPath:function(n){n.beginPath(),n.arc(this.x,this.y,this.style["stroke-width"],0,A),n.closePath(),n.fill()},toTex:function(){return"\\begin{pmatrix}"+v(this.x)+"\\\\"+v(this.y)+"\\end{pmatrix}"},toString:function(){return"Point2D("+v(this.x)+","+v(this.y)+")"}}),U=(j.Point2D=V,t(x,{constructor:function n(t){var e,r,i,o,u=this,s=null;return t instanceof n?t:u instanceof n?(null==t&&(t=[]),u.$super("constructor"),i=function(n){return(n=V(n)).onChange(e),n},o=function(n){return n.onChange(e,!1),n},(e=function(n){b(s)&&-1!==s.indexOf(n)&&(u.isChanged(!0),u.triggerChange())}).id=u.id,(r=function(n){u.isChanged(!0),u.triggerChange()}).id=u.id,(s=yt(t,i,o,c)).onChange(r),void C(u,"points",{get:function(){return s},set:function(n){s!==n&&(b(s)&&xt(s,o),b(n)?((s=yt(n,i,o,c)).onChange(r),u.isChanged(!0),u.triggerChange()):null==n&&(s=null))},enumerable:!0,configurable:!0})):new n(t)},name:"Topos2D",dispose:function(){var t=this;t.points&&(xt(t.points,function(n){return n.onChange(t.id,!1),n}),t.points=null),t.$super("dispose")},isChanged:function(n){return!1===n&&this.points.forEach(function(n){n.isChanged(!1)}),this.$super("isChanged",arguments)},clone:function(){return new U(this.points.map(function(n){return n.clone()}))},transform:function(t){return new U(this.points.map(function(n){return t.transform(n)}))},hasPoint:function(n){for(var t=this.points,e=t.length,r=0;r<e;++r)if(c(t[r],n))return!0;return!1},hasInsidePoint:function(n,t){return this.hasPoint(n)},intersects:function(n){if(n instanceof x){for(var t=this.points,e=t.length,r=[],i=0;i<e;++i)n.intersects(t[i])&&r.push(t[i]);return!!r.length&&r}return!1},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t.points.map(function(n){return n.toSVGPath()}).join(" ");return arguments.length?m("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n)},toCanvasPath:function(t){this.points.forEach(function(n){n.toCanvasPath(t)})}})),p=t(j.Topos2D=U,{constructor:function(n,t){var e=this,r=null,i=null,o=null,u=null,s=null,a=null;e.$super("constructor",[n]),u=t=null==t?{}:t,r=e.hasMatrix()?g.eye():null,u.matrix=new G(0),u.matrix.isChanged(e.hasMatrix()),C(e,"matrix",{get:function(){return r||g.eye()},set:function(n){var t;e.hasMatrix()&&(t=!(n=g(n)).eq(r),r=n,t)&&(u.matrix.isChanged(!0),e.isChanged(!0),e.triggerChange())},enumerable:!0,configurable:!0}),C(e,"_points",{get:function(){return i=null==i?!r||r.eq(H)?e.points.map(function(n){return n.clone()}):e.points.map(function(n){return r.transform(n)}):i},set:function(n){null==n&&(i=null)},enumerable:!1,configurable:!0}),C(e,"_lines",{get:function(){return o=null==o?function(n,t,e,r,i){null==t&&(t=N);null==e&&(e=R);var o,u,s,a=[];if(r)for(s=n(0),i&&(s.t=0),a.push(s),o=0;o<t;++o)!function n(t,e,r,i,o,u,s,a){if(i<=r||k(r,i))return;var l=(r+i)/2,u=u||e(r),s=s||e(i),c=e(l);hn(c,u,s)<=o?(a&&(s.t=i),t.push(s)):(n(t,e,r,l,o,u,c,a),n(t,e,l,i,o,c,s,a))}(a,n,0===o?0:o/t,t===o+1?1:(o+1)/t,e,null,null,i);else for(o=0;o<=t;++o)s=n(u=0===o?0:t===o?1:o/t),i&&(s.t=u),a.push(s);return a}(e.f.bind(e),N,R,!0,!0):o},set:function(n){null==n&&(o=null)},enumerable:!1,configurable:!0}),C(e,"values",{get:function(){return u},set:function(n){null==n&&(u=null)},enumerable:!1,configurable:!0}),C(e,"length",{get:function(){return 0},enumerable:!0,configurable:!0}),C(e,"area",{get:function(){return 0},enumerable:!0,configurable:!0}),C(e,"_bbox",{get:function(){return{ymin:-1/0,xmin:-1/0,ymax:1/0,xmax:1/0}},enumerable:!1,configurable:!0}),C(e,"_hull",{get:function(){var n=null,n=null==s?s=e._bbox:e._bbox;return a=null!=a&&s===n?a:[new V((s=n).xmin,n.ymin),new V(n.xmax,n.ymin),new V(n.xmax,n.ymax),new V(n.xmin,n.ymax)]},enumerable:!1,configurable:!0})},name:"Curve2D",dispose:function(){this.values=null,this.$super("dispose")},isChanged:function(n){var t=this;return!1===n&&(Object.keys(t.values).forEach(function(n){t.values[n].isChanged(!1)}),t.style.isChanged(!1)),!0===n&&(t._points=null,t._lines=null),t.$super("isChanged",arguments)},hasMatrix:function(){return!0},isConnected:function(){return!0},isClosed:function(){return!1},isConvex:function(){return!1},f:function(n){return{x:0,y:0}},fto:function(n){return self},d:function(){return this.clone()},getPointAt:function(n){return(n=O(n))<0||1<n||null==(n=this.f(n))?null:V(n)},curveUpTo:function(n){return k(n=B(O(n),0,1),1)?this:this.fto(n).setMatrix(this.matrix).setStyle(this.style.toObj())},getBoundingBox:function(){var n=this._bbox;return{ymin:n.ymin,xmin:n.xmin,ymax:n.ymax,xmax:n.xmax}},getConvexHull:function(){return this._hull.map(function(n){return n.clone()})},derivative:function(){var n=this.d();return this.hasMatrix()&&n.setMatrix(this.matrix.clone()),n.setStyle(this.style.toObj()),n},polylinePoints:function(){return this._lines.slice()},bezierPoints:function(n){return[{x:0,y:0},{x:0,y:0},{x:0,y:0},{x:0,y:0}]}}),n=t(j.Curve2D=p,{constructor:function(n,t){var e=this;e.$super("constructor",[n=null==n?[]:n,t]),C(e,"degree",{get:function(){return e.points.length-1},enumerable:!0,configurable:!1})},name:"Bezier2D",fto:function(n){return new this.constructor(Kn(n,this.points,!0).points)},d:function(){var n=this.points,t=n.length-1,t=j.Line&&this instanceof j.Line?new j.Line([{x:t*(n[1].x-n[0].x),y:t*(n[1].y-n[0].y)},{x:t*(n[1].x-n[0].x),y:t*(n[1].y-n[0].y)}]):j.QBezier&&this instanceof j.QBezier?new j.Line([{x:t*(n[1].x-n[0].x),y:t*(n[1].y-n[0].y)},{x:t*(n[2].x-n[1].x),y:t*(n[2].y-n[1].y)}]):j.CBezier&&this instanceof j.CBezier?new j.QBezier([{x:t*(n[1].x-n[0].x),y:t*(n[1].y-n[0].y)},{x:t*(n[2].x-n[1].x),y:t*(n[2].y-n[1].y)},{x:t*(n[3].x-n[2].x),y:t*(n[3].y-n[2].y)}]):new j.Line([{x:0,y:0},{x:0,y:0}]);return t},toTex:function(){return"\\text{"+this.name+": }\\left("+this.points.map(_t).join(",")+"\\right)"},toString:function(){return this.name+"("+this.points.map(v).join(",")+")"}}),W=(j.Bezier2D=n,t(p,{constructor:function(n,t){this.$super("constructor",[n,t])},name:"EllipticArc2D",hasMatrix:function(){return!1},isClosed:function(){return k(_.abs(this.dtheta),A)},isConvex:function(){return!0},f:function(n){var t=this,e=t.center,r=t.cs;return Y(t.theta+n*t.dtheta,e.x,e.y,t.rX,t.rY,r[0],r[1])},fto:function(n){var t=this,e=0,r=1,r=t instanceof j.Arc?(e=t.largeArc,t.sweep):(e=S<n*A?1:0,1);return new j.Arc(t.f(0),t.f(n),t.radiusX,t.radiusY,t.angle,e,r)},d:function(){var n,t,e,r,i,o,u,s=this;return s instanceof j.Arc?(n=s.center.x,t=s.center.y,e=s.rY,r=s.rX,i=[s.cs[0],-s.cs[1]],o=-s.theta,u=-s.dtheta,o={p0:Y(o,n,t,e,r,i[0],i[1]),p1:Y(o+u,n,t,e,r,i[0],i[1]),fa:w(u)>S,fs:0<u},new j.Arc(o.p0,o.p1,-s.angle,o.fa,o.fs)):s instanceof j.Ellipse?new j.Ellipse(s.center,s.radiusY,s.radiusX,-s.angle):s.clone()},hasPoint:function(n){var t=this,e=!1;return j.Arc&&t instanceof j.Arc?e=pn(n,t.center,t.rX,t.rY,t.cs,t.theta,t.dtheta,t.largeArc,t.sweep):j.Ellipse&&t instanceof j.Ellipse?e=2===vn(n,t.center,t.rX,t.rY,t.cs):j.Circle&&t instanceof j.Circle&&(e=2===mn(n,t.center,t.rX)),e},hasInsidePoint:function(n,t){var e,r=this,i=!1;return j.Arc&&r instanceof j.Arc?!t&&r.hasPoint(n):(j.Ellipse&&r instanceof j.Ellipse?(e=vn(n,r.center,r.rX,r.rY,r.cs),i=t?1===e:0<e):j.Circle&&r instanceof j.Circle&&(e=mn(n,r.center,r.rX),i=t?1===e:0<e),i)},bezierPoints:function(n){k(n=arguments.length?B(n,0,1):1,1)&&(n=1);var t,e,r,i,o,u,s,a,l=this,c=l.center,f=l.cs,h=1,g=(l instanceof j.Arc||(h=-1),c.x),y=c.y,x=l.rX,p=l.rY,d=f[0],m=f[1],v=l.theta,b=h*n*l.dtheta,c=2*_.abs(b)/S;for(k(c,1)&&(c=1),k(c,_.floor(c))&&(c=_.floor(c)),e=_.max(1,_.ceil(c)),b/=e,i=k(2*_.abs(b),S)?.551915024494*M(b):4*_.tan(b/4)/3,r=new Array(e),t=0;t<e;++t,v+=b)o=_.cos(v),u=_.sin(v),s=_.cos(v+b),a=_.sin(v+b),r[t]=[T(o,u,g,y,x,p,d,m),T(o-u*i,u+o*i,g,y,x,p,d,m),T(s+a*i,a-s*i,g,y,x,p,d,m),T(s,a,g,y,x,p,d,m)];return r}})),J=(j.EllipticArc2D=W,t(p,{constructor:function n(t){var e=this,r=null,i=null,o=null;return t instanceof n?t:e instanceof n?(e.f=L(t)?t:function(n){return{x:0,y:0}},e.$super("constructor",[[]]),C(e,"length",{get:function(){return r=null==r?zn(e._lines):r},enumerable:!0,configurable:!1}),C(e,"_bbox",{get:function(){return i=null==i?tt(e._lines):i},enumerable:!1,configurable:!1}),C(e,"_hull",{get:function(){return o=null==o?et(e._lines).map(V):o},enumerable:!1,configurable:!1}),void(e.isChanged=function(n){return!0===n&&(o=i=r=null),e.$super("isChanged",arguments)})):new n(t)},name:"ParametricCurve",clone:function(){return new J(this.f)},transform:function(n){return new J(this.f).setMatrix(n)},fto:function(t){var e=this.f,r=e(t);return new J(function(n){return t<=n?{x:r.x,y:r.y}:e(n*t)})},isClosed:function(){var n=this._lines;return 2<n.length&&c(n[0],n[n.length-1])},hasPoint:function(n){return bn(n,this._lines)},hasInsidePoint:function(n,t){return!!this.isClosed()&&(n=Cn(n,{x:this._bbox.xmax+10,y:n.y},this._lines),t?1===n:0<n)},intersects:function(n){var t,e=this;return n instanceof V?!!e.hasPoint(n)&&[n]:j.Line&&n instanceof j.Line?!!(t=Gn(e._lines,n._points[0],n._points[1]))&&t.map(V):j.Circle&&n instanceof j.Circle?!!(t=Vn(e._lines,n.center,n.radius))&&t.map(V):j.Ellipse&&n instanceof j.Ellipse?!!(t=Xn(e._lines,n.center,n.radiusX,n.radiusY,n.cs))&&t.map(V):j.Arc&&n instanceof j.Arc?!!(t=Yn(e._lines,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta))&&t.map(V):j.QBezier&&n instanceof j.QBezier?!!(t=Tn(e._lines,n._points))&&t.map(V):j.CBezier&&n instanceof j.CBezier?!!(t=Bn(e._lines,n._points))&&t.map(V):j.Polyline&&n instanceof j.Polyline?!!(t=En(e._lines,n._points))&&t.map(V):j.Polygon&&n instanceof j.Polygon||n instanceof J?!!(t=En(e._lines,n._lines))&&t.map(V):n instanceof x&&n.intersects(e)},intersectsSelf:function(){for(var n,t,e,r,i,o,u=[],s=this._lines,a=s.length,l=0;l<a&&!(a<=l+1);++l)for(t=l+2;t<a&&!(a<=t+1);++t)e=s[l],r=s[l+1],i=s[t],o=s[t+1],(n=f(e,r,i,o))&&(0===l&&t===a-2&&c(e,o)?n=n.filter(function(n){return!c(n,e)}):t===l+2&&c(r,i)&&(n=n.filter(function(n){return!c(n,r)})),u.push.apply(u,n));return!!u&&u.map(V)},bezierPoints:function(n){k(n=arguments.length?B(n,0,1):1,1)&&(n=1);for(var t=this._lines,e=t.length-1,r=[],i=0;i<e;++i){if(!(t[i+1].t<n)){r.push(u([t[i],t[i+1]],e*(n-i/e)));break}r.push(u([t[i],t[i+1]],1))}return r},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var t=this,e="M "+t._lines.map(function(n){return v(n.x)+" "+v(n.y)}).join(" L ");return t.isClosed()&&(e+=" Z"),arguments.length?m("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t,e=this._lines,r=e.length;for(n.beginPath(),n.moveTo(e[0].x,e[0].y),t=1;t<r;++t)n.lineTo(e[t].x,e[t].y);this.isClosed()&&n.closePath()}})),K=(j.ParametricCurve=J,/[M]/g),nn=/^\s*(-?\s*\d+(?:\.\d+)?)\s+(-?\s*\d+(?:\.\d+)?)/,tn=/(-?\s*\d+(?:\.\d+)?)\s+(-?\s*\d+(?:\.\d+)?)\s*$/,en=t(p,{constructor:function n(t){var e,r,i,o,u=this,s=null,a=null,l=null,c=null,f=null,h=null;if(!(u instanceof n))return new n(t);null==t&&(t=[]),x.call(u),i=function(n){return n instanceof p&&n.onChange(e),n},o=function(n){return n instanceof p&&n.onChange(e,!1),n},(e=function(n){b(s)&&-1!==s.indexOf(n)&&(u.isChanged(!0),u.triggerChange())}).id=u.id,(r=function(n){u.isChanged(!0),u.triggerChange()}).id=u.id,C(u,"points",{get:function(){return l=null==l?s.reduce(function(n,t){return n.push.apply(n,t.points),n},[]):l},set:function(n){null==n&&(l=null)},enumerable:!0,configurable:!1}),C(u,"curves",{get:function(){return s},set:function(n){s!==n&&(b(s)&&xt(s,o),b(n)?((s=yt(n,i,o)).onChange(r),u.isChanged(!0),u.triggerChange()):null==n&&(a=s=null))},enumerable:!0,configurable:!1}),C(u,"_curves",{get:function(){var t;return null==a&&(t=u.matrix,a=u.curves.map(function(n){return n.transform(t)})),a},enumerable:!1,configurable:!1}),C(u,"length",{get:function(){return c=null==c?u._curves.reduce(function(n,t){return n+=t.length},0):c},enumerable:!0,configurable:!1}),C(u,"area",{get:function(){return 0},enumerable:!0,configurable:!1}),C(u,"_bbox",{get:function(){return f=null==f?u._curves.reduce(function(n,t){t=t.getBoundingBox();return n.ymin=_.min(n.ymin,t.ymin),n.xmin=_.min(n.xmin,t.xmin),n.ymax=_.max(n.ymax,t.ymax),n.xmax=_.max(n.xmax,t.xmax),n},{ymin:1/0,xmin:1/0,ymax:-1/0,xmax:-1/0}):f},enumerable:!1,configurable:!1}),C(u,"_hull",{get:function(){return h=null==h?Mn(u._curves.reduce(function(n,t){return n.push.apply(n,t._hull),n},[])):h},enumerable:!1,configurable:!1}),u.isChanged=function(n){return!0===n?h=f=c=a=l=null:!1===n&&s.forEach(function(n){n.isChanged(!1)}),x.prototype.isChanged.apply(u,arguments)},u.curves=t},name:"CompositeCurve",dispose:function(){var t=this;t.curves&&(xt(t.curves,function(n){return n instanceof p&&n.onChange(t.id,!1),n}),t.curves=null,t.points=null),x.prototype.dispose.call(t)},clone:function(){return new en(this.curves.map(function(n){return n.clone()}))},transform:function(t){return new en(this.curves.map(function(n){return n.transform(t)}))},isConnected:function(){var n,t,e,r=this.curves,i=r.length-1;if(i<0)return!1;if(!r[0].isConnected())return!1;for(e=0;e<i;++e){if(n=r[e],!(t=r[e+1]).isConnected()||t.isClosed())return!1;if(n=n._points,t=t._points,!n[n.length-1].eq(t[0]))return!1}return!0},isClosed:function(n){var t;return!!(n=!0===n||!1===n?n:this.isConnected())&&!!(t=(n=this.curves).length)&&(!(1!==t||!n[0].isClosed())||n[0]._points[0].eq(n[t-1]._points[n[t-1]._points.length-1]))},f:function(n){var t=this._curves,e=t.length-1,r=_.floor(n*e);return 1===n?t[e].f(n):t[r].f(e*(n-r/e))},fto:function(n){var t=this._curves,e=t.length-1,r=_.floor(n*e);return new en(t.slice(0,r).concat([t[r].curveUpTo(1===n?1:e*(n-r/e))]))},derivative:function(){return new en(this._curves.map(function(n){return n.derivative()}))},hasPoint:function(n){for(var t=this._curves,e=t.length,r=0;r<e;++r)if(t[r].hasPoint(n))return!0;return!1},intersects:function(n){if(n instanceof V)return!!this.hasPoint(n)&&[n];if(n instanceof x){for(var t,e=[],r=this._curves,i=r.length,o=0;o<i;++o)(t=r[o].intersects(n))&&e.push.apply(e,t);return!!e&&e.map(V)}return!1},intersectsSelf:function(){for(var n,t,e,r,i,o,u=[],s=this._curves,a=s.length,l=0;l<a;++l)for((n=s[l].intersectsSelf())&&u.push.apply(u,n),t=l+1;t<a;++t)(n=s[l].intersects(s[t]))&&(e=s[l]._points[0],r=s[l]._points[s[l]._points.length-1],i=s[t]._points[0],o=s[t]._points[s[t]._points.length-1],0===l&&t===a-1&&c(e,o)?n=n.filter(function(n){return!c(n,e)}):t===l+1&&c(r,i)&&(n=n.filter(function(n){return!c(n,r)})),u.push.apply(u,n));return!!u&&u.map(V)},polylinePoints:function(){return this._curves.reduce(function(n,t){return n.push.apply(n,t.polylinePoints()),n},[])},bezierPoints:function(n){k(n=arguments.length?B(n,0,1):1,1)&&(n=1);for(var t=this._curves,e=t.length-1,r=_.floor(n*e),i=[],o=0;o<r;++o)i.push.apply(i,t[o].bezierPoints(1));return i.push.apply(i,t[r].bezierPoints(1===n?1:e*(n-r/e))),i},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var i,t=this,e=t._curves,r=t.isConnected(),o=t.isClosed(r),u=e.map(function(n){return n.toSVGPath()}).join(" ");return r&&(r=u.match(K),i=u.split(K),u=r.reduce(function(n,t,e){var r;return"M"===t&&(r=(t=i[e+1]||"").match(nn),e=(i[e]||"").match(tn),t=r&&e&&k(O(r[1]),O(e[1]))&&k(O(r[2]),O(e[2]))?(n=mt(n),t.slice(r[0].length)):"M"+t,n+=t),n},i[0]||"")+(o&&1<e.length?" Z":"")),arguments.length?m("path",{id:[t.id,!1],d:[u,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):u},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t,e,r,i,o,u,s=this._curves,a=s.length;if(a){for(e=this.isConnected(),r=this.isClosed(e),n.beginPath(),e&&(n.moveTo(s[0]._points[0].x,s[0]._points[0].y),i=n.moveTo,o=n.beginPath,u=n.closePath,n.moveTo=F,n.beginPath=F,n.closePath=F),t=0;t<a;++t)s[t].toCanvasPath(n);e&&(n.moveTo=i,n.beginPath=o,n.closePath=u,r)&&n.closePath()}},toTex:function(){return"\\text{CompositeCurve: }\\begin{cases}&"+this.curves.map(_t).join("\\\\&")+"\\end{cases}"},toString:function(){return"CompositeCurve(\n"+this.curves.map(v).join("\n")+"\n)"}}),a=(j.CompositeCurve=en,t(n,{constructor:function n(t,e){var r=this,i=null,o=null;return t instanceof n?t:r instanceof n?(b(t)&&null==e&&(e=t[1],t=t[0]),r.$super("constructor",[[t,e]]),C(r,"start",{get:function(){return r.points[0]},set:function(n){r.points[0]=n},enumerable:!0,configurable:!1}),C(r,"end",{get:function(){return r.points[1]},set:function(n){r.points[1]=n},enumerable:!0,configurable:!1}),C(r,"_lines",{get:function(){return r._points},set:function(n){},enumerable:!1,configurable:!1}),C(r,"length",{get:function(){var n;return null==i&&(n=r._points,i=rt(n[0],n[1])),i},enumerable:!0,configurable:!1}),C(r,"_bbox",{get:function(){return o=null==o?tt(r._points):o},enumerable:!1,configurable:!1}),void(r.isChanged=function(n){return!0===n&&(o=i=null),r.$super("isChanged",arguments)})):new n(t,e)},name:"Line",clone:function(){return new a(this.start.clone(),this.end.clone())},transform:function(n){return new a(this.start.transform(n),this.end.transform(n))},f:function(n){return Un(n,this._points)},hasPoint:function(n){var t=this._points;return!!d(n,t[0],t[1])},intersects:function(n){var t,e,r=this;return n instanceof V?!!(t=d(n,(e=r._points)[0],e[1]))&&[n]:n instanceof a?!!(t=f((e=r._points)[0],e[1],n._points[0],n._points[1]))&&t.map(V):j.Circle&&n instanceof j.Circle?!!(t=_n((e=r._points)[0],e[1],n.center,n.radius))&&t.map(V):j.Ellipse&&n instanceof j.Ellipse?!!(t=wn((e=r._points)[0],e[1],n.center,n.radiusX,n.radiusY,n.cs))&&t.map(V):j.Arc&&n instanceof j.Arc?!!(t=$n((e=r._points)[0],e[1],null,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta,n.largeArc,n.sweep))&&t.map(V):j.QBezier&&n instanceof j.QBezier?!!(t=Pn((e=r._points)[0],e[1],null,n._points))&&t.map(V):j.CBezier&&n instanceof j.CBezier?!!(t=Sn((e=r._points)[0],e[1],null,n._points))&&t.map(V):n instanceof x&&n.intersects(this)},distanceToPoint:function(n){return gn(n,this._points[0],this._points[1])},isParallelTo:function(n,t){var e=this._points;return n instanceof a?yn(e[0],e[1],n._points[0],n._points[1]):yn(e[0],e[1],n,t)},isPerpendicularTo:function(n,t){var e=this._points;return n instanceof a?xn(e[0],e[1],n._points[0],n._points[1]):xn(e[0],e[1],n,t)},bezierPoints:function(n){return k(n=arguments.length?B(n,0,1):1,1)&&(n=1),[u(this._points,n)]},toSVG:function(n){var t=this,e=t._points;return m("line",{id:[t.id,!1],x1:[e[0].x,t.start.isChanged()||t.values.matrix.isChanged()],y1:[e[0].y,t.start.isChanged()||t.values.matrix.isChanged()],x2:[e[1].x,t.end.isChanged()||t.values.matrix.isChanged()],y2:[e[1].y,t.end.isChanged()||t.values.matrix.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t._points,e=["M",e[0].x,e[0].y,"L",e[1].x,e[1].y].join(" ");return arguments.length?m("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),n.stroke()},toCanvasPath:function(n){var t=this._points[0],e=this._points[1];n.beginPath(),n.moveTo(t.x,t.y),n.lineTo(e.x,e.y)},toTex:function(){var n=this.start,t=this.end;return"\\text{Line: }"+bt(t.y-n.y,!1)+" \\cdot x "+bt(n.x-t.x)+" \\cdot y "+bt(t.x*n.y-n.x*t.y)+" = 0\\text{, }"+v(_.min(n.x,t.x))+" \\le x \\le "+v(_.max(n.x,t.x))+"\\text{, }"+v(_.min(n.y,t.y))+" \\le y \\le "+v(_.max(n.y,t.y))},toString:function(){return"Line("+[v(this.start),v(this.end)].join(",")+")"}})),rn=(j.Line=a,t(n,{constructor:function n(t){var e,r=this,i=null,o=null,u=null;return t instanceof n?t:r instanceof n?(r.$super("constructor",[t]),C(r,"length",{get:function(){return i=null==i?zn(r._lines):i},enumerable:!0,configurable:!1}),C(r,"_bbox",{get:function(){return o=null==o?e(r._points):o},enumerable:!(e=function(t){var n=On(t[0].x-2*t[1].x+t[2].x,t[1].x-t[0].x),n=!1===n?[t[1]]:n.map(function(n){return 0<=n&&n<=1?Wn(n,t):t[1]}),e=On(t[0].y-2*t[1].y+t[2].y,t[1].y-t[0].y),e=!1===e?[t[1]]:e.map(function(n){return 0<=n&&n<=1?Wn(n,t):t[1]}),r=_.min.apply(_,n.concat([t[0],t[2]]).map(ft)),n=_.max.apply(_,n.concat([t[0],t[2]]).map(ft));return{ymin:_.min.apply(_,e.concat([t[0],t[2]]).map(ht)),xmin:r,ymax:_.max.apply(_,e.concat([t[0],t[2]]).map(ht)),xmax:n}}),configurable:!1}),C(r,"_hull",{get:function(){return u=null==u?et(r._points,e).map(V):u},enumerable:!1,configurable:!1}),void(r.isChanged=function(n){return!0===n&&(u=o=i=null),r.$super("isChanged",arguments)})):new n(t)},name:"QBezier",clone:function(){return new rn(this.points.map(function(n){return n.clone()}))},transform:function(t){return new rn(this.points.map(function(n){return n.transform(t)}))},f:function(n){return Wn(n,this._points)},hasPoint:function(n){return dn(n,this._points)},intersects:function(n){var t,e=this;return n instanceof V?!!e.hasPoint(n)&&[n]:j.Circle&&n instanceof j.Circle?!!(t=jn(e._points,n.center,n.radius,n.radius,[1,0],null))&&t.map(V):j.Ellipse&&n instanceof j.Ellipse?!!(t=jn(e._points,n.center,n.radiusX,n.radiusY,n.cs,null))&&t.map(V):j.Arc&&n instanceof j.Arc?!!(t=jn(e._points,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta,n.largeArc,n.sweep))&&t.map(V):n instanceof rn?!!(t=function(n,t){var e,r,i,o,u,s,a;if(e=Zn(n),r=Zn(t),!(i=In(e[0],e[1],e[2],e[3],e[4],e[5],r[0],r[1],r[2],r[3],r[4],r[5])))return!1;for(s=0,a=i.length,o=new Array(a),u=0;s<a;++s)dn(i[s],n)&&dn(i[s],t)&&(o[u++]=i[s]);return o.length=u,!!o.length&&o}(e._points,n._points))&&t.map(V):n instanceof x&&n.intersects(e)},bezierPoints:function(n){return k(n=arguments.length?B(n,0,1):1,1)&&(n=1),[u(this._points,n)]},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t._points,e=["M",e[0].x,e[0].y,"Q",e[1].x,e[1].y,e[2].x,e[2].y].join(" ");return arguments.length?m("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),n.stroke()},toCanvasPath:function(n){var t=this._points;n.beginPath(),n.moveTo(t[0].x,t[0].y),n.quadraticCurveTo(t[1].x,t[1].y,t[2].x,t[2].y)}})),on=(j.QBezier=rn,t(n,{constructor:function n(t){var e,r=this,i=null,o=null,u=null;return t instanceof n?t:r instanceof n?(r.$super("constructor",[t]),C(r,"length",{get:function(){return i=null==i?zn(r._lines):i},enumerable:!0,configurable:!1}),C(r,"_bbox",{get:function(){return o=null==o?e(r._points):o},enumerable:!(e=function(e){var n=X(3*(-e[0].x+3*e[1].x-3*e[2].x+e[3].x),2*(3*e[0].x-6*e[1].x+3*e[2].x),-3*e[0].x+3*e[1].x),n=!1===n?[e[1],e[2]]:n.map(function(n,t){return 0<=n&&n<=1?Jn(n,e):e[t+1]}),t=X(3*(-e[0].y+3*e[1].y-3*e[2].y+e[3].y),2*(3*e[0].y-6*e[1].y+3*e[2].y),-3*e[0].y+3*e[1].y),t=!1===t?[e[1],e[2]]:t.map(function(n,t){return 0<=n&&n<=1?Jn(n,e):e[t+1]}),r=_.min.apply(_,n.concat([e[0],e[3]]).map(ft)),n=_.max.apply(_,n.concat([e[0],e[3]]).map(ft));return{ymin:_.min.apply(_,t.concat([e[0],e[3]]).map(ht)),xmin:r,ymax:_.max.apply(_,t.concat([e[0],e[3]]).map(ht)),xmax:n}}),configurable:!1}),C(r,"_hull",{get:function(){return u=null==u?et(r._points,e).map(V):u},enumerable:!1,configurable:!1}),void(r.isChanged=function(n){return!0===n&&(u=o=i=null),r.$super("isChanged",arguments)})):new n(t)},name:"CBezier",clone:function(){return new on(this.points.map(function(n){return n.clone()}))},transform:function(t){return new on(this.points.map(function(n){return n.transform(t)}))},f:function(n){return Jn(n,this._points)},hasPoint:function(n){var t,e=this._points;return!!((t=Ln(-e[0].x+3*e[1].x-3*e[2].x+e[3].x,3*e[0].x-6*e[1].x+3*e[2].x,-3*e[0].x+3*e[1].x,e[0].x-n.x))&&(2<t.length&&(t[2]<0||1<t[2])&&t.pop(),1<t.length&&(t[1]<0||1<t[1])&&t.splice(1,1),t.length&&(t[0]<0||1<t[0])&&t.shift(),t.length)&&(e=Ln(-e[0].y+3*e[1].y-3*e[2].y+e[3].y,3*e[0].y-6*e[1].y+3*e[2].y,-3*e[0].y+3*e[1].y,e[0].y-n.y))&&(2<e.length&&(e[2]<0||1<e[2])&&e.pop(),1<e.length&&(e[1]<0||1<e[1])&&e.splice(1,1),e.length&&(e[0]<0||1<e[0])&&e.shift(),e.length))&&(2<t.length&&2<e.length?k(t[0],e[0])&&(k(t[1],e[1])&&k(t[2],e[2])||k(t[1],e[2])&&k(t[2],e[1]))||k(t[1],e[1])&&k(t[0],e[2])&&k(t[2],e[0])||k(t[2],e[2])&&k(t[0],e[1])&&k(t[1],e[0])||k(t[0],e[1])&&k(t[1],e[2])&&k(t[2],e[0])||k(t[0],e[2])&&k(t[1],e[0])&&k(t[2],e[1]):2<t.length&&1<e.length?k(t[0],e[0])&&(k(t[1],e[1])||k(t[2],e[1]))||k(t[1],e[1])&&(k(t[0],e[0])||k(t[2],e[0]))||k(t[2],e[0])&&(k(t[1],e[1])||k(t[0],e[1]))||k(t[1],e[0])&&(k(t[2],e[1])||k(t[0],e[1])):1<t.length&&2<e.length?k(e[0],t[0])&&(k(e[1],t[1])||k(e[2],t[1]))||k(e[1],t[1])&&(k(e[0],t[0])||k(e[2],t[0]))||k(e[2],t[0])&&(k(e[1],t[1])||k(e[0],t[1]))||k(e[1],t[0])&&(k(e[2],t[1])||k(e[0],t[1])):2<t.length&&1===e.length?k(t[0],e[0])||k(t[1],e[0])||k(t[2],e[0]):2<e.length&&1===t.length?k(e[0],t[0])||k(e[1],t[0])||k(e[2],t[0]):1<t.length&&1===e.length?k(t[0],e[0])||k(t[1],e[0]):1<e.length&&1===t.length?k(e[0],t[0])||k(e[1],t[0]):k(t[0],e[0]))},intersects:function(n){var t,e=this;return n instanceof V?!!e.hasPoint(n)&&[n]:j.Circle&&n instanceof j.Circle?!!(t=Vn(e._lines,n.center,n.radius))&&t.map(V):j.Ellipse&&n instanceof j.Ellipse?!!(t=Xn(e._lines,n.center,n.radiusX,n.radiusY,n.cs))&&t.map(V):j.Arc&&n instanceof j.Arc?!!(t=Yn(e._lines,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta))&&t.map(V):j.QBezier&&n instanceof j.QBezier?!!(t=Tn(e._lines,n._points))&&t.map(V):n instanceof on?!!(t=Bn(e._lines,n._points))&&t.map(V):n instanceof x&&n.intersects(e)},intersectsSelf:function(){var n=this._points,t=n[0].x,e=n[0].y,r=n[1].x,i=n[1].y,o=n[2].x,u=n[2].y,o=Qn(o-r,r-t,-(n[3].x-t),u-i,i-e,-(n[3].y-e));return!!o&&(r=o[0].x,t=o[0].y,!(1<r||(r+1)*(3-r)<4*t||0<r&&2*t+r<$(3*r*(4-r))||3*t<r*(3-r)))&&0<=(i=((u=(r-3)/(r+t-3))-$(u*u-4*(u*u+3/(r+t-3))))/2)&&i<=1&&[V(this.f(i))]},bezierPoints:function(n){return k(n=arguments.length?B(n,0,1):1,1)&&(n=1),[u(this._points,n)]},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t._points,e=["M",e[0].x,e[0].y,"C",e[1].x,e[1].y,e[2].x,e[2].y,e[3].x,e[3].y].join(" ");return arguments.length?m("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),n.stroke()},toCanvasPath:function(n){var t=this._points;n.beginPath(),n.moveTo(t[0].x,t[0].y),n.bezierCurveTo(t[1].x,t[1].y,t[2].x,t[2].y,t[3].x,t[3].y)}})),un=(j.CBezier=on,t(p,{constructor:function n(t){var e=this,r=null,i=null,o=null,u=null;return t instanceof n?t:e instanceof n?(e.$super("constructor",[t]),C(e,"lines",{get:function(){var r=e.points;return 1<r.length?r.reduce(function(n,t,e){return e+1<r.length&&(n[e]=new a(t,r[e+1])),n},new Array(r.length-1)):[]},enumerable:!0,configurable:!1}),C(e,"_lines",{get:function(){return e._points},enumerable:!1,configurable:!1}),C(e,"length",{get:function(){return r=null==r?zn(e._points):r},enumerable:!0,configurable:!1}),C(e,"_bbox",{get:function(){return i=null==i?tt(e._points):i},enumerable:!1,configurable:!1}),C(e,"_hull",{get:function(){return o=null==o?et(e._points).map(V):o},enumerable:!1,configurable:!1}),C(e,"_is_convex",{get:function(){return!!e.isClosed()&&(u=null==u?kn(e._points):u)},enumerable:!1,configurable:!1}),void(e.isChanged=function(n){return!0===n&&(u=o=i=r=null),e.$super("isChanged",arguments)})):new n(t)},name:"Polyline",clone:function(){return new un(this.points.map(function(n){return n.clone()}))},transform:function(t){return new un(this.points.map(function(n){return n.transform(t)}))},isClosed:function(){var n=this.points;return 2<n.length&&c(n[0],n[n.length-1])},isConvex:function(){return this._is_convex},f:function(n){var t=this._points,e=t.length-1,r=_.floor(n*e);return 1===n?{x:t[e].x,y:t[e].y}:Un(e*(n-r/e),[t[r],t[r+1]])},fto:function(n){var t=this.points,e=t.length-1,r=_.floor(n*e);return new un(t.slice(0,r+1).concat([Un(e*(n-r/e),[t[r],t[r+1]])]))},hasPoint:function(n){return bn(n,this._points)},hasInsidePoint:function(n,t){return!!this.isClosed()&&(n=Cn(n,{x:this._bbox.xmax+10,y:n.y},this._points),t?1===n:0<n)},intersects:function(n){var t,e=this;return n instanceof V?!!e.hasPoint(n)&&[n]:j.Line&&n instanceof j.Line?!!(t=Gn(e._points,n._points[0],n._points[1]))&&t.map(V):j.Circle&&n instanceof j.Circle?!!(t=Vn(e._points,n.center,n.radius))&&t.map(V):j.Ellipse&&n instanceof j.Ellipse?!!(t=Xn(e._points,n.center,n.radiusX,n.radiusY,n.cs))&&t.map(V):j.Arc&&n instanceof j.Arc?!!(t=Yn(e._points,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta))&&t.map(V):j.QBezier&&n instanceof j.QBezier?!!(t=Tn(e._points,n._points))&&t.map(V):j.CBezier&&n instanceof j.CBezier?!!(t=Bn(e._points,n._points))&&t.map(V):n instanceof un?!!(t=En(e._points,n._points))&&t.map(V):n instanceof x&&n.intersects(e)},intersectsSelf:function(){for(var n,t,e,r,i,o,u=[],s=this._points,a=s.length,l=0;l<a&&!(a<=l+1);++l)for(t=l+2;t<a&&!(a<=t+1);++t)e=s[l],r=s[l+1],i=s[t],o=s[t+1],(n=f(e,r,i,o))&&(0===l&&t===a-2&&c(e,o)?n=n.filter(function(n){return!c(n,e)}):t===l+2&&c(r,i)&&(n=n.filter(function(n){return!c(n,r)})),u.push.apply(u,n));return!!u&&u.map(V)},distanceToPoint:function(r){var i=this.points;return i.length?1===i.length?l(r.x-i[0].x,r.y-i[0].y):i.reduce(function(n,t,e){return n=e+1<i.length?_.min(n,gn(r,i[e],i[e+1])):n},1/0):NaN},bezierPoints:function(n){k(n=arguments.length?B(n,0,1):1,1)&&(n=1);for(var t=this._points,e=t.length-1,r=_.floor(n*e),i=new Array(1===n?r:r+1),o=0;o<r;++o)i[o]=u([t[o],t[o+1]],1);return n<1&&(i[r]=u([t[r],t[r+1]],e*(n-r/e))),i},toSVG:function(n){var t=this;return m("polyline",{id:[t.id,!1],points:[t._points.map(function(n){return v(n.x)+" "+v(n.y)}).join(" "),t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e="M "+t._points.map(function(n){return v(n.x)+" "+v(n.y)}).join(" L ")+(t.isClosed()?" Z":"");return arguments.length?m("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),elf.toCanvasPath(n),this.isClosed()&&"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t,e=this._points,r=e.length;for(n.beginPath(),n.moveTo(e[0].x,e[0].y),t=1;t<r;++t)n.lineTo(e[t].x,e[t].y);this.isClosed()&&n.closePath()},toTex:function(){return"\\text{Polyline: }\\begin{cases}&"+this.lines.map(_t).join("\\\\&")+"\\end{cases}"},toString:function(){return"Polyline("+this.points.map(v).join(",")+")"}})),sn=(j.Polyline=un,t(p,{constructor:function n(t){var r=this,e=null,i=null,o=null,u=null,s=null;return t instanceof n?t:r instanceof n?(r.$super("constructor",[t]),C(r,"vertices",{get:function(){return r.points},set:function(n){r.points=n},enumerable:!0,configurable:!1}),C(r,"edges",{get:function(){var e=r.points;return 1<e.length?e.map(function(n,t){return new a(n,e[(t+1)%e.length])}):[]},enumerable:!0,configurable:!1}),C(r,"_lines",{get:function(){return r._points.concat([r._points[0]])},enumerable:!1,configurable:!1}),C(r,"length",{get:function(){return e=null==e?zn(r._lines):e},enumerable:!0,configurable:!1}),C(r,"area",{get:function(){return i=null==i?function(n){for(var t,e,r=0,i=0,o=n.length-1;i<o;++i)t=n[i],e=n[i+1],r+=ot(t.x,t.y,e.x,e.y)/2;return r}(r._lines):i},enumerable:!0,configurable:!1}),C(r,"_bbox",{get:function(){return o=null==o?tt(r._points):o},enumerable:!1,configurable:!1}),C(r,"_hull",{get:function(){return u=null==u?et(r._points).map(V):u},enumerable:!1,configurable:!1}),C(r,"_is_convex",{get:function(){return s=null==s?kn(r._points):s},enumerable:!1,configurable:!1}),void(r.isChanged=function(n){return!0===n&&(s=u=o=i=e=null),r.$super("isChanged",arguments)})):new n(t)},name:"Polygon",clone:function(){return new sn(this.vertices.map(function(n){return n.clone()}))},transform:function(t){return new sn(this.vertices.map(function(n){return n.transform(t)}))},isClosed:function(){return!0},isConvex:function(){return this._is_convex},f:function(n){var t=this._lines,e=t.length-1,r=_.floor(n*e);return 1===n?{x:t[e].x,y:t[e].y}:Un(e*(n-r/e),[t[r],t[r+1]])},fto:function(n){var t=this.points,e=t.length,r=_.floor(n*e);return new un(t.slice(0,r+1).concat([Un(e*(n-r/e),[t[r],t[(r+1)%e]])]))},hasPoint:function(n){return 2===Cn(n,{x:this._bbox.xmax+10,y:n.y},this._lines)},hasInsidePoint:function(n,t){n=Cn(n,{x:this._bbox.xmax+10,y:n.y},this._lines);return t?1===n:0<n},intersects:function(n){var t,e=this;return n instanceof V?!!e.hasPoint(n)&&[n]:j.Line&&n instanceof j.Line?!!(t=Gn(e._lines,n._points[0],n._points[1]))&&t.map(V):j.Circle&&n instanceof j.Circle?!!(t=Vn(e._lines,n.center,n.radius))&&t.map(V):j.Ellipse&&n instanceof j.Ellipse?!!(t=Xn(e._lines,n.center,n.radiusX,n.radiusY,n.cs))&&t.map(V):j.Arc&&n instanceof j.Arc?!!(t=Yn(e._lines,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta))&&t.map(V):j.QBezier&&n instanceof j.QBezier?!!(t=Tn(e._lines,n._points))&&t.map(V):j.CBezier&&n instanceof j.CBezier?!!(t=Bn(e._lines,n._points))&&t.map(V):j.Polyline&&n instanceof j.Polyline||n instanceof sn?!!(t=En(e._lines,n._lines))&&t.map(V):n instanceof x&&n.intersects(e)},intersectsSelf:function(){for(var n,t,e,r,i,o,u=[],s=this._lines,a=s.length,l=0;l<a&&!(a<=l+1);++l)for(t=l+2;t<a&&!(a<=t+1);++t)e=s[l],r=s[l+1],i=s[t],o=s[t+1],(n=f(e,r,i,o))&&(0===l&&t===a-2&&c(e,o)?n=n.filter(function(n){return!c(n,e)}):t===l+2&&c(r,i)&&(n=n.filter(function(n){return!c(n,r)})),u.push.apply(u,n));return!!u&&u.map(V)},bezierPoints:function(n){k(n=arguments.length?B(n,0,1):1,1)&&(n=1);for(var t=this._lines,e=t.length-1,r=_.floor(n*e),i=new Array(1===n?r:r+1),o=0;o<r;++o)i[o]=u([t[o],t[o+1]],1);return n<1&&(i[r]=u([t[r],t[r+1]],e*(n-r/e))),i},toSVG:function(n){var t=this;return m("polygon",{id:[t.id,!1],points:[t._points.map(function(n){return v(n.x)+" "+v(n.y)}).join(" "),t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e="M "+t._lines.map(function(n){return v(n.x)+" "+v(n.y)}).join(" L ")+" Z";return arguments.length?m("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t,e=this._lines,r=e.length;for(n.beginPath(),n.moveTo(e[0].x,e[0].y),t=1;t<r;++t)n.lineTo(e[t].x,e[t].y);n.closePath()},toTex:function(){return"\\text{Polygon: }\\left("+this.vertices.map(_t).join(",")+"\\right)"},toString:function(){return"Polygon("+this.vertices.map(v).join(",")+")"}})),n=t(j.Polygon=sn,{constructor:function n(t,e,r){var i,o,u=this;return t instanceof n?t:u instanceof n?(i=V(t),o=wt(e)&&wt(r)?new V(i.x+O(e),i.y+O(r)):V(e),u.$super("constructor",[[i,new V(o.x,i.y),o,new V(i.x,o.y)]]),C(u,"topLeft",{get:function(){return u.points[0]},set:function(n){u.points[0]=n},enumerable:!0,configurable:!1}),C(u,"bottomRight",{get:function(){return u.points[2]},set:function(n){u.points[2]=n},enumerable:!0,configurable:!1}),C(u,"width",{get:function(){return w(u.bottomRight.x-u.topLeft.x)},set:function(n){u.bottomRight.x=u.topLeft.x+O(n)},enumerable:!0,configurable:!1}),void C(u,"height",{get:function(){return w(u.bottomRight.y-u.topLeft.y)},set:function(n){u.bottomRight.y=u.topLeft.y+O(n)},enumerable:!0,configurable:!1})):new n(t,e,r)}}),an=(j.Rect=n,t(W,{constructor:function n(t,e,r,i,o,u,s){var a,l=this,c=null,f=null,h=null,g=null,y=null,x=0,p=0,d=null,m=null,v=null,b=null;return t instanceof n?t:l instanceof n?(c=new G(_.abs(O(r))),f=new G(_.abs(O(i))),h=new G(o),x=_.cos(z(h.val())),p=_.sin(z(h.val())),g=new G(u?1:0),y=new G(s?1:0),l.$super("constructor",[[t,e],{radiusX:c,radiusY:f,angle:h,largeArc:g,sweep:y}]),C(l,"start",{get:function(){return l.points[0]},set:function(n){l.points[0]=n},enumerable:!0,configurable:!1}),C(l,"end",{get:function(){return l.points[1]},set:function(n){l.points[1]=n},enumerable:!0,configurable:!1}),C(l,"radiusX",{get:function(){return c.val()},set:function(n){c.val(_.abs(O(n))),c.isChanged()&&(l.isChanged(!0),l.triggerChange())},enumerable:!0,configurable:!1}),C(l,"radiusY",{get:function(){return f.val()},set:function(n){f.val(_.abs(O(n))),f.isChanged()&&(l.isChanged(!0),l.triggerChange())},enumerable:!0,configurable:!1}),C(l,"angle",{get:function(){return h.val()},set:function(n){h.val(n),x=_.cos(z(h.val())),p=_.sin(z(h.val())),h.isChanged()&&(l.isChanged(!0),l.triggerChange())},enumerable:!0,configurable:!1}),C(l,"largeArc",{get:function(){return g.val()},set:function(n){g.val(n?1:0),g.isChanged()&&(l.isChanged(!0),l.triggerChange())},enumerable:!0,configurable:!1}),C(l,"sweep",{get:function(){return y.val()},set:function(n){y.val(n?1:0),y.isChanged()&&(l.isChanged(!0),l.triggerChange())},enumerable:!0,configurable:!1}),C(l,"center",{get:function(){return l._params[0]},enumerable:!1,configurable:!1}),C(l,"theta",{get:function(){return l._params[1]},enumerable:!1,configurable:!1}),C(l,"dtheta",{get:function(){return l._params[2]},enumerable:!1,configurable:!1}),C(l,"rX",{get:function(){return l._params[3]},enumerable:!1,configurable:!1}),C(l,"rY",{get:function(){return l._params[4]},enumerable:!1,configurable:!1}),C(l,"cs",{get:function(){return[x,p]},enumerable:!1,configurable:!1}),C(l,"_params",{get:function(){return d=null==d?function(n,t,e,r,i,o,u,s,a){var l=a[0],a=a[1],c=l*(n-e)/2+a*(t-r)/2,f=-a*(n-e)/2+l*(t-r)/2,h=c*c,g=f*f,y=u*u,x=s*s,p=h/y+g/x;1<p&&(p=$(p),y=(u*=p)*u,x=(s*=p)*s);p=$(w((y*x-y*g-x*h)/(y*g+x*h)))*(i===o?-1:1),y=p*u*f/s,g=-p*s*c/u,x=l*y-a*g+(n+e)/2,h=a*y+l*g+(t+r)/2,i=E(st(1,0,(c-y)/u,(f-g)/s)),p=st((c-y)/u,(f-g)/s,(-c-y)/u,(-f-g)/s);p-=_.floor(p/A)*A,!o&&0<p&&(p-=A);o&&p<0&&(p+=A);return[{x:x,y:h},i,p,u,s]}(l.start.x,l.start.y,l.end.x,l.end.y,l.largeArc,l.sweep,l.radiusX,l.radiusY,l.cs):d},enumerable:!1,configurable:!1}),C(l,"length",{get:function(){return m=null==m?zn(l._lines):m},enumerable:!0,configurable:!1}),C(l,"_bbox",{get:function(){return v=null==v?a(l.start,l.end,l.center.x,l.center.y,l.rX,l.rY,l.theta,l.dtheta,l.angle,l.largeArc,l.sweep,x,p):v},enumerable:!(a=function(n,t,e,r,i,o,u,s,a,l,c,f,h){var g,y,s=u+s,a=_.tan(z(a)),x=_.atan2(-o*a,i),p=Y(x,e,r,i,o,f,h),d=Y(x+S,e,r,i,o,f,h),a=Y(x=_.atan2(o,i*a),e,r,i,o,f,h),f=Y(x+S,e,r,i,o,f,h),h=p.x<d.x?(g=p,d):(g=d,p),d=a.y<f.y?(y=a,f):(y=f,a);return!c&&l&&(x=u,u=s,s=x),p=E(u),f=E(s),s<u&&(f<p?(x=p,p=f,f=x):l=!l),a=E(st(1,0,(g.x-e)/i,(g.y-r)/o)),c=E(st(1,0,(h.x-e)/i,(h.y-r)/o)),s=E(st(1,0,(y.x-e)/i,(y.y-r)/o)),u=E(st(1,0,(d.x-e)/i,(d.y-r)/o)),(!l&&(a<p||f<a)||l&&!(a<p||f<a))&&(g=n.x<t.x?n:t),(!l&&(c<p||f<c)||l&&!(c<p||f<c))&&(h=n.x>t.x?n:t),(!l&&(s<p||f<s)||l&&!(s<p||f<s))&&(y=n.y<t.y?n:t),(!l&&(u<p||f<u)||l&&!(u<p||f<u))&&(d=n.y>t.y?n:t),{ymin:y.y,xmin:g.x,ymax:d.y,xmax:h.x}}),configurable:!1}),C(l,"_hull",{get:function(){var t,n,e,r,i,o,u,s;return null==b&&(t=l.center,n=l.rX,e=l.rY,r=l.theta,i=l.dtheta,o=l.start,u=l.end,s=_.abs(i)+q<A?[{x:(s=a(nt(null,o,x,-p,t.x,t.y),nt(null,u,x,-p,t.x,t.y),t.x,t.y,n,e,r,i,0,l.largeArc,l.sweep,1,0)).xmin,y:s.ymin},{x:s.xmax,y:s.ymin},{x:s.xmax,y:s.ymax},{x:s.xmin,y:s.ymax}].map(function(n){return nt(n,n,x,p,t.x,t.y)}):[T(-1,-1,t.x,t.y,n,e,x,p),T(1,-1,t.x,t.y,n,e,x,p),T(1,1,t.x,t.y,n,e,x,p),T(-1,1,t.x,t.y,n,e,x,p)],b=s.map(V)),b},enumerable:!1,configurable:!1}),void(l.isChanged=function(n){return!0===n&&(b=v=m=d=null),l.$super("isChanged",arguments)})):new n(t,e,r,i,o,u,s)},name:"Arc",clone:function(){var n=this;return new an(n.start.clone(),n.end.clone(),n.radiusX,n.radiusY,n.angle,n.largeArc,n.sweep)},transform:function(n){var t=this,e=t.radiusX,r=t.radiusY,i=t.angle,o=ct(n.getRotationAngle()),u=n.getScale();return new an(t.start.transform(n),t.end.transform(n),e*u.x,r*u.y,i+o,t.largeArc,t.sweep)},intersects:function(n){var t,e=this;return n instanceof V?!!e.hasPoint(n)&&[n]:j.Circle&&n instanceof j.Circle?!!(t=An(e.center,e.rX,e.rY,e.cs,e.theta,e.dtheta,e.largeArc,e.sweep,n.center,n.radius,n.radius,[1,0],null))&&t.map(V):j.Ellipse&&n instanceof j.Ellipse?!!(t=An(e.center,e.rX,e.rY,e.cs,e.theta,e.dtheta,e.largeArc,e.sweep,n.center,n.radiusX,n.radiusY,n.cs,null))&&t.map(V):n instanceof an?!!(t=An(e.center,e.rX,e.rY,e.cs,e.theta,e.dtheta,e.largeArc,e.sweep,n.center,n.rX,n.rY,n.cs,n.theta,n.dtheta,n.largeArc,n.sweep))&&t.map(V):n instanceof x&&n.intersects(e)},toSVG:function(n){return this.toSVGPath(!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t.start,r=t.end,i=t.radiusX,o=t.radiusY,u=t.angle,s=t.largeArc?1:0,a=t.sweep?1:0,e=["M",e.x,e.y,"A",i,o,u,s,a,r.x,r.y].join(" ");return arguments.length?m("path",{id:[t.id,!1],d:[e,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):e},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),n.stroke()},toCanvasPath:function(n){var t=this,e=t.center,r=t.rX,i=t.rY,o=!t.sweep,u=z(t.angle),s=t.theta,t=t.dtheta;n.beginPath(),n.ellipse(e.x,e.y,r,i,u,s,s+t,o),w(t)+Q>=A&&n.closePath()},toTex:function(){var n=this;return"\\text{Arc: }\\left("+[_t(n.start),_t(n.end),v(n.radiusX),v(n.radiusY),v(n.angle)+"\\text{}",v(n.largeArc?1:0),v(n.sweep?1:0)].join(",")+"\\right)"},toString:function(){var n=this;return"Arc("+[v(n.start),v(n.end),v(n.radiusX),v(n.radiusY),v(n.angle)+"",v(n.largeArc),v(n.sweep)].join(",")+")"}})),ln=(j.Arc=an,t(W,{constructor:function n(t,e){var r=this,i=null,o=null,u=null,s=null;return t instanceof n?t:r instanceof n?(i=new G(_.abs(O(e))),r.$super("constructor",[[t],{radius:i}]),C(r,"center",{get:function(){return r.points[0]},set:function(n){r.points[0]=n},enumerable:!0,configurable:!1}),C(r,"radius",{get:function(){return i.val()},set:function(n){i.val(_.abs(O(n))),i.isChanged()&&(r.isChanged(!0),r.triggerChange())},enumerable:!0,configurable:!1}),C(r,"radiusX",{get:function(){return r.radius},set:function(n){r.radius=n},enumerable:!0,configurable:!1}),C(r,"radiusY",{get:function(){return r.radius},set:function(n){r.radius=n},enumerable:!0,configurable:!1}),C(r,"rX",{get:function(){return r.radius},enumerable:!0,configurable:!1}),C(r,"rY",{get:function(){return r.radius},enumerable:!0,configurable:!1}),C(r,"angle",{get:function(){return 0},set:function(n){},enumerable:!0,configurable:!1}),C(r,"theta",{get:function(){return 0},enumerable:!1,configurable:!1}),C(r,"dtheta",{get:function(){return A},enumerable:!1,configurable:!1}),C(r,"cs",{get:function(){return[1,0]},enumerable:!1,configurable:!1}),C(r,"length",{get:function(){return o=null==o?A*i.val():o},enumerable:!0,configurable:!1}),C(r,"area",{get:function(){return u=null==u?S*i.val()*i.val():u},enumerable:!0,configurable:!1}),C(r,"_bbox",{get:function(){var n,t;return null==s&&(n=r.center,t=i.val(),s={ymin:n.y-t,xmin:n.x-t,ymax:n.y+t,xmax:n.x+t}),s},enumerable:!1,configurable:!1}),void(r.isChanged=function(n){return!0===n&&(s=u=o=null),r.$super("isChanged",arguments)})):new n(t,e)},name:"Circle",clone:function(){return new ln(this.center.clone(),this.radius)},transform:function(n){var t=this.center,e=this.radius,r=t.transform(n),t=new V(t.x+e,t.y+e).transform(n);return new ln(r,rt(r,t))},isClosed:function(){return!0},intersects:function(n){var t;return n instanceof V?!!this.hasPoint(n)&&[n]:n instanceof ln?!!(t=function(n,t,e,r){t<r&&(i=t,t=r,r=i,i=n,n=e,e=i);var i=e.x-n.x,e=e.y-n.y,o=l(i,e);if(k(o,0)&&k(t,r))return!1;if(t+r<o||o+r<t)return!1;i/=o,e/=o;r=(t*t-r*r+o*o)/(2*o),o=n.x+r*i,n=n.y+r*e,t=$(t*t-r*r);return h(t,0)?[{x:o,y:n}]:[{x:o+t*e,y:n-t*i},{x:o-t*e,y:n+t*i}]}(this.center,this.radius,n.center,n.radius))&&t.map(V):n instanceof x&&n.intersects(this)},toSVG:function(n){var t=this,e=t.center,r=t.radius;return m("circle",{id:[t.id,!1],cx:[e.x,t.center.isChanged()],cy:[e.y,t.center.isChanged()],r:[r,t.values.radius.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t.center,r=t.radius,r=["M",e.x-r,e.y,"A",r,r,0,0,0,e.x+r,e.y,"A",r,r,0,0,0,e.x-r,e.y,"Z"].join(" ");return arguments.length?m("path",{id:[t.id,!1],d:[r,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):r},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t=this.center,e=this.radius;n.beginPath(),n.arc(t.x,t.x,e,0,A),n.closePath()},toTex:function(){var n=this.center,t=v(this.radius);return"\\text{Circle: }\\left|\\begin{pmatrix}\\frac{x"+bt(-n.x)+"}{"+t+"}\\\\\\frac{y"+bt(-n.y)+"}{"+t+"}\\end{pmatrix}\\right|^2 = 1"},toString:function(){return"Circle("+[v(this.center),v(this.radius)].join(",")+")"}})),cn=(j.Circle=ln,t(W,{constructor:function n(t,e,r,i){var s=this,a=null,l=null,o=null,c=0,f=0,u=null,h=null,g=null,y=null;return t instanceof n?t:s instanceof n?(a=new G(_.abs(O(e))),l=new G(_.abs(O(r))),o=new G(i),c=_.cos(z(o.val())),f=_.sin(z(o.val())),s.$super("constructor",[[t],{radiusX:a,radiusY:l,angle:o}]),C(s,"center",{get:function(){return s.points[0]},set:function(n){s.points[0]=n},enumerable:!0,configurable:!1}),C(s,"radiusX",{get:function(){return a.val()},set:function(n){a.val(_.abs(O(n))),a.isChanged()&&(s.isChanged(!0),s.triggerChange())},enumerable:!0,configurable:!1}),C(s,"radiusY",{get:function(){return l.val()},set:function(n){l.val(_.abs(O(n))),l.isChanged()&&(s.isChanged(!0),s.triggerChange())},enumerable:!0,configurable:!1}),C(s,"rX",{get:function(){return s.radiusX},enumerable:!0,configurable:!1}),C(s,"rY",{get:function(){return s.radiusY},enumerable:!0,configurable:!1}),C(s,"angle",{get:function(){return o.val()},set:function(n){o.val(n),c=_.cos(z(o.val())),f=_.sin(z(o.val())),o.isChanged()&&(s.isChanged(!0),s.triggerChange())},enumerable:!0,configurable:!1}),C(s,"theta",{get:function(){return 0},enumerable:!1,configurable:!1}),C(s,"dtheta",{get:function(){return A},enumerable:!1,configurable:!1}),C(s,"cs",{get:function(){return[c,f]},enumerable:!1,configurable:!1}),C(s,"length",{get:function(){return u=null==u?S*(3*(a.val()+l.val())-$((3*a.val()+l.val())*(a.val()+3*l.val()))):u},enumerable:!0,configurable:!1}),C(s,"area",{get:function(){return h=null==h?S*a.val()*l.val():h},enumerable:!0,configurable:!1}),C(s,"_bbox",{get:function(){var n,t,e,r,i,o,u;return null==g&&(n=s.center,t=a.val(),e=l.val(),o=_.tan(z(s.angle)),r=Y(u=_.atan2(-e*o,t),n.x,n.y,t,e,c,f),i=Y(u+S,n.x,n.y,t,e,c,f),o=Y(u=_.atan2(e,t*o),n.x,n.y,t,e,c,f),u=Y(u+S,n.x,n.y,t,e,c,f),g={ymin:_.min(o.y,u.y),xmin:_.min(r.x,i.x),ymax:_.max(o.y,u.y),xmax:_.max(r.x,i.x)}),g},enumerable:!1,configurable:!1}),C(s,"_hull",{get:function(){var n,t,e;return null==y&&(n=s.center,t=a.val(),e=l.val(),y=[new V(T(-1,-1,n.x,n.y,t,e,c,f)),new V(T(1,-1,n.x,n.y,t,e,c,f)),new V(T(1,1,n.x,n.y,t,e,c,f)),new V(T(-1,1,n.x,n.y,t,e,c,f))]),y},enumerable:!1,configurable:!1}),void(s.isChanged=function(n){return!0===n&&(y=g=h=u=null),s.$super("isChanged",arguments)})):new n(t,e,r,i)},name:"Ellipse",clone:function(){return new cn(this.center.clone(),this.radiusX,this.radiusY,this.angle)},transform:function(n){var t=this.center,e=this.radiusX,r=this.radiusY,i=this.angle,o=n.getTranslation(),u=ct(n.getRotationAngle()),n=n.getScale();return new cn(new V(t.x+o.x,t.y+o.y),e*n.x,r*n.y,i+u)},isClosed:function(){return!0},intersects:function(n){var t,e=this;return n instanceof V?!!e.hasPoint(n)&&[n]:j.Circle&&n instanceof j.Circle?!!(t=An(e.center,e.radiusX,e.radiusY,e.cs,null,null,null,0,n.center,n.radius,n.radius,[1,0],null,null,null))&&t.map(V):n instanceof cn?!!(t=An(e.center,e.radiusX,e.radiusY,e.cs,null,null,null,0,n.center,n.radiusX,n.radiusY,n.cs,null,null,null))&&t.map(V):n instanceof x&&n.intersects(e)},toSVG:function(n){var t=this,e=t.center,r=t.radiusX,i=t.radiusY,o=t.angle;return m("ellipse",{id:[t.id,!1],cx:[e.x,t.center.isChanged()],cy:[e.y,t.center.isChanged()],rx:[r,t.values.radiusX.isChanged()],ry:[i,t.values.radiusY.isChanged()],transform:["rotate("+v(o)+" "+v(e.x)+" "+v(e.y)+")",t.center.isChanged()||t.values.angle.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},!!arguments.length&&n)},toSVGPath:function(n){var t=this,e=t.radiusX,r=t.radiusY,i=t.angle,o=t.f(0),u=t.f(.5),u=["M",o.x,o.y,"A",e,r,i,0,1,u.x,u.y,"A",e,r,i,0,1,o.x,o.y,"Z"].join(" ");return arguments.length?m("path",{id:[t.id,!1],d:[u,t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n):u},toCanvas:function(n){this.style.toCanvas(n),this.toCanvasPath(n),"none"!==this.style.fill&&n.fill(),n.stroke()},toCanvasPath:function(n){var t=this.center,e=this.radiusX,r=this.radiusY,i=z(this.angle);n.beginPath(),n.ellipse(t.x,t.x,e,r,i,0,A),n.closePath()},toTex:function(){var n=v(this.angle)+"\\text{}",t=this.center,e=v(this.radiusX),r=v(this.radiusY);return"\\text{Ellipse: }\\left|\\begin{pmatrix}\\cos("+n+")&-\\sin("+n+")\\\\sin("+n+")&\\cos("+n+")\\end{pmatrix}\\begin{pmatrix}\\frac{x"+bt(-t.x)+"}{"+e+"}\\\\\\frac{y"+bt(-t.y)+"}{"+r+"}\\end{pmatrix}\\right|^2 = 1"},toString:function(){return"Ellipse("+[v(this.center),v(this.radiusX),v(this.radiusY),v(this.angle)+""].join(",")+")"}})),fn=(j.Ellipse=cn,t(x,{constructor:function n(t){var e,r,i,o,u=this,s=null,a=null,l=null,c=null,f=null;if(!(u instanceof n))return new n(t);null==t&&(t=[]),x.call(u),e=function(n){return n instanceof x&&n.onChange(i),n},r=function(n){var t;return n instanceof x&&(n.onChange(i,!1),s)&&(t=s[n.id])&&(t.parentNode&&t.parentNode.removeChild(t),delete s[n.id]),n},(i=function(n){b(_object)&&-1!==a.indexOf(n)&&(u.isChanged(!0),u.triggerChange())}).id=u.id,(o=function(n){u.isChanged(!0),u.triggerChange()}).id=u.id,C(u,"_svgs",{get:function(){return s=null==s?{}:s},set:function(n){null==n&&(s=null)},enumerable:!1,configurable:!1}),C(u,"_bbox",{get:function(){return c=null==c?u._objects.reduce(function(n,t){t=t.getBoundingBox();return n.ymin=_.min(n.ymin,t.ymin),n.xmin=_.min(n.xmin,t.xmin),n.ymax=_.max(n.ymax,t.ymax),n.xmax=_.max(n.xmax,t.xmax),n},{ymin:1/0,xmin:1/0,ymax:-1/0,xmax:-1/0}):c},enumerable:!1,configurable:!1}),C(u,"_hull",{get:function(){return f=null==f?Mn(u._objects.reduce(function(n,t){return n.push.apply(n,t._hull),n},[])):f},enumerable:!1,configurable:!1}),C(u,"objects",{get:function(){return a},set:function(n){a!==n&&(b(a)&&xt(a,r),b(n)?((a=yt(n,e,r)).onChange(o),u.isChanged(!0),u.triggerChange()):null==n&&(l=a=null))},enumerable:!0,configurable:!1}),C(u,"_objects",{get:function(){var t;return null==l&&(t=u.matrix,l=a.map(function(n){return n.transform(t)})),l},enumerable:!1,configurable:!1}),u.isChanged=function(n){return!0===n?f=c=l=null:!1===n&&a.forEach(function(n){n.isChanged(!1)}),x.prototype.isChanged.apply(u,arguments)},u.objects=t},name:"Shape2D",dispose:function(){var t=this;t.objects&&(xt(t.objects,function(n){return n instanceof x&&n.onChange(t.id,!1),n}),t.objects=null,t._svgs=null),x.prototype.dispose.call(t)},clone:function(){return new fn(this.objects.map(function(n){return n.clone()}))},hasMatrix:function(){return!0},transform:function(t){return new fn(this.objects.map(function(n){return n.transform(t)}))},getBoundingBox:function(){var n=this._bbox;return{ymin:n.ymin,xmin:n.xmin,ymax:n.ymax,xmax:n.xmax}},getConvexHull:function(){return this._hull.map(function(n){return n.clone()})},hasPoint:function(n){for(var t=this._objects,e=t.length,r=0;r<e;++r)if(t[r].hasPoint(n))return!0;return!1},intersects:function(n){if(n instanceof V)return!!this.hasPoint(n)&&[n];if(n instanceof x){for(var t,e=[],r=this._objects,i=r.length,o=0;o<i;++o)(t=r[o].intersects(n))&&e.push.apply(e,t);return!!e&&e.map(V)}return!1},intersectsSelf:function(){for(var n,t,e=[],r=this._objects,i=r.length,o=0;o<i;++o)for((n=r[o].intersectsSelf())&&e.push.apply(e,n),t=o+1;t<i;++t)(n=r[o].intersects(r[t]))&&e.push.apply(e,n);return!!e&&e.map(V)},toSVG:function(n){var t=this;return arguments.length?m("g",{id:[t.id,!1],transform:[t.matrix.toSVG(),t.isChanged()],style:[t.style.toSVG(),t.style.isChanged()]},n,null,function(e){var r=t._svgs;t.objects.forEach(function(n){var t;n instanceof x&&n.isChanged()&&((t=r[n.id])?n.toSVG(t):(e.appendChild(t=n.toSVG(null)),r[n.id]=t))})}):m("g",{id:[t.id,!1],transform:[t.matrix.toSVG(),!0],style:[t.style.toSVG(),!0]},!1,t.objects.map(function(n){return n.toSVG()}).join(""))},toSVGPath:function(n){function t(n){return n.toSVGPath()}var e=this;return arguments.length?m("path",{id:[e.id,!1],d:[e.objects.map(t).join(" "),e.isChanged()],transform:[e.matrix.toSVG(),e.isChanged()],style:[e.style.toSVG(),e.style.isChanged()]},n):e._objects.map(t).join(" ")},toCanvas:function(n){var t=n.getTransform();this.matrix.toCanvas(n),this.style.toCanvas(n),this.toCanvasPath(n),n.setTransform(t)},toCanvasPath:function(n){var t,e=this.objects,r=e.length;if(r)for(n.beginPath(),t=0;t<r;++t)e[t].toCanvas(n)}})),n=(j.Shape2D=fn,t(null,{constructor:function n(t,i,o,u,s){var e,r,a=this,l=null,c=null,f=null,h=null,g=!0;if(!(a instanceof n))return new n(t,i,o,u,s);i=O(i),o=O(o),u=O(u),s=O(s),f=[],C(a,"x0",{get:function(){return i},set:function(n){n=O(n),i!==n&&(g=!0),i=n},enumerable:!0,configurable:!(c={})}),C(a,"x1",{get:function(){return u},set:function(n){n=O(n),u!==n&&(g=!0),u=n},enumerable:!0,configurable:!1}),C(a,"y0",{get:function(){return o},set:function(n){n=O(n),o!==n&&(g=!0),o=n},enumerable:!0,configurable:!1}),C(a,"y1",{get:function(){return s},set:function(n){n=O(n),s!==n&&(g=!0),s=n},enumerable:!0,configurable:!1}),a.add=function(n){return n instanceof x&&(D.call(c,n.id)||(c[n.id]=null,f.push(n),g=!0)),a},a.remove=function(n){var t,e=f.indexOf(n);return-1!==e&&(t=c[n.id],y&&t&&t.parentNode&&t.parentNode.removeChild(t),delete c[n.id],f.splice(e,1),g=!0),a},a.getIntersections=function(){if(!f||!f.length)return[];if(g||!h){h=[];for(var n,t,e=0,r=f.length;e<r;++e)for((t=f[e].intersectsSelf())&&h.push.apply(h,t),n=e+1;n<r;++n)(t=f[e].intersects(f[n]))&&h.push.apply(h,t)}return h?h.map(function(n){return n.clone()}):[]},a.dispose=function(){return y&&l&&l.parentNode&&l.parentNode.removeChild(l),y&&window.cancelAnimationFrame(r),f=c=l=null,a},a.toSVG=function(){return m("svg",{xmlns:["http://www.w3.org/2000/svg",!0],viewBox:[v(i)+" "+v(o)+" "+v(u)+" "+v(s),!0]},!1,f.map(function(n){return n instanceof x?n.toSVG():""}).join(""))},a.toCanvas=function(n){return y?e(n||document.createElement("canvas")):n},a.toIMG=function(){return y?a.toCanvas(document.createElement("canvas")).toDataURL("image/png"):""},e=function(n){var t,e,r;return f&&n&&(t=_.abs(u-i),e=_.abs(s-o),n.style.width=v(t)+"px",n.style.height=v(e)+"px",n.width=t,n.height=e,(r=n.getContext("2d")).clearRect(0,0,t,e),r.translate(-i,-o),f.forEach(function(n){n instanceof x&&n.toCanvas(r)})),n},y&&(r=window.requestAnimationFrame(function n(){f&&(l?g&&m("svg",{viewBox:[v(i)+" "+v(o)+" "+v(u)+" "+v(s),g]},l):(l=m("svg",{xmlns:["http://www.w3.org/2000/svg",!1],style:["position:absolute;top:0;left:0;width:100%;height:100%",!1],viewBox:[v(i)+" "+v(o)+" "+v(u)+" "+v(s),g]},null),t.appendChild(l)),f.forEach(function(n){var t;n instanceof x&&(null===(t=c[n.id])?(c[n.id]=t=n.toSVG(null),t&&l.appendChild(t)):t&&n.isChanged()&&n.toSVG(t),n.isChanged(!1))}),g=!1,r=window.requestAnimationFrame(n))}))},dispose:null,add:null,remove:null,getIntersections:null,toSVG:null,toCanvas:null,toIMG:null}));function c(n,t){return k(n.x,t.x)&&k(n.y,t.y)}function hn(n,t,e){var r=t.x,t=t.y,i=e.x,e=e.y,o=n.x,n=n.y,i=i-r,e=e-t,u=l(i,e);return h(u,0)?l(o-r,n-t):w(i*(t-n)-e*(r-o))/u}function gn(n,t,e){var r=t.x,t=t.y,i=e.x,e=e.y,o=n.x,n=n.y,i=i-r,e=e-t,u=l(i,e);return h(u,0)?l(o-r,n-t):(u=_.max(0,_.min(1,((o-r)*i+(n-t)*e)/u)),l(o-r-u*i,n-t-u*e))}function yn(n,t,e,r){return k((t.y-n.y)*(r.x-e.x),(r.y-e.y)*(t.x-n.x))}function xn(n,t,e,r){return k((t.y-n.y)*(r.y-e.y),-(t.x-n.x)*(r.x-e.x))}function d(n,t,e){var r=n.x-t.x,i=e.x-t.x,n=n.y-t.y,e=e.y-t.y;return!!k(n*i,e*r)&&0<=(t=h(i,0)?n/e:r/i)&&t<=1}function pn(n,t,e,r,i,o,u,s){var a=i[0],i=i[1],l=n.x-t.x,n=n.y-t.y,t=E(_.atan2((-i*l+a*n)/r,(a*l+i*n)/e));return 0<=(t=s?1-(E(o+u)-t)/u:(t-o)/u)&&t<=1}function dn(n,t){var e=X(t[0].x-2*t[1].x+t[2].x,-2*t[0].x+2*t[1].x,t[0].x-n.x);return!!(e&&(1<e.length&&(e[1]<0||1<e[1])&&e.pop(),e.length&&(e[0]<0||1<e[0])&&e.shift(),e.length)&&(t=X(t[0].y-2*t[1].y+t[2].y,-2*t[0].y+2*t[1].y,t[0].y-n.y))&&(1<t.length&&(t[1]<0||1<t[1])&&t.pop(),t.length&&(t[0]<0||1<t[0])&&t.shift(),t.length))&&(1<e.length&&1<t.length?k(e[0],t[0])&&k(e[1],t[1])||k(e[0],t[1])&&k(e[1],t[0]):1<e.length&&1===t.length?k(e[0],t[0])||k(e[1],t[0]):1<t.length&&1===e.length?k(t[0],e[0])||k(t[1],e[0]):k(e[0],t[0]))}function mn(n,t,e){var r=n.x-t.x,n=n.y-t.y,t=r*r+n*n,r=e*e;return k(t,r)?2:t<r?1:0}function vn(n,t,e,r,i){var o=i[0],i=i[1],u=n.x-t.x,n=n.y-t.y,t=o*u+i*n,i=-i*u+o*n,u=t*t/(e*e)+i*i/(r*r);return k(u,1)?2:u<1?1:0}function bn(n,t){for(var e=0,r=t.length-1;e<r;++e)if(d(n,t[e],t[e+1]))return!0;return!1}function Cn(n,t,e){for(var r,i,o=0,u=0,s=e.length-1;o<s;++o){if(d(n,r=e[o],i=e[o+1]))return 2;f(n,t,r,i)&&++u}return 1&u?1:0}function f(n,t,e,r){var i=Qn(t.y-n.y,n.x-t.x,t.x*n.y-n.x*t.y,r.y-e.y,e.x-r.x,r.x*e.y-e.x*r.y);return!!(i&&i.length&&d(i[0],n,t)&&d(i[0],e,r))&&i}function _n(n,t,e,r){3<arguments.length&&(e=Nn(e,r));var i,o,u=new Array(2),s=0,a=qn(t.y-n.y,n.x-t.x,t.x*n.y-n.x*t.y,e[0],e[1],e[2],e[3],e[4],e[5]);if(!a)return!1;for(i=0,o=a.length;i<o;++i)d(a[i],n,t)&&(u[s++]=a[i]);return u.length=s,!!u.length&&u}function wn(n,t,e,r,i,o){5<arguments.length&&(e=Rn(e,r,i,o));var u,s,a=new Array(2),l=0,c=qn(t.y-n.y,n.x-t.x,t.x*n.y-n.x*t.y,e[0],e[1],e[2],e[3],e[4],e[5]);if(!c)return!1;for(u=0,s=c.length;u<s;++u)d(c[u],n,t)&&(a[l++]=c[u]);return a.length=l,!!a.length&&a}function $n(n,t,e,r,i,o,u,s,a,l){null==e&&(e=Rn(r,i,o,u));var c,f,h=new Array(2),g=0,y=qn(t.y-n.y,n.x-t.x,t.x*n.y-n.x*t.y,e[0],e[1],e[2],e[3],e[4],e[5]);if(!y)return!1;for(c=0,f=y.length;c<f;++c)d(y[c],n,t)&&pn(y[c],r,i,o,u,s,a,l)&&(h[g++]=y[c]);return h.length=g,!!h.length&&h}function Pn(n,t,e,r){null==e&&(e=Fn(r));var i,o,u,s=new Array(2),a=0,l=t.y-n.y,c=n.x-t.x,f=n.x*(n.y-t.y)+n.y*(t.x-n.x),h=X(l*e[0].x+c*e[0].y,l*e[1].x+c*e[1].y,l*e[2].x+c*e[2].y+f);if(!h)return!1;for(i=0,o=h.length;i<o;++i)h[i]<0||1<h[i]||d(u=Wn(h[i],r),n,t)&&(s[a++]=u);return s.length=a,!!s.length&&s}function Sn(n,t,e,r){null==e&&(e=Hn(r));for(var i,o=new Array(3),u=0,s=t.y-n.y,a=n.x-t.x,l=n.x*(n.y-t.y)+n.y*(t.x-n.x),c=Ln(s*e[0].x+a*e[0].y,s*e[1].x+a*e[1].y,s*e[2].x+a*e[2].y,s*e[3].x+a*e[3].y+l),f=0,h=c.length;f<h;++f)c[f]<0||1<c[f]||d(i=Jn(c[f],r),n,t)&&(o[u++]=i);return o.length=u,!!o.length&&o}function An(n,t,e,r,i,o,u,s,a,l,c,f,h,g,y){var x,p,d,m,v=Rn(n,t,e,r),b=Rn(a,l,c,f),C=In(v[0],v[1],v[2],v[3],v[4],v[5],b[0],b[1],b[2],b[3],b[4],b[5]);if(!C)return!1;for(d=0,m=C.length,x=new Array(m),p=0;d<m;++d)(null==i&&2===vn(C[d],n,t,e,r)||null!=i&&pn(C[d],n,t,e,r,i,o,u))&&(null==h&&2===vn(C[d],a,l,c,f)||null!=h&&pn(C[d],a,l,c,f,h,g,y))&&(x[p++]=C[d]);return x.length=p,!!x.length&&x}function jn(n,t,e,r,i,o,u,s){var a,l,c,f,h=Rn(t,e,r,i),g=Zn(n),y=In(h[0],h[1],h[2],h[3],h[4],h[5],g[0],g[1],g[2],g[3],g[4],g[5]);if(!y)return!1;for(c=0,f=y.length,a=new Array(f),l=0;c<f;++c)(null==o&&2===vn(y[c],t,e,r,i)||null!=o&&pn(y[c],t,e,r,i,o,u,s))&&dn(y[c],n)&&(a[l++]=y[c]);return a.length=l,!!a.length&&a}function Gn(n,t,e){for(var r,i=[],o=n.length-1,u=0;u<o;++u)(r=f(n[u],n[u+1],t,e))&&i.push(r[0]);return!!i.length&&i}function Vn(n,t,e){for(var r,i=[],o=n.length-1,u=Nn(t,e),s=0;s<o;++s)(r=_n(n[s],n[s+1],u))&&i.push.apply(i,r);return!!i.length&&i}function Xn(n,t,e,r,i){for(var o,u=[],s=n.length-1,a=Rn(t,e,r,i),l=0;l<s;++l)(o=wn(n[l],n[l+1],a))&&u.push.apply(u,o);return!!u.length&&u}function Yn(n,t,e,r,i,o,u){for(var s,a=[],l=n.length-1,c=Rn(t,e,r,i),f=0;f<l;++f)(s=$n(n[f],n[f+1],c,t,e,r,i,o,u))&&a.push.apply(a,s);return!!a.length&&a}function Tn(n,t){for(var e,r=[],i=n.length-1,o=Fn(t),u=0;u<i;++u)(e=Pn(n[u],n[u+1],o,t))&&r.push.apply(r,e);return!!r.length&&r}function Bn(n,t){for(var e,r=[],i=n.length-1,o=Hn(t),u=0;u<i;++u)(e=Sn(n[u],n[u+1],o,t))&&r.push.apply(r,e);return!!r.length&&r}function En(n,t){for(var e,r,i=[],o=n.length-1,u=t.length-1,s=0;s<o;++s)for(e=0;e<u;++e)(r=f(n[s],n[s+1],t[e],t[e+1]))&&i.push(r[0]);return!!i.length&&i}function zn(n){for(var t,e,r=0,i=0,o=n.length-1;i<o;++i)t=n[i],e=n[i+1],r+=l(t.x-e.x,t.y-e.y);return r}function Mn(t){var e,n,r,i,o,u,s,a=t.length;if(a<3)return t;for(e=t[0],n=0,r=1;r<a;++r)((i=t[r]).y<e.y||k(i.y,e.y)&&i.x<e.x)&&(e=i,n=r);for(t.splice(n,1),--a,o=t.map(function(n,t){return[function(n,t,e,r){r=_.atan2(r-t,e-n);return r<0?r+A:r}(e.x,e.y,n.x,n.y),t]}).sort(function(n,t){return n[0]-t[0]}).map(function(n){return t[n[1]]}),(u=new Array(a+1))[0]=e,u[1]=o[0],u[2]=o[1],s=3,r=2;r<a;++r){for(;1<s&&0<=at(o[r],u[s-1],u[s-2]);)--s;u[s++]=o[r]}return u.length=s,u}function kn(n){var t=n.length;if(t<3)return!1;var e,r,i=n[t-2].x,o=n[t-2].y,u=n[t-1].x,s=n[t-1].y,a=_.atan2(s-o,u-i),l=0,c=0;for(ndx=0;ndx<t;++ndx){if(i=u,o=s,e=a,u=(r=n[ndx]).x,s=r.y,r=lt((a=_.atan2(s-o,u-i))-e,A,-S,S),0===ndx){if(0===r)return!1;c=0<r?1:-1}else if(c*r<=0)return!1;l+=r}return 1===w(_.round(l/A))}function On(n,t){return!h(n,0)&&[-t/n]}function X(n,t,e){var r;return h(n,0)?On(t,e):k(e=t*t-4*n*e,r=0)?[-t/(2*n)]:!(e<0)&&[(-t-(r=$(e)))/(2*n),(-t+r)/(2*n)]}function Ln(n,t,e,r){var i,o,u,s,a;return h(n,0)?X(t,e,r):(i=(3*(e=e/n)-(t=t/n)*t)/9,o=0,e=(9*t*e-27*(r/n)-2*P(t,3))/54,(a=s=n=r=0)<=(u=P(i,3)+P(e,2))?(n=M(e+(r=$(u)))*P(w(e+r),1/3),s=M(e-r)*P(w(e-r),1/3),k(w(I*(n-s)/2),0)?[-t/3+(n+s),-t/3-(n+s)/2]:[-t/3+(n+s)]):(a=_.acos(e/$(-P(i,3))),[(o=2*$(-i))*_.cos(a/3)-t/3,o*_.cos((a+A)/3)-t/3,o*_.cos((a+2*A)/3)-t/3]))}function Dn(n,t,e,r,i){var o,u,s;return h(n,0)?Ln(t,e,r,i):(t/=n,r/=n,i/=n,!(!(n=X(1,-2*P(e/=n,3)+9*t*e*r-27*r*r-27*t*t*i+72*e*i,P(e*e-3*t*r+12*i,3)))||(i=n[0],n=n[1]||i,(u=t*t/4+(-2*e+M(i)*P(w(i),1/3)+M(n)*P(w(n),1/3))/3)<=0)||(o=$(u),u=(i=3*t*t-8*e-4*u)-(n=(-P(t,3)+4*t*e-8*r)/o),s=[],0<=(e=i+n)&&(h(e,0)?s.push(o/2-t/4):(e=$(e)/4,s.push(o/2-t/4+e),s.push(o/2-t/4-e))),0<=u&&(h(u,0)?s.push(-o/2-t/4):(u=$(u)/4,s.push(-o/2-t/4+u),s.push(-o/2-t/4-u))),!s.length))&&s)}function Qn(n,t,e,r,i,o){var u=n*i-t*r;return!h(u,0)&&[{x:(t*o-e*i)/u,y:(e*r-n*o)/u}]}function qn(n,t,e,r,i,o,u,s,a){var l,c,f;return h(n,0)?!!(f=On(t,e))&&!!(c=X(r,o*(f=f[0])+u,i*f*f+s*f+a))&&(2===c.length?[{x:c[0],y:f},{x:c[1],y:f}]:[{x:c[0],y:f}]):!(h(c=2*(r*t*t+i*n*n-o*n*t),0)||(l=-4*r*i*e*e+4*r*s*e*t-4*r*a*t*t+4*i*u*e*n-4*i*a*n*n+o*o*e*e-2*o*u*e*t-2*o*s*e*n+4*o*a*n*t+u*u*t*t-2*u*s*n*t+s*s*n*n)<0)&&(f=2*r*e*t-o*e*n-u*n*t+s*n*n,h(l,0)?[{x:-(e+t*(-f/c))/n,y:-f/c}]:[{x:-(e+t*((-n*(l=$(l))-f)/c))/n,y:(-n*l-f)/c},{x:-(e+t*((n*l-f)/c))/n,y:(n*l-f)/c}])}function In(n,t,e,r,i,o,u,s,a,l,c,f){var h,g,y,x,p,d,m,v,b,C,_,w;if(v=t,b=e,C=r,_=i,w=o,u=u,s=s,a=a,l=l,c=c,f=f,!(h=Dn((m=[-P(m=n,2)*P(s,2)+2*m*u*v*s-m*v*P(a,2)+m*s*b*a-P(u,2)*P(v,2)+u*v*b*a-u*s*P(b,2),2*m*v*s*l-2*m*v*a*c-2*m*P(s,2)*C+m*s*b*c+m*s*a*_-2*u*P(v,2)*l+2*u*v*s*C+u*v*b*c+u*v*a*_-2*u*s*b*_+v*b*a*l-v*P(a,2)*C-s*P(b,2)*l+s*b*a*C,2*m*v*s*f-m*v*P(c,2)-2*m*P(s,2)*w+m*s*_*c-2*u*P(v,2)*f+2*u*v*s*w+u*v*_*c-u*s*P(_,2)-P(v,2)*P(l,2)+2*v*s*C*l+v*b*a*f+v*b*l*c-v*P(a,2)*w-2*v*a*C*c+v*a*l*_-P(s,2)*P(C,2)-s*P(b,2)*f+s*b*a*w+s*b*C*c-2*s*b*l*_+s*a*C*_,-2*P(v,2)*l*f+2*v*s*C*f+2*v*s*l*w+v*b*c*f+v*a*_*f-2*v*a*c*w-v*C*P(c,2)+v*l*_*c-2*P(s,2)*C*w-2*s*b*_*f+s*b*c*w+s*a*_*w+s*C*_*c-s*l*P(_,2),-P(v,2)*P(f,2)+2*v*s*w*f+v*_*c*f-v*P(c,2)*w-P(s,2)*P(w,2)-s*P(_,2)*f+s*_*c*w])[0],m[1],m[2],m[3],m[4])))return!1;for(x=new Array(8),p=d=0,y=h.length;p<y;++p)(g=X(t,e*h[p]+i,h[p]*(n*h[p]+r)+o))&&(x[d++]={x:h[p],y:g[0]},1<g.length)&&(x[d++]={x:h[p],y:g[1]});return x.length=d,!!x.length&&x}function Nn(n,t){var e=n.x,n=n.y;return[1,1,0,-2*e,-2*n,e*e+n*n-t*t]}function Rn(n,t,e,r){var i=n.x,n=n.y,o=r[0],r=r[1],u=t*t*r*r+e*e*o*o,s=t*t*o*o+e*e*r*r,r=2*(e*e-t*t)*r*o;return[u,s,r,-2*u*i-r*n,-r*i-2*s*n,u*i*i+r*i*n+s*n*n-t*t*e*e]}function Zn(n){return[n[0].y*n[0].y-4*n[0].y*n[1].y+2*n[0].y*n[2].y+4*n[1].y*n[1].y-4*n[1].y*n[2].y+n[2].y*n[2].y,n[0].x*n[0].x-4*n[0].x*n[1].x+2*n[0].x*n[2].x+4*n[1].x*n[1].x-4*n[1].x*n[2].x+n[2].x*n[2].x,-2*n[0].x*n[0].y+4*n[0].x*n[1].y-2*n[0].x*n[2].y+4*n[1].x*n[0].y-8*n[1].x*n[1].y+4*n[1].x*n[2].y-2*n[2].x*n[0].y+4*n[2].x*n[1].y-2*n[2].x*n[2].y,2*n[0].x*n[0].y*n[2].y-4*n[0].x*n[1].y*n[1].y+4*n[0].x*n[1].y*n[2].y-2*n[0].x*n[2].y*n[2].y+4*n[1].x*n[0].y*n[1].y-8*n[1].x*n[0].y*n[2].y+4*n[1].x*n[1].y*n[2].y-2*n[2].x*n[0].y*n[0].y+4*n[2].x*n[0].y*n[1].y+2*n[2].x*n[0].y*n[2].y-4*n[2].x*n[1].y*n[1].y,-2*n[0].x*n[0].x*n[2].y+4*n[0].x*n[1].x*n[1].y+4*n[0].x*n[1].x*n[2].y+2*n[0].x*n[2].x*n[0].y-8*n[0].x*n[2].x*n[1].y+2*n[0].x*n[2].x*n[2].y-4*n[1].x*n[1].x*n[0].y-4*n[1].x*n[1].x*n[2].y+4*n[1].x*n[2].x*n[0].y+4*n[1].x*n[2].x*n[1].y-2*n[2].x*n[2].x*n[0].y,n[0].x*n[0].x*n[2].y*n[2].y-4*n[0].x*n[1].x*n[1].y*n[2].y-2*n[0].x*n[2].x*n[0].y*n[2].y+4*n[0].x*n[2].x*n[1].y*n[1].y+4*n[1].x*n[1].x*n[0].y*n[2].y-4*n[1].x*n[2].x*n[0].y*n[1].y+n[2].x*n[2].x*n[0].y*n[0].y]}function Fn(n){return[{x:n[0].x-2*n[1].x+n[2].x,y:n[0].y-2*n[1].y+n[2].y},{x:2*n[1].x-2*n[0].x,y:2*n[1].y-2*n[0].y},{x:n[0].x,y:n[0].y}]}function Hn(n){return[{x:-n[0].x+3*n[1].x-3*n[2].x+n[3].x,y:-n[0].y+3*n[1].y-3*n[2].y+n[3].y},{x:3*n[0].x-6*n[1].x+3*n[2].x,y:3*n[0].y-6*n[1].y+3*n[2].y},{x:-3*n[0].x+3*n[1].x,y:-3*n[0].y+3*n[1].y},{x:n[0].x,y:n[0].y}]}function Un(n,t){var e=1-n;return{x:e*t[0].x+n*t[1].x,y:e*t[0].y+n*t[1].y}}function Wn(n,t){var e=1-n,r=e*e,e=2*e*n,n=n*n;return{x:r*t[0].x+e*t[1].x+n*t[2].x,y:r*t[0].y+e*t[1].y+n*t[2].y}}function Jn(n,t){var e=1-n,r=n*n,i=e*e,o=e*i,u=r*n,i=3*i*n,n=3*e*r;return{x:o*t[0].x+i*t[1].x+n*t[2].x+u*t[3].x,y:o*t[0].y+i*t[1].y+n*t[2].y+u*t[3].y}}function Kn(n,t,e){var r,i,o,u,s=t.length,a=s-1,l=t.slice(),c=new Array(s);for(c[0]=t[0],r=1;r<=a;++r){for(i=0;i+r<=a;++i)o=l[i],u=l[i+1],l[i]={x:o.x+n*(u.x-o.x),y:o.y+n*(u.y-o.y)};c[r]=l[0]}return e?{pt:l[0],points:c}:l[0]}function u(n,t){t=1===(t=null==t?1:t)?n:Kn(t,n,!0).points;return 4===t.length?[{x:t[0].x,y:t[1].y},{x:t[1].x,y:t[2].y},{x:t[2].x,y:t[3].y},{x:t[3].x,y:t[4].y}]:3===t.length?[{x:t[0].x,y:t[0].y},{x:t[0].x+2*(t[1].x-t[0].x)/3,y:t[0].y+2*(t[1].y-t[0].y)/3},{x:t[2].x+2*(t[1].x-t[2].x)/3,y:t[2].y+2*(t[1].y-t[2].y)/3},{x:t[2].x,y:t[2].y}]:2===t.length?[t[0],{x:t[0].x+(t[1].x-t[0].x)/2,y:t[0].y+(t[1].y-t[0].y)/2},{x:t[0].x+(t[1].x-t[0].x)/2,y:t[0].y+(t[1].y-t[0].y)/2},t[1]]:[{x:t[0].x,y:t[0].y},{x:t[0].x,y:t[0].y},{x:t[0].x,y:t[0].y},{x:t[0].x,y:t[0].y}]}function Y(n,t,e,r,i,o,u){null==o&&(o=1,u=0),null==i&&(i=r);r*=_.cos(n),i*=_.sin(n);return{x:t+o*r-u*i,y:e+u*r+o*i}}function T(n,t,e,r,i,o,u,s){return null==u&&(u=1,s=0),{x:e+u*(n*=i)-s*(t*=o=null==o?i:o),y:r+s*n+u*t}}function nt(n,t,e,r,i,o){var u=t.x,t=t.y;return(n=n||{x:0,y:0}).x=e*(u-(i=i||0))-r*(t-(o=o||0))+i,n.y=r*(u-i)+e*(t-o)+o,n}function tt(n){for(var t={ymin:1/0,xmin:1/0,ymax:-1/0,xmax:-1/0},e=0,r=n.length;e<r;++e)t.ymin=_.min(t.ymin,n[e].y),t.ymax=_.max(t.ymax,n[e].y),t.xmin=_.min(t.xmin,n[e].x),t.xmax=_.max(t.xmax,n[e].x);return t}function et(n,t){t=t||tt;var e={Tx:-n[0].x,Ty:-n[0].y,R:-_.atan2(n[n.length-1].y-n[0].y,n[n.length-1].x-n[0].x)},r=g.rotate(e.R).mul(g.translate(e.Tx,e.Ty)),e=t(n.map(function(n){return r.transform(n,{x:0,y:0})})),t=r.inv();return[t.transform({x:e.xmin,y:e.ymin}),t.transform({x:e.xmax,y:e.ymin}),t.transform({x:e.xmax,y:e.ymax}),t.transform({x:e.xmin,y:e.ymax})]}j.Scene2D=n;var l=function(n,t){n=_.abs(n),t=_.abs(t);var e=0;return h(n,0)?t:h(t,0)?n:t<n?n*_.sqrt(1+(e=t/n)*e):n<t?t*_.sqrt(1+(e=n/t)*e):n*i};function rt(n,t){return l(n.x-t.x,n.y-t.y)}function it(n,t,e,r){return n*e+t*r}function ot(n,t,e,r){return n*r-t*e}function ut(n,t,e,r){var i=l(n,t),o=l(e,r);return h(i,0)||h(o,0)?0:_.acos(B(n/i*(e/o)+t/i*(r/o),-1,1))}function st(n,t,e,r){return M(n*r-t*e)*ut(n,t,e,r)}function at(n,t,e){return ot(n.x-e.x,n.y-e.y,t.x-e.x,t.y-e.y)}function B(n,t,e){return _.min(_.max(n,t),e)}function lt(n,t,e,r){return(n-=t*_.floor(n/t))<e&&(n+=t),r<n&&(n-=t),n}function E(n){return lt(n,A,0,A)}function ct(n){return 180*n/S}function z(n){return n*S/180}function M(n){return n<0?-1:1}function h(n,t){return w(n-t)<Number.EPSILON}function k(n,t,e){return null==e&&(e=Q),w(n-t)<e}function ft(n){return n.x||0}function ht(n){return n.y||0}function gt(n,t,e){if(n)n.forEach(function(n){D.call(e,n)&&(t[n]=e[n])});else for(var r in e)D.call(e,r)&&(t[r]=e[r]);return t}function m(n,e,t,r,i){var o=!1;if(e=e||Z,y&&!1!==t){if(t)L(i)&&i(t);else if(o=!0,t=document.createElementNS("http://www.w3.org/2000/svg",n),r)for(var u=0,s=r.length;u<s;++u)t.appendChild(r[u]);else L(i)&&i(t);Object.keys(e).forEach(function(n){(o||e[n][1])&&t.setAttribute(n,e[n][0])})}else t="<"+n+" "+Object.keys(e).reduce(function(n,t){return n+t+'="'+v(e[t][0])+'" '},"")+(r?">"+v(r)+"</"+n+">":"/>");return t}function yt(u,s,a,i){if(!L(u.onChange)){var l=function(t){u.$cb.forEach(function(n){n(t)})},c=!0,f=(i=i||pt,function(n,t){for(var e=n;e<t;++e)!function(e){var n=v(e),r=u[e];C(u,n,{get:function(){return r},set:function(n){s&&(n=s(n));var t=!i(r,n);a&&a(r),r=n,t&&c&&l({target:u,method:"set",added:{from:e,to:e}})},enumerable:!0})}(e)});if(u.$cb=[],u.onChange=function(n,t){var e;L(n)&&(!1===t?-1!==(e=u.$cb.indexOf(n))&&u.$cb.splice(e,1):-1!==(e=u.$cb.indexOf(n))&&u.$cb.push(n))},s&&u.length)for(var n=0,t=u.length;n<t;++n)u[n]=s(u[n]);["push","pop","shift","unshift","splice"].forEach(function(n){var o;u[n]=(o=n,function(){var n,t,e=arguments,r=null,i=u.length;return s&&("push"!==o&&"unshift"!==o||(e=Array.prototype.map.apply(e,s)),"splice"===o)&&2<e.length&&(e=Array.prototype.slice.call(e,0,2).concat(Array.prototype.slice.call(e,2).map(s))),"shift"!==o&&"unshift"!==o&&"splice"!==o||(c=!1),n=Array.prototype[o].apply(u,e),"splice"===o&&n.length?r=n:(0<i&&"pop"===o||"shift"===o)&&(r=[n]),r&&a&&r.forEach(a),"unshift"!==o&&"splice"!==o||(c=!0),t=u.length,("push"===o||"unshift"===o||"splice"===o)&&i<t&&f(i,t),"push"===o?l({target:u,method:o,added:{from:i,to:t}}):"unshift"===o?l({target:u,method:o,added:{from:0,to:t-i-1}}):"splice"===o&&2<e.length?l({target:u,method:o,added:{from:e[0],to:e[0]+e.length-3},deleted:r}):l({target:u,method:o,deleted:r}),n})}),f(0,u.length)}return u}function xt(t,n){L(t.onChange)&&(delete t.$cb,delete t.onChange,["push","pop","shift","unshift","splice"].forEach(function(n){t[n]=Array.prototype[n]}),n=n?t.map(n):t.slice(),t.length=0,t.push.apply(t,n))}function pt(n,t){return n===t}var dt=/^\s+|\s+$/gm,mt=String.prototype.trim?function(n){return n.trim()}:function(){return s.replace(dt,"")};function vt(n,t,e,r){var n=v(n),i=n.length;return i<t&&(e=e||" ",t=new Array(t-i+1).join(e),n=r?n+t:t+n),n}function bt(n,t){return n<0?v(n):(!1===t?"":"+")+v(n)}var Ct=0,v=String;function O(n){return parseFloat(n)||0}function _t(n){return L(n.toTex)?n.toTex():n.toString()}function wt(n){return!isNaN(+n)}function $t(n){return"string"==typeof n||"[object String]"===r.call(n)}function b(n){return"[object Array]"===r.call(n)}function Pt(n){return"[object Object]"===r.call(n)&&"function"==typeof n.constructor&&"Object"===n.constructor.name}function L(n){return"function"==typeof n}return j.Geometry.linearBezierCurve=Un,j.Geometry.quadraticBezierCurve=Wn,j.Geometry.cubicBezierCurve=Jn,j.Geometry.ellipticArcCurve=function(n,t,e,r,i,o){return Y(n,t=t||0,e=e||0,r=null==r?1:r,i=null==i?r:i,_.cos(o=o||0),_.sin(o))},j.Geometry.computeConvexHull=function(n){return Mn(n).map(V)},j.Math.deg=ct,j.Math.rad=z,j.Math.hypot=l,j.Math.solveLinear=On,j.Math.solveQuadratic=X,j.Math.solveCubic=Ln,j.Math.solveQuartic=Dn,j.Math.solveLinearLinear=Qn,j.Math.solveLinearQuadratic=qn,j.Math.solveQuadraticQuadratic=In,j});